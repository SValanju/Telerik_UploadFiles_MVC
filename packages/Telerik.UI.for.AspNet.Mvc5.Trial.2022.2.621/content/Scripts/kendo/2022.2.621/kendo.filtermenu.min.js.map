{"version":3,"file":"kendo.filtermenu.min.js","sources":["kendo.filtermenu.js"],"sourcesContent":["(function(f, define) {\n    define('kendo.filtermenu',[ \"kendo.datepicker\", \"kendo.numerictextbox\", \"kendo.dropdownlist\", \"kendo.binder\" ], f);\n})(function() {\n\nvar __meta__ = { // jshint ignore:line\n    id: \"filtermenu\",\n    name: \"Filtering Menu\",\n    category: \"framework\",\n    depends: [ \"datepicker\", \"numerictextbox\", \"dropdownlist\", \"binder\" ],\n    advanced: true\n};\n\n/* jshint eqnull: true */\n(function($, undefined) {\n    var kendo = window.kendo,\n        ui = kendo.ui,\n        support = kendo.support,\n        AUTOCOMPLETEVALUE = support.browser.chrome ? \"disabled\" : \"off\",\n        POPUP = \"kendoPopup\",\n        INIT = \"init\",\n        OPEN = \"open\",\n        REFRESH = \"refresh\",\n        CHANGE = \"change\",\n        NS = \".kendoFilterMenu\",\n        COLUMNHEADERATTR = \"[role='columnheader']\",\n        EQ = \"Is equal to\",\n        NEQ = \"Is not equal to\",\n        roles = {\n            \"number\": \"numerictextbox\",\n            \"date\": \"datepicker\"\n        },\n        mobileRoles = {\n            \"string\": \"text\",\n            \"number\": \"number\",\n            \"date\": \"date\"\n        },\n        isFunction = kendo.isFunction,\n        Widget = ui.Widget;\n\n    var booleanTemplate =\n        '<div class=\"k-filter-menu-container\">' +\n            '<div class=\"k-filter-help-text\">#=messages.info#</div>' +\n            '<label>' +\n                '<input type=\"radio\" data-#=ns#bind=\"checked: filters[0].value\" value=\"true\" name=\"filters[0].value\"/>' +\n                '#=messages.isTrue#' +\n            '</label>' +\n            '<label>' +\n                '<input type=\"radio\" data-#=ns#bind=\"checked: filters[0].value\" value=\"false\" name=\"filters[0].value\"/>' +\n                '#=messages.isFalse#' +\n            '</label>' +\n            '<div class=\"k-action-buttons\">' +\n                '<button type=\"submit\" title=\"#=messages.filter#\" class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary\"><span class=\"k-button-text\">#=messages.filter#</span></button>' +\n                '<button type=\"reset\" title=\"#=messages.clear#\" class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base\"><span class=\"k-button-text\">#=messages.clear#</span></button>' +\n            '</div>' +\n        '</div>';\n\n    var modernBooleanTemplate =\n        '#var inputId;#' +\n        '<div class=\"k-filter-menu-container\">' +\n            '<div>' +\n                '<ul class=\"k-radio-list k-reset\">' +\n                    '<li>' +\n                        '#inputId = kendo.guid()#' +\n                        '<input type=\"radio\" class=\"k-radio k-radio-md\" id=\"#=inputId#\" data-#=ns#bind=\"checked: filters[0].value\" value=\"true\" name=\"filters[0].value\" />' +\n                        '<label class=\"k-radio-label\" for=\"#=inputId#\">#=messages.isTrue#</label>' +\n                    '</li>' +\n                    '<li>' +\n                        '#inputId = kendo.guid()#' +\n                        '<input type=\"radio\" class=\"k-radio k-radio-md\" id=\"#=inputId#\" data-#=ns#bind=\"checked: filters[0].value\" value=\"false\" name=\"filters[0].value\" />' +\n                        '<label class=\"k-radio-label\" for=\"#=inputId#\">#=messages.isFalse#</label>' +\n                    '</li>' +\n                '</ul>' +\n                '<div class=\"k-columnmenu-actions\">' +\n                    '<button class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base\" type=\"reset\" title=\"#=messages.clear#\"><span class=\"k-button-text\">#=messages.clear#</span></button>' +\n                    '<button class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary\" type=\"submit\" title=\"#=messages.filter#\"><span class=\"k-button-text\">#=messages.filter#</span></button>' +\n                '</div>' +\n            '</div>' +\n        '</div>';\n\n    var customBooleanTemplate =\n        '<div class=\"k-filter-menu-container\">' +\n            '<div class=\"k-filter-help-text\">#=messages.info#</div>' +\n            '<label>' +\n                '<span class=\"k-textbox k-input k-input-md k-rounded-md k-input-solid\"><input class=\"k-input-inner\" data-#=ns#bind=\"value: filters[0].value\" name=\"filters[0].value\"/></span>' +\n            '</label>' +\n            '<div class=\"k-action-buttons\">' +\n                '<button type=\"submit\" title=\"#=messages.filter#\" class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary\"><span class=\"k-button-text\">#=messages.filter#</span></button>' +\n                '<button type=\"reset\" title=\"#=messages.clear#\" class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base\"><span class=\"k-button-text\">#=messages.clear#</span></button>' +\n            '</div>' +\n        '</div>';\n\n    var defaultTemplate =\n        '<div class=\"k-filter-menu-container\">' +\n            '#if(componentType === \"classic\") {#' +\n                '<div class=\"k-filter-help-text\">#=messages.info#</div>' +\n            '#}#' +\n            '<select title=\"#=messages.operator#\" data-#=ns#bind=\"value: filters[0].operator\" data-#=ns#role=\"dropdownlist\">' +\n                '#for(var op in operators){#' +\n                    '<option value=\"#=op#\">#=operators[op]#</option>' +\n                '#}#' +\n            '</select>' +\n            '#if(values){#' +\n                '<select title=\"#=messages.value#\" data-#=ns#bind=\"value:filters[0].value\" data-#=ns#text-field=\"text\" data-#=ns#value-field=\"value\" data-#=ns#source=\\'#=kendo.stringify(values).replace(/\\'/g,\"&\\\\#39;\")#\\' data-#=ns#role=\"dropdownlist\" data-#=ns#option-label=\"#=messages.selectValue#\" data-#=ns#value-primitive=\"true\">' +\n                '</select>' +\n            '#}else{#' +\n                '<input title=\"#=messages.value#\" data-#=ns#bind=\"value:filters[0].value\" class=\"k-input-inner\" type=\"text\" #=role ? \"data-\" + ns + \"role=\\'\" + role + \"\\'\" : \"\"# />' +\n            '#}#' +\n            '#if(extra){#' +\n                '#if(componentType === \"modern\") {#' +\n                    '<ul data-#=ns#role=\"buttongroup\" data-bind=\"events: { select: onLogicChange }\">' +\n                        '<li data-#=ns#value=\"and\">And</li>' +\n                        '<li data-#=ns#value=\"or\">Or</li>' +\n                    '</ul>' +\n                '#} else {#' +\n                    '<select title=\"#=messages.logic#\" class=\"k-filter-and\" data-#=ns#bind=\"value: logic\" data-#=ns#role=\"dropdownlist\">' +\n                        '<option value=\"and\">#=messages.and#</option>' +\n                        '<option value=\"or\">#=messages.or#</option>' +\n                    '</select>' +\n                '#}#' +\n                '<select title=\"#=messages.additionalOperator#\" data-#=ns#bind=\"value: filters[1].operator\" data-#=ns#role=\"dropdownlist\">' +\n                    '#for(var op in operators){#' +\n                        '<option value=\"#=op#\">#=operators[op]#</option>' +\n                    '#}#' +\n                '</select>' +\n                '#if(values){#' +\n                    '<select title=\"#=messages.additionalValue#\" data-#=ns#bind=\"value:filters[1].value\" data-#=ns#text-field=\"text\" data-#=ns#value-field=\"value\" data-#=ns#source=\\'#=kendo.stringify(values).replace(/\\'/g,\"&\\\\#39;\")#\\' data-#=ns#role=\"dropdownlist\" data-#=ns#option-label=\"#=messages.selectValue#\" data-#=ns#value-primitive=\"true\">' +\n                    '</select>' +\n                '#}else{#' +\n                    '<input title=\"#=messages.additionalValue#\" data-#=ns#bind=\"value: filters[1].value\" class=\"k-input-inner\" type=\"text\" #=role ? \"data-\" + ns + \"role=\\'\" + role + \"\\'\" : \"\"#/>' +\n                '#}#' +\n            '#}#' +\n            '<div class=\"k-action-buttons\">' +\n                '<button type=\"submit\" title=\"#=messages.filter#\" class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary\"><span class=\"k-button-text\">#=messages.filter#</span></button>' +\n                '<button type=\"reset\" title=\"#=messages.clear#\" class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base\"><span class=\"k-button-text\">#=messages.clear#</span></button>' +\n            '</div>' +\n        '</div>';\n\n    var defaultMobileTemplate =\n        '<div data-#=ns#role=\"view\" class=\"k-grid-filter-menu\">' +\n            '<div data-#=ns#role=\"header\" class=\"k-header\">' +\n                '<a href=\"\\\\#\" class=\"k-header-cancel k-link\" title=\"#=messages.cancel#\" ' +\n                'aria-label=\"#=messages.cancel#\"><span class=\"k-icon k-i-arrow-chevron-left\"></span></a>' +\n                '#=messages.filter# #=messages.into# #=title#' +\n                '<a href=\"\\\\#\" class=\"k-header-done k-link\" title=\"#=messages.done#\" ' +\n                'aria-label=\"#=messages.done#\"><span class=\"k-icon k-i-check\"></span></a>' +\n            '</div>' +\n            '<form title=\"#=messages.title#\" class=\"k-filter-menu\">' +\n                '<ul class=\"k-reset\">' +\n                    '<li>' +\n                        '<span class=\"k-list-title k-filter-help-text\">#=messages.info#</span>' +\n                        '<ul class=\"k-listgroup k-listgroup-flush\">' +\n                            '<li class=\"k-item k-listgroup-item\">' +\n                                '<label class=\"k-listgroup-form-row k-label\">' +\n                                    '<span class=\"k-listgroup-form-field-label k-filter-operator-text\">#=messages.operator#</span>' +\n                                    '<span class=\"k-listgroup-form-field-wrapper\">' +\n                                        '<select id=\"operator_#=filterMenuGuid#\" title=\"#=messages.operator#\" class=\"k-filter-operator\" data-#=ns#bind=\"value: filters[0].operator\" autocomplete=\"' + AUTOCOMPLETEVALUE + '\" >' +\n                                            '#for(var op in operators){#' +\n                                                '<option value=\"#=op#\">#=operators[op]#</option>' +\n                                            '#}#' +\n                                        '</select>' +\n                                    '</span>' +\n                                '</label>' +\n                            '</li>' +\n                            '<li class=\"k-item k-listgroup-item\">' +\n                                '<label class=\"k-listgroup-form-row k-label\">' +\n                                    '<span class=\"k-listgroup-form-field-label k-filter-input-text\">#=messages.value#</span>' +\n                                    '<span class=\"k-listgroup-form-field-wrapper\">' +\n                                        '#if(values){#' +\n                                            '<select id=\"value_#=filterMenuGuid#\" title=\"#=messages.value#\" data-#=ns#bind=\"value:filters[0].value\" autocomplete=\"' + AUTOCOMPLETEVALUE + '\" >' +\n                                                '<option value=\"\">#=messages.selectValue#</option>' +\n                                                '#for(var val in values){#' +\n                                                    '<option value=\"#=values[val].value#\">#=values[val].text#</option>' +\n                                                '#}#' +\n                                            '</select>' +\n                                        '#}else{#' +\n                                            '<input id=\"value_#=filterMenuGuid#\" title=\"#=messages.value#\" data-#=ns#bind=\"value:filters[0].value\" class=\"k-value-input\" type=\"#=inputType#\" autocomplete=\"' + AUTOCOMPLETEVALUE + '\" />' +\n                                        '#}#' +\n                                    '</span>' +\n                                '</label>' +\n                            '</li>' +\n                        '</ul>' +\n                        '#if(extra){#' +\n                        '<ul class=\"k-listgroup k-listgroup-flush\">' +\n                            '<li class=\"k-item k-listgroup-item\">' +\n                                '<label class=\"k-listgroup-form-row k-label\">' +\n                                    '<span class=\"k-listgroup-form-field-label k-filter-logic-and-text\">#=messages.and#</span>' +\n                                    '<span class=\"k-listgroup-form-field-wrapper\">' +\n                                        '<input id=\"and_#=filterMenuGuid#\" title=\"#=messages.and#\" type=\"radio\" name=\"logic\"data-#=ns#bind=\"checked: logic\" value=\"and\" autocomplete=\"' + AUTOCOMPLETEVALUE + '\" />' +\n                                    '</span>' +\n                                '</label>' +\n                            '</li>' +\n                            '<li class=\"k-item k-listgroup-item\">' +\n                                '<label class=\"k-listgroup-form-row k-label\">' +\n                                    '<span class=\"k-listgroup-form-field-label k-filter-logic-or-text\">#=messages.or#</span>' +\n                                    '<span class=\"k-listgroup-form-field-wrapper\">' +\n                                        '<input id=\"or_#=filterMenuGuid#\" title=\"#=messages.or#\" type=\"radio\" name=\"logic\" data-#=ns#bind=\"checked: logic\" value=\"or\" autocomplete=\"' + AUTOCOMPLETEVALUE + '\" />' +\n                                    '</span>' +\n                                '</label>' +\n                            '</li>' +\n                        '</ul>' +\n                        '<ul class=\"k-listgroup k-listgroup-flush\">' +\n                            '<li class=\"k-item k-listgroup-item\">' +\n                                '<label class=\"k-listgroup-form-row k-label\">' +\n                                    '<span class=\"k-listgroup-form-field-label k-filter-operator-text\">#=messages.additionalOperator#</span>' +\n                                    '<span class=\"k-listgroup-form-field-wrapper\">' +\n                                        '<select id=\"additionalOperator_#=filterMenuGuid#\" title=\"#=messages.additionalOperator#\" class=\"k-filter-operator\" data-#=ns#bind=\"value: filters[1].operator\" autocomplete=\"' + AUTOCOMPLETEVALUE + '\" >' +\n                                            '#for(var op in operators){#' +\n                                                '<option value=\"#=op#\">#=operators[op]#</option>' +\n                                            '#}#' +\n                                        '</select>' +\n                                    '</span>' +\n                                '</label>' +\n                            '</li>' +\n                            '<li class=\"k-item k-listgroup-item\">' +\n                                '<label class=\"k-listgroup-form-row k-label\">' +\n                                    '<span class=\"k-listgroup-form-field-label k-filter-input-text\">#=messages.additionalValue#</span>' +\n                                    '<span class=\"k-listgroup-form-field-wrapper\">' +\n                                        '#if(values){#' +\n                                            '<select id=\"additionalValue_#=filterMenuGuid#\" title=\"#=messages.additionalValue#\" data-#=ns#bind=\"value:filters[1].value\" autocomplete=\"' + AUTOCOMPLETEVALUE + '\" >' +\n                                                '<option value=\"\">#=messages.selectValue#</option>' +\n                                                '#for(var val in values){#' +\n                                                    '<option value=\"#=values[val].value#\">#=values[val].text#</option>' +\n                                                '#}#' +\n                                            '</select>' +\n                                        '#}else{#' +\n                                            '<input id=\"additionalValue_#=filterMenuGuid#\" title=\"#=messages.additionalValue#\" data-#=ns#bind=\"value:filters[1].value\" class=\"k-value-input\" type=\"#=inputType#\" autocomplete=\"' + AUTOCOMPLETEVALUE + '\" />' +\n                                        '#}#' +\n                                    '</span>' +\n                                '</label>' +\n                            '</li>' +\n                        '</ul>' +\n                        '#}#' +\n                    '</li>' +\n                    '<li class=\"k-item k-clear-wrap\">' +\n                        '<span class=\"k-list-title\">&nbsp;</span>' +\n                        '<ul class=\"k-listgroup k-listgroup-flush\">' +\n                            '<li class=\"k-listgroup-item\">' +\n                                '<span class=\"k-link k-label k-clear\" title=\"#=messages.clear#\" aria-label=\"#=messages.clear#\">' +\n                                    '#=messages.clear#' +\n                                '</span>' +\n                            '</li>' +\n                        '</ul>' +\n                    '</li>' +\n                '</ul>' +\n            '</form>' +\n        '</div>';\n\n    var booleanMobileTemplate =\n        '<div data-#=ns#role=\"view\" class=\"k-grid-filter-menu\">' +\n            '<div data-#=ns#role=\"header\" class=\"k-header\">' +\n                '<a href=\"\\\\#\" class=\"k-header-cancel k-link\" title=\"#=messages.cancel#\" ' +\n                'aria-label=\"#=messages.cancel#\"><span class=\"k-icon k-i-arrow-chevron-left\"></span></a>' +\n                '#=messages.filter# #=messages.into# #=title#' +\n                '<a href=\"\\\\#\" class=\"k-header-done k-link\" title=\"#=messages.done#\" ' +\n                'aria-label=\"#=messages.done#\"><span class=\"k-icon k-i-check\"></span></a>' +\n            '</div>' +\n            '<form title=\"#=messages.title#\" class=\"k-filter-menu\">' +\n                '<ul class=\"k-reset\">' +\n                    '<li>' +\n                        '<span class=\"k-list-title k-filter-help-text\">#=messages.info#</span>' +\n                        '<ul class=\"k-listgroup k-listgroup-flush k-multicheck-bool-wrap\">' +\n                            '<li class=\"k-item k-listgroup-item\">' +\n                                '<label class=\"k-listgroup-form-row k-label\">' +\n                                    '<span class=\"k-listgroup-form-field-label k-item-title\">#=messages.isTrue#</span>' +\n                                    '<span class=\"k-listgroup-form-field-wrapper\"></span>' +\n                                        '<input id=\"true_#=filterMenuGuid#\" title=\"#=messages.isTrue#\" type=\"radio\" data-#=ns#bind=\"checked: filters[0].value\" value=\"true\" name=\"filters[0].value\" autocomplete=\"' + AUTOCOMPLETEVALUE + '\" />' +\n                                    '</span>' +\n                                '</label>' +\n                            '</li>' +\n                            '<li class=\"k-item k-listgroup-item\">' +\n                                '<label class=\"k-listgroup-form-row k-label\">' +\n                                    '<span for=\"false_#=filterMenuGuid#\" class=\"k-listgroup-form-field-label k-item-title\">#=messages.isFalse#</span>' +\n                                    '<span class=\"k-listgroup-form-field-wrapper\">' +\n                                        '<input id=\"false_#=filterMenuGuid#\" title=\"#=messages.isFalse#\" type=\"radio\" data-#=ns#bind=\"checked: filters[0].value\" value=\"false\" name=\"filters[0].value\" autocomplete=\"' + AUTOCOMPLETEVALUE + '\" />' +\n                                    '</span>' +\n                                '</label>' +\n                            '</li>' +\n                        '</ul>' +\n                    '</li>' +\n                    '<li class=\"k-item k-clear-wrap\">' +\n                        '<span class=\"k-list-title\">&nbsp;</span>' +\n                        '<ul class=\"k-listgroup k-listgroup-flush\">' +\n                            '<li class=\"k-listgroup-item\">' +\n                                '<span class=\"k-link k-label k-clear\" title=\"#=messages.clear#\" aria-label=\"#=messages.clear#\">' +\n                                    '#=messages.clear#' +\n                                '</span>' +\n                            '</li>' +\n                        '</ul>' +\n                    '</li>' +\n                '</ul>' +\n            '</form>' +\n        '</div>';\n\n    function removeFiltersForField(expression, field) {\n        if (expression.filters) {\n            expression.filters = $.grep(expression.filters, function(filter) {\n                removeFiltersForField(filter, field);\n                if (filter.filters) {\n                    return filter.filters.length;\n                } else {\n                    return filter.field != field;\n                }\n            });\n        }\n    }\n\n    function convertItems(items) {\n        var idx,\n            length,\n            item,\n            value,\n            text,\n            result;\n\n        if (items && items.length) {\n            result = [];\n            for (idx = 0, length = items.length; idx < length; idx++) {\n                item = items[idx];\n                text = item.text !== \"\" ? item.text || item.value || item : item.text;\n                value = item.value == null ? (item.text || item) : item.value;\n\n                result[idx] = { text: text, value: value };\n            }\n        }\n        return result;\n    }\n\n\n    function clearFilter(filters, field) {\n        return $.grep(filters, function(expr) {\n            if (expr.filters) {\n                expr.filters = $.grep(expr.filters, function(nested) {\n                    return nested.field != field;\n                });\n\n                return expr.filters.length;\n            }\n            return expr.field != field;\n        });\n    }\n\n    var FilterMenu = Widget.extend({\n        init: function(element, options) {\n            var that = this,\n                type = \"string\",\n                operators,\n                initial,\n                field,\n                columnHeader;\n\n            options = options || {};\n            options.componentType = options.componentType || \"classic\";\n            Widget.fn.init.call(that, element, options);\n\n            operators = that.operators = options.operators || {};\n\n            element = that.element;\n            options = that.options;\n\n            that.dataSource = DataSource.create(options.dataSource);\n\n            that.field = options.field || element.attr(kendo.attr(\"field\"));\n\n            columnHeader = $(element.closest(COLUMNHEADERATTR));\n            if (columnHeader.length) {\n                that.appendTo = columnHeader.find(options.appendTo);\n            } else {\n                that.appendTo = $(options.appendTo);\n            }\n\n            that.link = that._createLink() || $();\n\n            that.model = that.dataSource.reader.model;\n\n            that._parse = function(value) {\n                 return value != null ? (value + \"\") : value;\n            };\n\n            if (that.model && that.model.fields) {\n                field = that.model.fields[that.field];\n\n                if (field) {\n                    type = field.type || \"string\";\n                    if (field.parse) {\n                        that._parse = field.parse.bind(field);\n                    }\n                }\n            }\n\n            if (options.values) {\n                type = \"enums\";\n            }\n\n            that.type = type;\n\n            operators = operators[type] || options.operators[type];\n\n            for (initial in operators) { // get the first operator\n                break;\n            }\n\n            that._defaultFilter = function() {\n                return { field: that.field, operator: initial || \"eq\", value: \"\" };\n            };\n\n            that._refreshHandler = that.refresh.bind(that);\n\n            that.dataSource.bind(CHANGE, that._refreshHandler);\n\n            if (options.appendToElement) { // force creation if used in column menu\n                that._init();\n            } else {\n                that.refresh(); //refresh if DataSource is fitered before menu is created\n            }\n        },\n\n        _init: function() {\n            var that = this,\n                ui = that.options.ui,\n                setUI = isFunction(ui),\n                attrRole = kendo.attr(\"role\"),\n                role;\n\n            that.pane = that.options.pane;\n            if (that.pane) {\n                that._isMobile = true;\n            }\n\n            if (!setUI) {\n                role = ui || roles[that.type];\n            }\n\n            if (that._isMobile) {\n                that._createMobileForm(role);\n            } else {\n                that._createForm(role);\n            }\n\n            that.form\n                .on(\"submit\" + NS, that._submit.bind(that))\n                .on(\"reset\" + NS, that._reset.bind(that));\n\n            if (setUI) {\n                that.form.find(\".k-input-inner\")\n                    .removeClass(\"k-input-inner\")\n                    .each(function() {\n                        ui($(this));\n                    });\n            } else {\n                that.form\n                    .find(\".k-input-inner[\" + attrRole + \"]\")\n                    .removeClass(\"k-input-inner\");\n\n                that.form\n                    .find(\".k-input-inner:not([data-role]):not(.k-numerictextbox>.k-input-inner)\")\n                    .wrap(\"<span class='k-textbox k-input k-input-md k-rounded-md k-input-solid'></span>\");\n            }\n\n            that.refresh();\n\n            that.trigger(INIT, { field: that.field, container: that.form });\n\n            if (that.options.cycleForm) {\n                kendo.cycleForm(that.form);\n            }\n        },\n\n        _createForm: function(role) {\n            var that = this,\n                options = that.options,\n                operators = that.operators || {},\n                type = that.type;\n\n            operators = operators[type] || options.operators[type];\n\n            that.form = $('<form title=\"' + that.options.messages.title + '\" class=\"k-filter-menu\"/>')\n                .html(kendo.template(that._getTemplate())({\n                    field: that.field,\n                    format: options.format,\n                    ns: kendo.ns,\n                    messages: options.messages,\n                    extra: options.extra,\n                    operators: operators,\n                    type: type,\n                    role: role,\n                    values: convertItems(options.values),\n                    componentType: that.options.componentType\n                }));\n\n            if (!options.appendToElement) {\n                that.popup = that.form[POPUP]({\n                    anchor: that.link,\n                    copyAnchorStyles: false,\n                    open: that._open.bind(that),\n                    activate: that._activate.bind(that),\n                    close: function() {\n                        if (that.options.closeCallback) {\n                            that.options.closeCallback(that.element);\n                        }\n                    }\n                }).data(POPUP);\n            } else {\n                that.element.append(that.form);\n                that.popup = that.element.closest(\".k-popup\").data(POPUP);\n            }\n\n            that.form\n                .on(\"keydown\" + NS, that._keydown.bind(that));\n        },\n\n        _getTemplate: function() {\n            var that = this,\n                hasCustomTemplate = isFunction(that.options.ui);\n\n            if (that.type === 'boolean') {\n                if (hasCustomTemplate) {\n                    return customBooleanTemplate;\n                } else if (that.options.componentType === 'modern') {\n                    return modernBooleanTemplate;\n                } else {\n                    return booleanTemplate;\n                }\n            } else {\n                return defaultTemplate;\n            }\n        },\n\n        _createMobileForm: function(role) {\n            var that = this,\n                options = that.options,\n                operators = that.operators || {},\n                filterMenuGuid = kendo.guid(),\n                type = that.type;\n\n            operators = operators[type] || options.operators[type];\n\n            that.form = $(\"<div />\")\n                .html(kendo.template(type === \"boolean\" ? booleanMobileTemplate : defaultMobileTemplate)({\n                    field: that.field,\n                    title: options.title || that.field,\n                    format: options.format,\n                    ns: kendo.ns,\n                    messages: options.messages,\n                    extra: options.extra,\n                    operators: operators,\n                    filterMenuGuid: filterMenuGuid,\n                    type: type,\n                    role: role,\n                    inputType: mobileRoles[type],\n                    values: convertItems(options.values)\n                }));\n\n            that.view = that.pane.append(that.form.html());\n            that.form = that.view.element.find(\"form\");\n\n            that.view.element\n                .on(\"click\", \".k-header-done\", function(e) {\n                    that.form.submit();\n                    e.preventDefault();\n                })\n                .on(\"click\", \".k-header-cancel\", function(e) {\n                    that._closeForm();\n                    e.preventDefault();\n                })\n                .on(\"click\", \".k-clear\", function(e) {\n                    that._mobileClear();\n                    e.preventDefault();\n                });\n\n            that.view.bind(\"showStart\", function() {\n                that.refresh();\n            });\n        },\n\n        _createLink: function() {\n            var that = this,\n                element = that.element,\n                appendTarget = that.appendTo.length ? element.find(that.appendTo) : element,\n                options = that.options,\n                title = kendo.format(options.messages.buttonTitle, that.options.title || that.field),\n                link;\n\n            if (options.appendToElement) {\n                return;\n            }\n\n            link = element.addClass(\"k-filterable\").find(\".k-grid-filter\");\n\n            if (!link[0]) {\n                link = appendTarget\n                    .append('<a class=\"k-grid-filter-menu k-grid-filter\" href=\"#\" title=\"' +\n                        title + '\" aria-label=\"' +\n                        title + '\"><span class=\"k-icon k-i-filter\"></span></a>')\n                    .find(\".k-grid-filter\");\n            }\n\n            link.attr(\"tabindex\", -1)\n                .on(\"click\" + NS, that._click.bind(that));\n\n            return link;\n        },\n\n        refresh: function() {\n            var that = this,\n                expression = that.dataSource.filter() || { filters: [], logic: \"and\" };\n\n            var defaultFilters = [ that._defaultFilter() ];\n            var defaultOperator = that._defaultFilter().operator;\n            if (that.options.extra || (defaultOperator !== \"isnull\" && defaultOperator !== \"isnullorempty\" && defaultOperator !== \"isnotnullorempty\" && defaultOperator !== \"isnotnull\" && defaultOperator !== \"isempty\" && defaultOperator !== \"isnotempty\")) {\n                defaultFilters.push(that._defaultFilter());\n            }\n\n            that.filterModel = kendo.observable({\n                logic: \"and\",\n                filters: defaultFilters\n            });\n\n            if (that.form) {\n                //NOTE: binding the form element directly causes weird error in IE when grid is bound through MVVM and column is sorted\n                kendo.bind(that.form.children().first(), that.filterModel);\n\n                if (that.options.componentType === \"modern\" && that.options.extra && that.type !== \"boolean\" && !that._isMobile) {\n                    that.filterModel.bind(\"change\", function() {\n                        var roleAttribute = kendo.attr(\"role\");\n                        var buttongroup = that.form.find(\"[\" + roleAttribute + \"='buttongroup']\").data('kendoButtonGroup');\n                        var index = this.logic === \"and\" ? 0 : 1;\n\n                        buttongroup.select(buttongroup.element.children().eq(index));\n                    });\n                    that.filterModel.set(\"onLogicChange\",that._logicChangeHandler);\n                }\n            }\n\n            if (that._bind(expression)) {\n                that.link.addClass(\"k-state-active\");\n            } else {\n                that.link.removeClass(\"k-state-active\");\n            }\n        },\n\n        _logicChangeHandler: function(e) {\n            var valueAttribute = kendo.attr('value');\n            var logic = e.sender.current().attr(valueAttribute);\n\n            this.set('logic', logic);\n        },\n\n        destroy: function() {\n            var that = this;\n\n            Widget.fn.destroy.call(that);\n\n            if (that.form) {\n                kendo.unbind(that.form);\n                kendo.destroy(that.form);\n                that.form.off(NS);\n                if (that.popup) {\n                    that.popup.destroy();\n                    that.popup = null;\n                }\n                that.form = null;\n            }\n\n            if (that.view) {\n                that.view.purge();\n                that.view = null;\n            }\n\n            that.link.off(NS);\n\n            if (that._refreshHandler) {\n                that.dataSource.unbind(CHANGE, that._refreshHandler);\n                that.dataSource = null;\n            }\n\n            that.element = that.link = that._refreshHandler = that.filterModel = null;\n        },\n\n        _bind: function(expression) {\n            var that = this,\n                filters = expression.filters,\n                idx,\n                length,\n                found = false,\n                current = 0,\n                filterModel = that.filterModel,\n                currentFilter,\n                filter;\n\n            for (idx = 0, length = filters.length; idx < length; idx++) {\n                filter = filters[idx];\n                if (filter.field == that.field) {\n                    filterModel.set(\"logic\", expression.logic);\n\n                    currentFilter = filterModel.filters[current];\n                    if (!currentFilter) {\n                        filterModel.filters.push({ field: that.field });\n                        currentFilter = filterModel.filters[current];\n                    }\n                    currentFilter.set(\"value\", that._parse(filter.value));\n                    currentFilter.set(\"operator\", filter.operator);\n\n                    current++;\n                    found = true;\n                } else if (filter.filters) {\n                    found = found || that._bind(filter);\n                }\n            }\n\n            return found;\n        },\n\n        _stripFilters: function(filters) {\n           return $.grep(filters, function(filter) {\n               return (filter.value !== \"\" && filter.value != null) ||\n               (filter.operator === \"isnull\" || filter.operator === \"isnotnull\" ||\n                   filter.operator === \"isempty\" || filter.operator === \"isnotempty\" ||\n                   filter.operator == \"isnullorempty\" || filter.operator == \"isnotnullorempty\");\n            });\n        },\n\n        _merge: function(expression) {\n            var that = this,\n                logic = expression.logic || \"and\",\n                filters = this._stripFilters(expression.filters),\n                filter,\n                result = that.dataSource.filter() || { filters: [], logic: \"and\" },\n                idx,\n                length;\n\n            removeFiltersForField(result, that.field);\n\n            for (idx = 0, length = filters.length; idx < length; idx++) {\n                filter = filters[idx];\n                filter.value = that._parse(filter.value);\n            }\n\n            if (filters.length) {\n                if (result.filters.length) {\n                    expression.filters = filters;\n\n                    if (result.logic !== \"and\") {\n                        result.filters = [ { logic: result.logic, filters: result.filters }];\n                        result.logic = \"and\";\n                    }\n\n                    if (filters.length > 1) {\n                        result.filters.push(expression);\n                    } else {\n                        result.filters.push(filters[0]);\n                    }\n                } else {\n                    result.filters = filters;\n                    result.logic = logic;\n                }\n            }\n\n            return result;\n        },\n\n        filter: function(expression) {\n            var filters = this._stripFilters(expression.filters);\n            if (filters.length && this.trigger(\"change\", {\n                    filter: { logic: expression.logic, filters: filters },\n                    field: this.field\n                })) {\n\n                return;\n            }\n\n            expression = this._merge(expression);\n\n            if (expression.filters.length) {\n                this.dataSource.filter(expression);\n            }\n        },\n\n        clear: function(expression) {\n            var that = this;\n            expression = expression || $.extend(true, {}, { filters: [] }, that.dataSource.filter()) || { filters: [] };\n\n            if (this.trigger(\"change\", { filter: null, field: that.field })) {\n                return;\n            }\n\n            that._removeFilter(expression);\n        },\n\n        _mobileClear: function() {\n            var that = this;\n            var viewElement = that.view.element;\n\n            if (that.type === \"boolean\") {\n                var booleanRadioButton = viewElement.find(\"[type='radio']:checked\");\n                var booleanRadioButtonValue = booleanRadioButton.val();\n\n                booleanRadioButton.val(\"\");\n                booleanRadioButton.trigger(\"change\");\n                booleanRadioButton.val(booleanRadioButtonValue);\n                booleanRadioButton.prop(\"checked\", false);\n            } else {\n                var operatorSelects = viewElement.find(\"select\");\n\n                operatorSelects.each(function(i, e) {\n                    var input = $(e);\n\n                    input.val(input.find(\"option\").first().val());\n                    input.trigger(\"change\");\n                });\n\n                if (that.type === \"string\" || that.type === \"date\" || that.type === \"number\") {\n                    var valueInputs = viewElement.find(\".k-value-input\");\n\n                    valueInputs.each(function(i, e) {\n                        var input = $(e);\n\n                        input.val(\"\");\n                        input.trigger(\"change\");\n                    });\n                }\n\n                if (that.options.extra) {\n                    var andLogicRadio = viewElement.find(\"[name=logic]\").first();\n\n                    andLogicRadio.prop(\"checked\", true);\n                    andLogicRadio.trigger(\"change\");\n                }\n            }\n        },\n\n        _removeFilter: function(expression) {\n            var that = this;\n            expression.filters = $.grep(expression.filters, function(filter) {\n                if (filter.filters) {\n                    filter.filters = clearFilter(filter.filters, that.field);\n\n                    return filter.filters.length;\n                }\n\n                return filter.field != that.field;\n            });\n\n            if (!expression.filters.length) {\n                expression = null;\n            }\n\n            that.dataSource.filter(expression);\n        },\n\n        _submit: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            var expression = this.filterModel.toJSON();\n            var containsFilters = $.grep(expression.filters, function(filter) {\n                return filter.value !== \"\" && filter.value !== null;\n            });\n\n            if (this._checkForNullOrEmptyFilter(expression) || (containsFilters && containsFilters.length)) {\n                this.filter(expression);\n            } else {\n                var currentExpression = this.dataSource.filter();\n\n                if (currentExpression) {\n                    currentExpression.filters.push(expression);\n                    expression = currentExpression;\n                }\n                this.clear(expression);\n            }\n\n            this._closeForm();\n        },\n\n        _checkForNullOrEmptyFilter: function(expression) {\n            if (!expression || !expression.filters || !expression.filters.length) {\n                return false;\n            }\n            var firstNullOrEmpty = false;\n            var secondNullOrEmpty = false;\n            var operator;\n\n            if (expression.filters[0]) {\n                operator = expression.filters[0].operator;\n                firstNullOrEmpty = operator == \"isnull\" || operator == \"isnotnull\" || operator == \"isnotempty\" ||\n                    operator == \"isempty\" || operator == \"isnullorempty\" || operator == \"isnotnullorempty\";\n            }\n            if (expression.filters[1]) {\n                operator = expression.filters[1].operator;\n                secondNullOrEmpty = operator == \"isnull\" || operator == \"isnotnull\" || operator == \"isnotempty\" ||\n                    operator == \"isempty\" || operator == \"isnullorempty\" || operator == \"isnotnullorempty\";\n            }\n\n            return (!this.options.extra && firstNullOrEmpty) || (this.options.extra && (firstNullOrEmpty || secondNullOrEmpty));\n        },\n\n        _reset: function() {\n            this.clear();\n\n            if (this.options.search && this.container) {\n                this.container.find(\"label\").parent().show();\n            }\n            this._closeForm();\n        },\n\n        _closeForm: function() {\n            if (this._isMobile) {\n                this.pane.navigate(\"\", this.options.animations.right);\n            } else {\n                this.popup.close();\n            }\n        },\n\n        _click: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            if (!this.popup && !this.pane) {\n                this._init();\n            }\n\n            if (this._isMobile) {\n                this.pane.navigate(this.view, this.options.animations.left);\n            } else {\n                this.popup.toggle();\n            }\n        },\n\n        _open: function() {\n            var popup;\n\n            $(\".k-filter-menu\").not(this.form).each(function() {\n                popup = $(this).data(POPUP);\n                if (popup) {\n                    popup.close();\n                }\n            });\n        },\n\n        _activate: function() {\n            this.form.find(\":kendoFocusable\").first().trigger(\"focus\");\n\n            this.trigger(OPEN, { field: this.field, container: this.form });\n        },\n\n        _keydown: function(e) {\n            if (e.keyCode == kendo.keys.ESC) {\n                this.popup.close();\n            }\n        },\n\n        events: [ INIT, \"change\", OPEN ],\n\n        options: {\n            name: \"FilterMenu\",\n            extra: true,\n            appendToElement: false,\n            type: \"string\",\n            operators: {\n                string: {\n                    eq: EQ,\n                    neq: NEQ,\n                    startswith: \"Starts with\",\n                    contains: \"Contains\",\n                    doesnotcontain: \"Does not contain\",\n                    endswith: \"Ends with\",\n                    isnull: \"Is null\",\n                    isnotnull: \"Is not null\",\n                    isempty: \"Is empty\",\n                    isnotempty: \"Is not empty\",\n                    isnullorempty: \"Has no value\",\n                    isnotnullorempty: \"Has value\"\n                },\n                number: {\n                    eq: EQ,\n                    neq: NEQ,\n                    gte: \"Is greater than or equal to\",\n                    gt: \"Is greater than\",\n                    lte: \"Is less than or equal to\",\n                    lt: \"Is less than\",\n                    isnull: \"Is null\",\n                    isnotnull: \"Is not null\"\n                },\n                date: {\n                    eq: EQ,\n                    neq: NEQ,\n                    gte: \"Is after or equal to\",\n                    gt: \"Is after\",\n                    lte: \"Is before or equal to\",\n                    lt: \"Is before\",\n                    isnull: \"Is null\",\n                    isnotnull: \"Is not null\"\n                },\n                enums: {\n                    eq: EQ,\n                    neq: NEQ,\n                    isnull: \"Is null\",\n                    isnotnull: \"Is not null\"\n                }\n            },\n            messages: {\n                info: \"Show items with value that:\",\n                title: \"Show items with value that:\",\n                isTrue: \"is true\",\n                isFalse: \"is false\",\n                filter: \"Filter\",\n                clear: \"Clear\",\n                and: \"And\",\n                or: \"Or\",\n                selectValue: \"-Select value-\",\n                operator: \"Operator\",\n                value: \"Value\",\n                additionalValue: \"Additional value\",\n                additionalOperator: \"Additional operator\",\n                logic: \"Filters logic\",\n                cancel: \"Cancel\",\n                done: \"Done\",\n                into: \"in\",\n                buttonTitle: \"{0} filter column settings\"\n            },\n            animations: {\n                left: \"slide\",\n                right: \"slide:right\"\n            },\n            componentType: 'classic',\n            cycleForm: true,\n            appendTo: null\n        }\n    });\n\n    var multiCheckNS = \".kendoFilterMultiCheck\";\n\n    function filterValuesForField(expression, field) {\n\n        if (expression.filters) {\n            expression.filters = $.grep(expression.filters, function(filter) {\n                filterValuesForField(filter, field);\n                if (filter.filters) {\n                    return filter.filters.length;\n                } else {\n                    return filter.field == field && filter.operator == \"eq\";\n                }\n            });\n        }\n    }\n\n    function flatFilterValues(expression) {\n        if (expression.logic == \"and\" && expression.filters.length > 1) {\n            return [];\n        }\n        if (expression.filters) {\n            return $.map(expression.filters, function(filter) {\n                return flatFilterValues(filter);\n            });\n        } else if (expression.value !== undefined) {\n            return [expression.value];\n        } else {\n            return [];\n        }\n    }\n\n    function distinct(items, field) {\n        var getter = kendo.getter(field, true),\n            result = [],\n            index = 0,\n            seen = {};\n\n        while (index < items.length) {\n            var item = items[index++],\n                text = getter(item);\n\n            if (text !== undefined && !seen.hasOwnProperty(text)) {\n                result.push(item);\n                seen[text] = true;\n            }\n        }\n\n        return result;\n    }\n\n    function removeDuplicates(dataSelector, dataTextField) {\n\n        return function(e) {\n            var items = dataSelector(e);\n\n            return distinct(items, dataTextField);\n        };\n    }\n\n    var DataSource = kendo.data.DataSource;\n\n    var multiCkeckMobileTemplate =\n        '<div data-#=ns#role=\"view\" class=\"k-grid-filter-menu\">' +\n            '<div data-#=ns#role=\"header\" class=\"k-header\">' +\n                '<a href=\"\\\\#\" class=\"k-header-cancel k-link\" title=\"#=messages.cancel#\" ' +\n                'aria-label=\"#=messages.cancel#\"><span class=\"k-icon k-i-arrow-chevron-left\"></span></a>' +\n                '#=messages.filter# #=messages.into# #=title#' +\n                '<a href=\"\\\\#\" class=\"k-header-done k-link\" title=\"#=messages.done#\" ' +\n                'aria-label=\"#=messages.done#\"><span class=\"k-icon k-i-check\"></span></a>' +\n            '</div>' +\n            '<form class=\"k-filter-menu\">' +\n                '<ul class=\"k-reset\">' +\n                    '#if(search){#' +\n                        '<li class=\"k-space-right\">' +\n                            '<span class=\"k-searchbox k-textbox k-input k-input-md k-rounded-md k-input-solid\">' +\n                                '<input class=\"k-input-inner\" placeholder=\"#=messages.search#\" title=\"#=messages.search#\" autocomplete=\"' + AUTOCOMPLETEVALUE + '\"  />' +\n                                '<span class=\"k-input-suffix\"><span class=\"k-icon k-i-zoom\"></span>' +\n                            '</span>' +\n                        '</li>' +\n                    '#}#' +\n                    '<li class=\"k-filter-tools\">' +\n                        '<span style=\"#=checkAll ? \"\" : \"visibility: hidden;\" #\" class=\"k-label k-select-all\" title=\"#=messages.checkAll#\" ' +\n                        'aria-label=\"#=messages.checkAll#\">#=messages.checkAll#</span>' +\n                        '<span class=\"k-label k-clear-all\" title=\"#=messages.clearAll#\" ' +\n                        'aria-label=\"#=messages.clearAll#\">#=messages.clearAll#</span>' +\n                    '</li>' +\n                    '#if(messages.selectedItemsFormat){#' +\n                        '<li>' +\n                            '<div class=\"k-filter-selected-items\"></div>' +\n                        '</li>' +\n                    '#}#' +\n                    '<li>' +\n                        '<ul class=\"k-multicheck-wrap k-listgroup k-listgroup-flush\"></ul>' +\n                    '</li>' +\n                '</ul>' +\n            '</form>' +\n        '</div>';\n\n    var FilterMultiCheck = Widget.extend({\n        init: function(element, options) {\n            Widget.fn.init.call(this, element, options);\n            options = this.options;\n            this.element = $(element);\n            var columnHeader;\n            var field = this.field = this.options.field || this.element.attr(kendo.attr(\"field\"));\n            var checkSource = options.checkSource;\n            if (this._foreignKeyValues()) {\n                this.checkSource = DataSource.create(options.values);\n                this.checkSource.fetch();\n            } else if (options.forceUnique) {\n                checkSource = $.extend(true, {}, options.dataSource.options);\n                delete checkSource.pageSize;\n\n                this.checkSource = DataSource.create(checkSource);\n                this.checkSource.reader.data = removeDuplicates(this.checkSource.reader.data, this.field);\n            } else {\n                this.checkSource = DataSource.create(checkSource);\n            }\n\n            this.dataSource = options.dataSource;\n            this.model = this.dataSource.reader.model;\n\n            this._parse = function(value) {\n                 return value + \"\";\n            };\n\n            if (this.model && this.model.fields) {\n                field = this.model.fields[this.field];\n\n                if (field) {\n                    if (field.type == \"number\") {\n                        this._parse = function(value) {\n                            if (typeof value === \"string\" && (value.toLowerCase() === \"null\" || this._foreignKeyValues() && value === \"\")) {\n                                return null;\n                            }\n                            return parseFloat(value);\n                        };\n                    } else if (field.parse) {\n                        this._parse = field.parse.bind(field);\n                    }\n                    this.type = field.type || \"string\";\n                }\n            }\n\n            columnHeader = $(element.closest(COLUMNHEADERATTR));\n            if (columnHeader.length) {\n                this.appendTo = columnHeader.find(options.appendTo);\n            } else {\n                this.appendTo = $(options.appendTo);\n            }\n\n            if (!options.appendToElement) {\n                this._createLink();\n            } else {\n                this._init();\n            }\n\n            this._refreshHandler = this.refresh.bind(this);\n            this.dataSource.bind(CHANGE, this._refreshHandler);\n\n        },\n        _createLink: function() {\n            var element = this.element;\n            var appendTarget = this.appendTo.length ? element.find(this.appendTo) : element;\n            var link = element.addClass(\"k-filterable\").find(\".k-grid-filter\");\n            var title = kendo.format(this.options.messages.buttonTitle, this.options.title || this.field);\n\n            if (!link[0]) {\n                link = appendTarget\n                    .append('<a class=\"k-grid-filter-menu k-grid-filter\" href=\"#\" title=\"' +\n                        title + '\" aria-label=\"' +\n                        title + '\"><span class=\"k-icon k-i-filter\"></span></a>')\n                    .find(\".k-grid-filter\");\n            }\n\n            this._link = link.attr(\"tabindex\", -1)\n                .on(\"click\" + NS, this._click.bind(this));\n        },\n        _init: function() {\n            var that = this;\n            var forceUnique = this.options.forceUnique;\n\n            var options = this.options;\n            this.pane = options.pane;\n\n            if (this.pane) {\n                this._isMobile = true;\n            }\n\n            this._createForm();\n\n            if (this._foreignKeyValues()) {\n                this.refresh();\n            } else if (forceUnique && !this.checkSource.options.serverPaging && this.dataSource.data().length) {\n                this.checkSource.data(distinct(this.dataSource.data(),this.field));\n                this.refresh();\n            } else {\n                this._attachProgress();\n\n                this.checkSource.fetch(function() {\n                    that.refresh.call(that);\n                });\n            }\n\n            if (!this.options.forceUnique) {\n                this.checkChangeHandler = function() {\n                    that.container.empty();\n                    that.refresh();\n                };\n                this.checkSource.bind(CHANGE, this.checkChangeHandler);\n            }\n\n            this.form.on(\"keydown\" + multiCheckNS, this._keydown.bind(this))\n                        .on(\"submit\" + multiCheckNS, this._filter.bind(this))\n                        .on(\"reset\" + multiCheckNS, this._reset.bind(this));\n\n            this.trigger(INIT, { field: this.field, container: this.form });\n        },\n\n        _attachProgress: function() {\n            var that = this;\n\n            this._progressHandler = function() {\n                ui.progress(that.container, true);\n            };\n\n            this._progressHideHandler = function() {\n                ui.progress(that.container, false);\n            };\n\n            this.checkSource\n                .bind(\"progress\", this._progressHandler)\n                .bind(\"change\", this._progressHideHandler);\n        },\n\n        _input: function() {\n            var that = this;\n            that._clearTypingTimeout();\n            that._typingTimeout = setTimeout(function() { that.search(); }, 100);\n        },\n\n        _clearSearch: function() {\n            var that = this;\n            that.searchTextBox.val(\"\");\n            that.search();\n        },\n\n        _clearTypingTimeout: function() {\n            if (this._typingTimeout) {\n                clearTimeout(this._typingTimeout);\n                this._typingTimeout = null;\n            }\n        },\n\n        search: function() {\n            var ignoreCase = this.options.ignoreCase;\n            var searchString = this.searchTextBox[0].value;\n            var labels = this.container.find(\"label\");\n\n            if (ignoreCase) {\n                searchString = searchString.toLowerCase();\n            }\n            var i = 0;\n            if (this.options.checkAll && labels.length)\n            {\n                if (!this._isMobile) {\n                    labels[0].parentNode.style.display = searchString ? \"none\" : \"\";\n                    i++;\n                } else {\n                    this.view.element.find(\".k-select-all\")[0].style.visibility = searchString ? \"hidden\" : \"\";\n                }\n            }\n\n            while (i < labels.length) {\n                var label = labels[i];\n                var labelText = label.textContent || label.innerText;\n                if (ignoreCase) {\n                    labelText = labelText.toLowerCase();\n                }\n                label.parentNode.style.display = labelText.indexOf(searchString) >= 0 ? \"\" : \"none\";\n                i++;\n            }\n        },\n        _activate: function() {\n            this.form.find(\":kendoFocusable\").first().trigger(\"focus\");\n\n            this.trigger(OPEN, { field: this.field, container: this.form });\n        },\n        _createForm: function() {\n            var options = this.options;\n            var html = \"\";\n            var that = this;\n\n            if (!this._isMobile) {\n                html += \"<div class='k-filter-menu-container'>\";\n                if (options.search) {\n                    html += \"<span class='k-searchbox k-textbox k-input k-input-md k-rounded-md k-input-solid'>\" +\n                                \"<span class='k-input-icon k-icon k-i-search'></span>\" +\n                                \"<input class='k-input-inner' type='text' placeholder='\" + options.messages.search + \"' />\" +\n                                \"<span class='k-input-suffix'>\" +\n                                    \"<span class='k-clear-value'><span class='k-icon k-i-x'></span></span>\" +\n                                \"</span>\" +\n                            \"</span>\";\n                }\n                html += \"<ul class='k-reset k-multicheck-wrap'></ul>\";\n                if (options.messages.selectedItemsFormat) {\n                    html += \"<div class='k-filter-selected-items'>\" + kendo.format(options.messages.selectedItemsFormat, 0) + \"</div>\";\n                }\n                html += \"<div class='k-action-buttons'>\";\n                html += \"<button type='submit' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary'><span class='k-button-text'>\" + options.messages.filter + \"</span></button>\";\n                html += \"<button type='reset' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base'><span class='k-button-text'>\" + options.messages.clear + \"</span></button>\";\n                html += \"</div>\";\n                html += \"</div>\";\n\n                this.form = $('<form class=\"k-filter-menu\"/>').html(html);\n                this.container = this.form.find(\".k-multicheck-wrap\");\n            }\n            if (this._isMobile) {\n                that.form = $(\"<div />\")\n                    .html(kendo.template(multiCkeckMobileTemplate)({\n                        field: that.field,\n                        title: options.title || that.field,\n                        ns: kendo.ns,\n                        messages: options.messages,\n                        search: options.search,\n                        checkAll: options.checkAll\n                    }));\n\n                that.view = that.pane.append(that.form.html());\n                that.form = that.view.element.find(\"form\");\n                var element = this.view.element;\n                this.container = element.find(\".k-multicheck-wrap\");\n\n                element\n                    .on(\"click\", \".k-header-done\", function(e) {\n                        that.form.submit();\n                        e.preventDefault();\n                    })\n                    .on(\"click\", \".k-header-cancel\", function(e) {\n                        that._closeForm();\n                        e.preventDefault();\n                    })\n                    .on(\"click\", \".k-clear-all\", function(e) {\n                        that._mobileCheckAll(false);\n                        e.preventDefault();\n                    })\n                    .on(\"click\", \".k-select-all\", function(e) {\n                        that._mobileCheckAll(true);\n                        e.preventDefault();\n                    });\n\n                that.view.bind(\"showStart\", function() {\n                    that.refresh();\n                });\n            } else {\n                if (!options.appendToElement) {\n                    that.popup = that.form.kendoPopup({\n                        anchor: that._link,\n                        copyAnchorStyles: false,\n                        open: that._open.bind(that),\n                        activate: that._activate.bind(that),\n                        close: function() {\n                            if (that.options.closeCallback) {\n                                that.options.closeCallback(that.element);\n                            }\n                        }\n                    }).data(POPUP);\n                } else {\n                    this.popup = this.element.closest(\".k-popup\").data(POPUP);\n                    this.element.append(this.form);\n                }\n            }\n\n            if (options.search) {\n                this.searchTextBox = this.form.find(\".k-searchbox input\");\n                this.searchTextBox.on(\"input\" + multiCheckNS, this._input.bind(this));\n                this.clearSearchButton = this.form.find(\".k-searchbox .k-clear-value\");\n                this.clearSearchButton.on(\"click\" + multiCheckNS, this._clearSearch.bind(this));\n            }\n        },\n        _open: function() {\n            var popup;\n\n            $(\".k-filter-menu\").not(this.form).each(function() {\n                popup = $(this).data(POPUP);\n                if (popup) {\n                    popup.close();\n                }\n            });\n        },\n        createCheckAllItem: function() {\n            var options = this.options;\n            var template = kendo.template(options.itemTemplate({ field: \"all\", mobile: this._isMobile }));\n            var checkAllContainer = $(template({ all: options.messages.checkAll }));\n            this.container.prepend(checkAllContainer);\n\n            checkAllContainer.addClass(\"k-check-all-wrap\");\n            this.checkBoxAll = checkAllContainer.find(\":checkbox\").eq(0).addClass(\"k-check-all\");\n            this.checkAllHandler = this.checkAll.bind(this);\n            this.checkBoxAll.on(CHANGE + multiCheckNS, this.checkAllHandler);\n        },\n        updateCheckAllState: function() {\n            if (this.options.messages.selectedItemsFormat) {\n                this.form.find(\".k-filter-selected-items\").text(kendo.format(this.options.messages.selectedItemsFormat, this.container.find(\":checked:not(.k-check-all)\").length));\n            }\n            if (this.checkBoxAll) {\n                var state = this.container.find(\":checkbox:not(.k-check-all)\").length == this.container.find(\":checked:not(.k-check-all)\").length;\n                this.checkBoxAll.prop(\"checked\", state);\n            }\n        },\n        createIsNullItem: function() {\n            var options = this.options;\n            var template = kendo.template(options.itemTemplate({ field: \"isNull\", mobile: this._isMobile, valueField: \"value\" }));\n            var isNullContainer = $(template({ isNull: options.messages.isNull, value: null }));\n            this.container.append(isNullContainer);\n        },\n        refresh: function(e) {\n            var forceUnique = this.options.forceUnique;\n            var dataSource = this.dataSource;\n            var filters = this.getFilterArray();\n\n            if (this._link) {\n                this._link.toggleClass(\"k-state-active\", filters.length !== 0);\n            }\n\n            if (this.form) {\n                if (e && forceUnique && e.sender === dataSource && !dataSource.options.serverPaging &&\n                     (e.action == \"itemchange\" || e.action == \"add\" || e.action == \"remove\" || (dataSource.options.autoSync && e.action === \"sync\")) &&\n                         !this._foreignKeyValues()) {\n                    this.checkSource.data(distinct(this.dataSource.data(),this.field));\n                    this.container.empty();\n                }\n\n                if (this.container.is(\":empty\")) {\n                    this.createCheckBoxes();\n                }\n                this.checkValues(filters);\n                this.trigger(REFRESH);\n            }\n        },\n        getFilterArray: function() {\n            var expression = $.extend(true, {}, { filters: [], logic: \"and\" }, this.dataSource.filter());\n            filterValuesForField(expression, this.field);\n            var flatValues = flatFilterValues(expression);\n            return flatValues;\n        },\n        createCheckBoxes: function() {\n            var options = this.options;\n            var data;\n            var templateOptions = {\n                field: this.field,\n                format: options.format,\n                mobile: this._isMobile,\n                type: this.type\n            };\n            var boolDataFilter = booleanFilterHandler.bind(this);\n\n            if (!this.options.forceUnique) {\n                data = this.checkSource.view();\n            } else if (this._foreignKeyValues()) {\n                data = this.checkSource.data();\n                templateOptions.valueField = \"value\";\n                templateOptions.field = \"text\";\n            } else if (this.checkSource._isServerGrouped()) {\n                data = distinct(this.checkSource._flatData(this.checkSource.data()), this.field);\n            } else {\n                data = this.checkSource.data();\n            }\n\n            if (this.type === \"boolean\") {\n                this.createIsNullItem();\n                data = data.filter(boolDataFilter);\n            }\n\n            var template = kendo.template(options.itemTemplate(templateOptions));\n            var itemsHtml = kendo.render(template, data);\n\n            this.container.on(CHANGE + multiCheckNS, \":checkbox\", this.updateCheckAllState.bind(this));\n            this.container.prepend(itemsHtml);\n\n            if (options.checkAll && !this._isMobile) {\n                this.createCheckAllItem();\n            }\n        },\n        checkAll: function() {\n            var state = this.checkBoxAll.is(\":checked\");\n            this.container.find(\":checkbox\").prop(\"checked\", state);\n        },\n        checkValues: function(values) {\n            var that = this;\n\n            $($.grep(this.container.find(\":checkbox\").prop(\"checked\", false), function(ele) {\n                var found = false;\n                if ($(ele).is(\".k-check-all\")) {\n                    return;\n                }\n                var checkBoxVal = that._parse($(ele).val());\n                for (var i = 0; i < values.length; i++) {\n                    if (that.type == \"date\") {\n                        if (values[i] && checkBoxVal) {\n                            found = values[i].getTime() == checkBoxVal.getTime();\n                        } else if (values[i] === null && checkBoxVal === null) {\n                            found = true;\n                        } else {\n                            found = false;\n                        }\n                    } else {\n                        found = values[i] == checkBoxVal;\n                    }\n                    if (found) {\n                        return found;\n                    }\n                }\n            })).prop(\"checked\", true);\n            this.updateCheckAllState();\n        },\n\n        _mobileCheckAll: function(state) {\n            var that = this;\n            var checkboxes = that.container.find(\":checkbox\");\n\n            checkboxes.each(function(i, e) {\n                var checkbox = $(e);\n\n                checkbox.prop(\"checked\", state);\n                checkbox.trigger(\"change\");\n            });\n        },\n\n        _filter: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            var expression = { logic: \"or\" };\n\n            var that = this;\n            expression.filters = $.map(this.form.find(\":checkbox:checked:not(.k-check-all)\"), function(item) {\n                return { value: $(item).val(), operator: \"eq\", field: that.field };\n            });\n\n            if (this.trigger(\"change\", { filter: expression, field: that.field })) {\n                return;\n            }\n\n            expression = this._merge(expression);\n            if (expression.filters.length) {\n                this.dataSource.filter(expression);\n            } else {\n                that._removeFilter(that.dataSource.filter() || { filters: [] });\n            }\n\n            this._closeForm();\n        },\n\n        _stripFilters: function(filters) {\n           return $.grep(filters, function(filter) {\n                return filter.value != null;\n            });\n        },\n\n        _foreignKeyValues: function() {\n            var options = this.options;\n            return options.values && !options.checkSource;\n        },\n\n        destroy: function() {\n            var that = this;\n\n            Widget.fn.destroy.call(that);\n\n            if (that.form) {\n                kendo.unbind(that.form);\n                kendo.destroy(that.form);\n                that.form.off(multiCheckNS);\n                if (that.popup) {\n                    that.popup.destroy();\n                    that.popup = null;\n                }\n                that.form = null;\n                if (that.container) {\n                    that.container.off(multiCheckNS);\n                    that.container = null;\n                }\n\n                if (that.checkBoxAll) {\n                    that.checkBoxAll.off(multiCheckNS);\n                }\n            }\n\n            if (that.view) {\n                that.view.purge();\n                that.view = null;\n            }\n\n            if (that._link) {\n                that._link.off(NS);\n            }\n\n            if (that._refreshHandler) {\n                that.dataSource.unbind(CHANGE, that._refreshHandler);\n                that.dataSource = null;\n            }\n\n            if (that.checkChangeHandler) {\n                that.checkSource.unbind(CHANGE, that.checkChangeHandler);\n            }\n\n            if (that._progressHandler) {\n                that.checkSource.unbind(\"progress\", that._progressHandler);\n            }\n\n            if (that._progressHideHandler) {\n                that.checkSource.unbind(\"change\", that._progressHideHandler);\n            }\n\n            this._clearTypingTimeout();\n\n            if (this.searchTextBox) {\n                this.searchTextBox.off(multiCheckNS);\n                this.searchTextBox = null;\n            }\n\n            if (this.clearSearchButton) {\n                this.clearSearchButton.off(multiCheckNS);\n                this.clearSearchButton = null;\n            }\n\n            that.element = that.checkSource = that.container = that.checkBoxAll = that._link = that._refreshHandler = that.checkAllHandler = null;\n        },\n        options: {\n            name: \"FilterMultiCheck\",\n            itemTemplate: function(options) {\n                var field = options.field;\n                var format = options.format;\n                var valueField = options.valueField;\n                var mobile = options.mobile;\n                var valueFormat = \"\";\n\n                if (valueField === undefined) {\n                    valueField = field;\n                }\n                if (options.type == \"date\") {\n                    valueFormat = \":yyyy-MM-ddTHH:mm:sszzz\";\n                }\n\n                if (mobile) {\n                    return \"<li class='k-item k-listgroup-item'>\" +\n                            \"<label class='k-label k-listgroup-form-row k-checkbox-label'>\" +\n                                \"<span class='k-listgroup-form-field-label k-item-title '>#:kendo.format('\" + ( format ? format : \"{0}\" ) + \"', \" + field + \")#</span>\" +\n                                '<span class=\"k-listgroup-form-field-wrapper\">' +\n                                    \"<input type='checkbox' class='k-checkbox k-checkbox-md k-rounded-md' value='#:kendo.format('{0\" + valueFormat + \"}',\" + valueField + \")#'/>\" +\n                                '</span>' +\n                            \"</label>\" +\n                        \"</li>\";\n                }\n\n                return \"<li class='k-item'>\" +\n                        \"<label class='k-label k-checkbox-label'>\" +\n                            \"<input type='checkbox' class='k-checkbox k-checkbox-md k-rounded-md' value='#:kendo.format('{0\" + valueFormat + \"}',\" + valueField + \")#'/>\" +\n                            \"<span>#:kendo.format('\" + ( format ? format : \"{0}\" ) + \"', \" + field + \")#</span>\" +\n                        \"</label>\" +\n                    \"</li>\";\n            },\n            checkAll: true,\n            search: false,\n            ignoreCase: true,\n            appendToElement: false,\n            messages: {\n                checkAll: \"Select All\",\n                isNull: \"is empty\",\n                clearAll: \"Clear All\",\n                clear: \"Clear\",\n                filter: \"Filter\",\n                search: \"Search\",\n                cancel: \"Cancel\",\n                selectedItemsFormat: \"{0} items selected\",\n                done: \"Done\",\n                into: \"in\",\n                buttonTitle: \"{0} filter column settings\"\n            },\n            forceUnique: true,\n            animations: {\n                left: \"slide\",\n                right: \"slide:right\"\n            },\n            appendTo: null\n        },\n        events: [ INIT, REFRESH, \"change\", OPEN ]\n    });\n\n    function booleanFilterHandler(item) {\n        return item[this.field] !== null;\n    }\n\n    $.extend(FilterMultiCheck.fn, {\n        _click: FilterMenu.fn._click,\n        _keydown: FilterMenu.fn._keydown,\n        _reset: FilterMenu.fn._reset,\n        _closeForm: FilterMenu.fn._closeForm,\n        _removeFilter: FilterMenu.fn._removeFilter,\n        clear: FilterMenu.fn.clear,\n\n        _merge: FilterMenu.fn._merge\n    });\n\n    ui.plugin(FilterMenu);\n    ui.plugin(FilterMultiCheck);\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","depends","advanced","$","window","kendo","jQuery","undefined","ui","support","AUTOCOMPLETEVALUE","browser","chrome","POPUP","INIT","OPEN","REFRESH","CHANGE","NS","COLUMNHEADERATTR","EQ","NEQ","roles","number","date","mobileRoles","string","isFunction","Widget","booleanTemplate","modernBooleanTemplate","customBooleanTemplate","defaultTemplate","defaultMobileTemplate","booleanMobileTemplate","removeFiltersForField","expression","field","filters","grep","filter","length","convertItems","items","idx","item","value","text","result","clearFilter","expr","nested","FilterMenu","extend","init","element","options","that","this","type","operators","initial","columnHeader","componentType","fn","call","dataSource","DataSource","create","attr","closest","appendTo","find","link","_createLink","model","reader","_parse","fields","parse","bind","values","_defaultFilter","operator","_refreshHandler","refresh","appendToElement","_init","setUI","attrRole","role","pane","_isMobile","_createMobileForm","_createForm","form","on","_submit","_reset","removeClass","each","wrap","trigger","container","cycleForm","messages","title","html","template","_getTemplate","format","ns","extra","popup","anchor","copyAnchorStyles","open","_open","activate","_activate","close","closeCallback","data","append","_keydown","hasCustomTemplate","filterMenuGuid","guid","inputType","view","e","submit","preventDefault","_closeForm","_mobileClear","appendTarget","buttonTitle","addClass","_click","logic","defaultFilters","defaultOperator","push","filterModel","observable","children","first","roleAttribute","buttongroup","index","select","eq","set","_logicChangeHandler","_bind","valueAttribute","sender","current","destroy","unbind","off","purge","found","currentFilter","_stripFilters","_merge","clear","_removeFilter","viewElement","booleanRadioButton","booleanRadioButtonValue","val","prop","operatorSelects","i","input","valueInputs","andLogicRadio","stopPropagation","toJSON","containsFilters","_checkForNullOrEmptyFilter","currentExpression","firstNullOrEmpty","secondNullOrEmpty","search","parent","show","navigate","animations","right","left","toggle","not","keyCode","keys","ESC","events","neq","startswith","contains","doesnotcontain","endswith","isnull","isnotnull","isempty","isnotempty","isnullorempty","isnotnullorempty","gte","gt","lte","lt","enums","info","isTrue","isFalse","and","or","selectValue","additionalValue","additionalOperator","cancel","done","into","multiCheckNS","filterValuesForField","flatFilterValues","map","distinct","getter","seen","hasOwnProperty","removeDuplicates","dataSelector","dataTextField","multiCkeckMobileTemplate","FilterMultiCheck","checkSource","_foreignKeyValues","fetch","forceUnique","pageSize","toLowerCase","parseFloat","_link","serverPaging","_attachProgress","checkChangeHandler","empty","_filter","_progressHandler","progress","_progressHideHandler","_input","_clearTypingTimeout","_typingTimeout","setTimeout","_clearSearch","searchTextBox","clearTimeout","ignoreCase","searchString","labels","checkAll","parentNode","style","display","visibility","label","labelText","textContent","innerText","indexOf","selectedItemsFormat","_mobileCheckAll","kendoPopup","clearSearchButton","createCheckAllItem","itemTemplate","mobile","checkAllContainer","all","prepend","checkBoxAll","checkAllHandler","updateCheckAllState","state","createIsNullItem","valueField","isNullContainer","isNull","getFilterArray","toggleClass","action","autoSync","is","createCheckBoxes","checkValues","flatValues","templateOptions","boolDataFilter","booleanFilterHandler","_isServerGrouped","_flatData","itemsHtml","render","ele","checkBoxVal","getTime","checkboxes","checkbox","valueFormat","clearAll","plugin","amd","a1","a2","a3"],"mappings":"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"}