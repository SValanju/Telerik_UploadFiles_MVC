{"version":3,"file":"kendo.treelist.min.js","sources":["kendo.treelist.js"],"sourcesContent":["(function(f, define) {\n    define('kendo.treelist',[\n        \"kendo.dom\",\n        \"kendo.data\",\n        \"kendo.columnsorter\",\n        \"kendo.editable\",\n        \"kendo.window\",\n        \"kendo.filtermenu\",\n        \"kendo.columnmenu\",\n        \"kendo.selectable\",\n        \"kendo.resizable\",\n        \"kendo.treeview.draganddrop\",\n        \"kendo.pager\",\n        'kendo.filtercell'\n    ], f);\n})(function() {\n\nvar __meta__ = { // jshint ignore:line\n    id: \"treelist\",\n    name: \"TreeList\",\n    category: \"web\",\n    description: \"The TreeList widget displays self-referencing data and offers rich support for interacting with data, sorting, filtering, and selection.\",\n    depends: [ \"dom\", \"data\", \"pager\" ],\n    features: [ {\n        id: \"treelist-sorting\",\n        name: \"Sorting\",\n        description: \"Support for column sorting\",\n        depends: [ \"columnsorter\" ]\n    }, {\n        id: \"treelist-filtering\",\n        name: \"Filtering\",\n        description: \"Support for record filtering\",\n        depends: [ \"filtermenu\" ]\n    }, {\n        id: \"treelist-columnmenu\",\n        name: \"Column menu\",\n        description: \"Support for header column menu\",\n        depends: [ \"columnmenu\" ]\n    }, {\n        id: \"treelist-editing\",\n        name: \"Editing\",\n        description: \"Support for record editing\",\n        depends: [ \"editable\", \"window\" ]\n    }, {\n        id: \"treelist-selection\",\n        name: \"Selection\",\n        description: \"Support for row selection\",\n        depends: [ \"selectable\" ]\n    }, {\n        id: \"treelist-column-resize\",\n        name: \"Column resizing\",\n        description: \"Support for column resizing\",\n        depends: [ \"resizable\" ]\n    }, {\n        id: \"treelist-dragging\",\n        name: \"Drag & Drop\",\n        description: \"Support for drag & drop of rows\",\n        depends: [ \"treeview.draganddrop\" ]\n    }, {\n        id: \"treelist-excel-export\",\n        name: \"Excel export\",\n        description: \"Export data as Excel spreadsheet\",\n        depends: [ \"excel\" ]\n    }, {\n        id: \"treelist-pdf-export\",\n        name: \"PDF export\",\n        description: \"Export data as PDF\",\n        depends: [ \"pdf\", \"drawing\" ]\n    }, {\n        id: \"treelist-paging\",\n        name: \"Paging\",\n        description: \"Support for treelist paging\",\n        depends: [ \"pager\" ]\n    } ]\n};\n\n(function($, undefined) {\n    var data = kendo.data;\n    var kendoDom = kendo.dom;\n    var kendoDomElement = kendoDom.element;\n    var kendoTextElement = kendoDom.text;\n    var kendoHtmlElement = kendoDom.html;\n    var outerWidth = kendo._outerWidth;\n    var keys = kendo.keys;\n    var outerHeight = kendo._outerHeight;\n    var ui = kendo.ui;\n    var DataBoundWidget = ui.DataBoundWidget;\n    var DataSource = data.DataSource;\n    var ObservableArray = data.ObservableArray;\n    var Query = data.Query;\n    var Model = data.Model;\n    var browser = kendo.support.browser;\n    var kendoTemplate = kendo.template;\n    var activeElement = kendo._activeElement;\n    var touchDevice = kendo.support.touch;\n\n    var isArray = Array.isArray;\n    var extend = $.extend;\n    var map = $.map;\n    var grep = $.grep;\n    var inArray = $.inArray;\n    var isPlainObject = $.isPlainObject;\n\n    var push = Array.prototype.push;\n\n    var STRING = \"string\";\n    var CHANGE = \"change\";\n    var ITEM_CHANGE = \"itemChange\";\n    var ERROR = \"error\";\n    var PROGRESS = \"progress\";\n    var DOT = \".\";\n    var NS = \".kendoTreeList\";\n    var CLICK = \"click\";\n    var INPUT = \"input\";\n    var BEFORE_EDIT = \"beforeEdit\";\n    var EDIT = \"edit\";\n    var PAGE = \"page\";\n    var PAGE_CHANGE = \"pageChange\";\n    var SAVE = \"save\";\n    var SAVE_CHANGES = \"saveChanges\";\n    var SORT = \"sort\";\n    var EXPAND = \"expand\";\n    var COLLAPSE = \"collapse\";\n    var CELL_CLOSE = \"cellClose\";\n    var REMOVE = \"remove\";\n    var DATA_CELL = \"td:not(.k-group-cell):not(.k-hierarchy-cell):visible\";\n    var FILTER_CELL = \".k-filter-row th:not(.k-group-cell):not(.k-hierarchy-cell):visible\";\n    var DATABINDING = \"dataBinding\";\n    var DATABOUND = \"dataBound\";\n    var CANCEL = \"cancel\";\n    var TABINDEX = \"tabIndex\";\n    var FILTERMENUINIT = \"filterMenuInit\";\n    var FILTERMENUOPEN = \"filterMenuOpen\";\n    var COLUMNHIDE = \"columnHide\";\n    var COLUMNSHOW = \"columnShow\";\n    var HEADERCELLS = \"th.k-header\";\n    var COLUMNREORDER = \"columnReorder\";\n    var COLUMNRESIZE = \"columnResize\";\n    var COLUMNMENUINIT = \"columnMenuInit\";\n    var COLUMNMENUOPEN = \"columnMenuOpen\";\n    var COLUMNLOCK = \"columnLock\";\n    var COLUMNUNLOCK = \"columnUnlock\";\n    var PARENTIDFIELD = \"parentId\";\n    var DRAGSTART = \"dragstart\";\n    var DRAG = \"drag\";\n    var DROP = \"drop\";\n    var DRAGEND = \"dragend\";\n    var NAVROW = \"tr:visible\";\n    var NAVCELL = \"td:visible\";\n    var NAVHEADER = \"th:visible\";\n    var NORECORDSCLASS = \"k-grid-norecords\";\n    var ITEMROW = \"tr:not(.k-footer-template):visible\";\n    var isRtl = false;\n    var HEIGHT = \"height\";\n    var INCELL = \"incell\";\n    var INLINE = \"inline\";\n    var POPUP = \"popup\";\n    var TABLE = \"table\";\n    var CHECKBOX = \"k-checkbox\";\n    var CHECKBOXINPUT = \"input[data-role='checkbox'].\" + CHECKBOX;\n    var SELECTCOLUMNTMPL = '<input class=\"' + CHECKBOX + ' k-checkbox-md k-rounded-md\" data-role=\"checkbox\" aria-label=\"Select row\" aria-checked=\"false\" type=\"checkbox\">';\n    var SELECTCOLUMNHEADERTMPL = '<input class=\"' + CHECKBOX + ' k-checkbox-md k-rounded-md\" data-role=\"checkbox\" aria-label=\"Select all rows\" aria-checked=\"false\" type=\"checkbox\">';\n    var SELECTED = \"k-state-selected\";\n    var whitespaceRegExp = \"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\";\n    var filterRowRegExp = new RegExp(\"(^|\" + whitespaceRegExp + \")\" + \"(k-filter-row)\" + \"(\" + whitespaceRegExp + \"|$)\");\n\n    var classNames = {\n        wrapper: \"k-treelist k-grid k-widget k-grid-display-block\",\n        header: \"k-header\",\n        button: \"k-button\",\n        alt: \"k-alt\",\n        editCell: \"k-edit-cell\",\n        editRow: \"k-grid-edit-row\",\n        dirtyCell: \"k-dirty-cell\",\n        group: \"k-treelist-group\",\n        toolbar: \"k-toolbar\",\n        gridToolbar: \"k-grid-toolbar\",\n        gridHeader: \"k-grid-header\",\n        gridHeaderWrap: \"k-grid-header-wrap\",\n        gridContent: \"k-grid-content\",\n        gridContentWrap: \"k-grid-content\",\n        gridFilter: \"k-grid-filter\",\n        footerTemplate: \"k-footer-template\",\n        focused: \"k-state-focused\",\n        loading: \"k-i-loading\",\n        refresh: \"k-i-reload\",\n        retry: \"k-request-retry\",\n        selected: \"k-state-selected\",\n        status: \"k-status\",\n        link: \"k-link\",\n        filterable: \"k-filterable\",\n        icon: \"k-icon\",\n        iconFilter: \"k-i-filter\",\n        iconCollapse: \"k-i-collapse\",\n        iconExpand: \"k-i-expand\",\n        iconHidden: \"k-i-none\",\n        iconPlaceHolder: \"k-icon k-i-none\",\n        input: \"k-input\",\n        dropPositions: \"k-i-insert-up k-i-insert-down k-i-plus k-i-insert-middle\",\n        dropTop: \"k-i-insert-up\",\n        dropBottom: \"k-i-insert-down\",\n        dropAdd: \"k-i-plus\",\n        dropMiddle: \"k-i-insert-middle\",\n        dropDenied: \"k-i-cancel\",\n        dragStatus: \"k-drag-status\",\n        dragClue: \"k-drag-clue\",\n        dragClueText: \"k-clue-text\",\n        headerCellInner: \"k-cell-inner\",\n        columnTitle: \"k-column-title\"\n    };\n\n    var defaultCommands = {\n        create: {\n            imageClass: \"k-i-plus\",\n            className: \"k-grid-add\",\n            methodName: \"addRow\"\n        },\n        createchild: {\n            imageClass: \"k-i-plus\",\n            className: \"k-grid-add\",\n            methodName: \"addRow\"\n        },\n        destroy: {\n            imageClass: \"k-i-close\",\n            className: \"k-grid-delete\",\n            methodName: \"removeRow\"\n        },\n        edit: {\n            imageClass: \"k-i-edit\",\n            className: \"k-grid-edit\",\n            methodName: \"editRow\"\n        },\n        update: {\n            imageClass: \"k-i-check\",\n            className: \"k-button-solid-primary k-grid-update\",\n            methodName: \"saveRow\"\n        },\n        canceledit: {\n            imageClass: \"k-i-cancel\",\n            className: \"k-grid-cancel\",\n            methodName: \"_cancelEdit\"\n        },\n        cancel: {\n            imageClass: \"k-icon k-i-cancel\",\n            text: \"Cancel changes\",\n            className: \"k-grid-cancel-changes\",\n            methodName: \"cancelChanges\"\n        },\n        save: {\n            imageClass: \"k-icon k-i-check\",\n            text: \"Save changes\",\n            className: \"k-grid-save-changes\",\n            methodName: \"saveChanges\"\n        },\n        excel: {\n            imageClass: \"k-i-file-excel\",\n            className: \"k-grid-excel\",\n            methodName: \"saveAsExcel\"\n        },\n        pdf: {\n            imageClass: \"k-i-file-pdf\",\n            className: \"k-grid-pdf\",\n            methodName: \"saveAsPDF\"\n        },\n        search: {\n            template:\n            \"<span class='k-spacer'></span>\" +\n            \"<span class='k-searchbox k-input k-input-md k-rounded-md k-input-solid k-grid-search'>\" +\n                \"<span class='k-input-icon k-icon k-i-search'></span>\" +\n                \"<input autocomplete='off' placeholder='\" + \"#= message #\" + \"' title='\" + \"#= message #\" + \"' class='k-input-inner' />\" +\n            \"</span>\"\n        }\n    };\n\n    var TreeView = kendo.Class.extend({\n        init: function(data, options) {\n            var that = this;\n\n            that.data = data || [];\n            that.options = extend(that.options, options);\n        },\n\n        options: {\n            defaultParentId: null,\n            idField: \"id\",\n            parentIdField: PARENTIDFIELD\n        },\n\n        childrenMap: function() {\n            var that = this;\n            var childrenMap = {};\n            var dataLength = that.data.length;\n            var dataItem;\n            var dataItemId;\n            var dataItemParentId;\n            var idField = that.options.idField;\n            var parentIdField = that.options.parentIdField;\n\n            if (that._childrenMap) {\n                return that._childrenMap;\n            }\n\n            for (var i = 0; i < dataLength; i++) {\n                dataItem = this.data[i];\n                dataItemId = dataItem[idField];\n                dataItemParentId = dataItem[parentIdField];\n\n                childrenMap[dataItemId] = childrenMap[dataItemId] || [];\n                childrenMap[dataItemParentId] = childrenMap[dataItemParentId] || [];\n\n                childrenMap[dataItemParentId].push(dataItem);\n            }\n\n            that._childrenMap = childrenMap;\n\n            return childrenMap;\n        },\n\n        idsMap: function() {\n            var that = this;\n            var idsMap = {};\n            var data = that.data;\n            var dataLength = data.length;\n            var dataItem;\n            var idField = that.options.idField;\n\n            if (that._idMap) {\n                return that._idMap;\n            }\n\n            for (var i = 0; i < dataLength; i++) {\n                dataItem = data[i];\n                idsMap[dataItem[idField]] = dataItem;\n            }\n\n            that.idsMap = idsMap;\n            return idsMap;\n        },\n\n        dataMaps: function() {\n            var that = this;\n            var childrenMap = {};\n            var data = that.data;\n            var dataLength = data.length;\n            var idsMap = {};\n            var dataItem;\n            var dataItemId;\n            var dataItemParentId;\n            var idField = that.options.idField;\n            var parentIdField = that.options.parentIdField;\n\n            if (that._dataMaps) {\n                return that._dataMaps;\n            }\n\n            for (var i = 0; i < dataLength; i++) {\n                dataItem = data[i];\n                dataItemId = dataItem[idField];\n                dataItemParentId = dataItem[parentIdField];\n\n                idsMap[dataItemId] = dataItem;\n\n                childrenMap[dataItemId] = childrenMap[dataItemId] || [];\n                childrenMap[dataItemParentId] = childrenMap[dataItemParentId] || [];\n                childrenMap[dataItemParentId].push(dataItem);\n            }\n\n            that._dataMaps = {\n                children: childrenMap,\n                ids: idsMap\n            };\n\n            return that._dataMaps;\n        },\n\n        rootNodes: function() {\n            var that = this;\n            var data = that.data;\n            var defaultParentId = that.options.defaultParentId;\n            var dataLength = data.length;\n            var rootNodes = [];\n            var dataItem;\n            var parentIdField = that.options.parentIdField;\n\n            for (var i = 0; i < dataLength; i++) {\n                dataItem = data[i];\n\n                if (dataItem[parentIdField] === defaultParentId) {\n                    rootNodes.push(dataItem);\n                }\n            }\n\n            return rootNodes;\n        },\n\n        removeCollapsedSubtreesFromRootNodes: function(options) {\n            options = options || {};\n            var that = this;\n            var rootNodes = that.rootNodes();\n            var result = [];\n            var prunedTree;\n\n            that._childrenMap = options.childrenMap = options.childrenMap || that.childrenMap();\n            options.maxDepth = options.maxDepth || Infinity;\n\n            for (var i = 0; i < rootNodes.length; i++) {\n                prunedTree = that.removeCollapsedSubtrees(rootNodes[i], options);\n                result = result.concat(prunedTree);\n            }\n\n            return result;\n        },\n\n        removeCollapsedSubtrees: function(rootNode, options) {\n            options = options || {};\n            var that = this;\n            var result = [];\n            var childIdx;\n            var prunedTree;\n            var childrenMap = options.childrenMap || {};\n            var maxDepth = options.maxDepth || Infinity;\n            var idField = that.options.idField;\n            var children = childrenMap[rootNode[idField]] || [];\n            var expanded = isUndefined(rootNode.expanded) ? options.expanded : rootNode.expanded;\n\n            result.push(rootNode);\n\n            if (children && expanded) {\n                for (childIdx = 0; childIdx < children.length; childIdx++) {\n                    if (result.length >= maxDepth) {\n                        break;\n                    }\n\n                    prunedTree = that.removeCollapsedSubtrees(children[childIdx], options);\n                    result = result.concat(prunedTree);\n                }\n            }\n\n            return result;\n        }\n    });\n\n    var TreeQuery = function(data) {\n        this.data = data || [];\n    };\n\n    TreeQuery.prototype = new Query();\n    TreeQuery.prototype.constructor = TreeQuery;\n\n    TreeQuery.process = function(data, options, inPlace) {\n        options = options || {};\n        var query = new TreeQuery(data);\n        var group = options.group;\n        var sort = Query.normalizeGroup(group || []).concat(Query.normalizeSort(options.sort || []));\n        var filterCallback = options.filterCallback;\n        var filter = options.filter;\n        var skip = options.skip;\n        var take = options.take;\n        var total;\n        var childrenMap;\n        var filteredChildrenMap;\n        var view;\n        var prunedData;\n\n        if (sort && inPlace) {\n            query = query.sort(sort, undefined, undefined, inPlace);\n        }\n\n        if (filter) {\n            query = query.filter(filter);\n\n            if (filterCallback) {\n                query = filterCallback(query);\n            }\n\n            total = query.toArray().length;\n        }\n\n        if (sort && !inPlace) {\n            query = query.sort(sort);\n\n            if (group) {\n                data = query.toArray();\n            }\n        }\n\n        if (options.processFromRootNodes) {\n            view = new TreeView(query.toArray(), options);\n\n            if (filter) {\n                filteredChildrenMap = view.childrenMap();\n            }\n\n            prunedData = view.removeCollapsedSubtreesFromRootNodes({\n                // filtering or sorting requires changes to childrenMap\n                childrenMap: filter || (sort && sort.length) ? undefined : options.childrenMap,\n                expanded: options.expanded,\n                maxDepth: (skip + take) || Infinity\n            });\n\n            childrenMap = view.childrenMap();\n\n            query = new TreeQuery(prunedData);\n        }\n\n        if (skip !== undefined && take !== undefined) {\n            query = query.range(skip, take);\n        }\n\n        if (group) {\n            query = query.group(group, data);\n        }\n\n        return {\n            total: total,\n            data: query.toArray(),\n            childrenMap: childrenMap,\n            filteredChildrenMap: filteredChildrenMap\n        };\n    };\n\n    var TreeListModel = Model.define({\n        id: \"id\",\n\n        parentId: PARENTIDFIELD,\n\n        fields: {\n            id: { type: \"number\" },\n            parentId: { type: \"number\", nullable: true }\n        },\n\n        init: function(value) {\n            Model.fn.init.call(this, value);\n\n            this._loaded = false;\n\n            if (!this.parentIdField) {\n                this.parentIdField = PARENTIDFIELD;\n            }\n\n            this.parentId = this.get(this.parentIdField);\n        },\n\n        accept: function(data) {\n            Model.fn.accept.call(this, data);\n\n            this.parentId = this.get(this.parentIdField);\n        },\n\n        set: function(field, value, initiator) {\n            if (field == PARENTIDFIELD && this.parentIdField != PARENTIDFIELD) {\n                this[this.parentIdField] = value;\n            }\n\n            Model.fn.set.call(this, field, value, initiator);\n\n            if (field == this.parentIdField) {\n                this.parentId = this.get(this.parentIdField);\n            }\n        },\n\n        loaded: function(value) {\n            if (value !== undefined) {\n                this._loaded = value;\n            } else {\n                return this._loaded;\n            }\n        },\n\n        shouldSerialize: function(field) {\n            return Model.fn.shouldSerialize.call(this, field) && field !== \"_loaded\" && field != \"_error\" && field != \"_edit\" && !(this.parentIdField !== \"parentId\" && field === \"parentId\");\n        }\n    });\n\n    TreeListModel.parentIdField = PARENTIDFIELD;\n\n    TreeListModel.define = function(base, options) {\n        if (options === undefined) {\n            options = base;\n            base = TreeListModel;\n        }\n\n        var parentId = options.parentId || PARENTIDFIELD;\n\n        options.parentIdField = parentId;\n\n        var model = Model.define(base, options);\n\n        if (parentId) {\n            model.parentIdField = parentId;\n        }\n\n        return model;\n    };\n\n    function is(field) {\n        return function(object) {\n            return object[field];\n        };\n    }\n\n    function not(func) {\n        return function(object) {\n            return !func(object);\n        };\n    }\n\n    var TreeListDataSource = DataSource.extend({\n        init: function(options) {\n            options = options || {};\n            var that = this;\n            that._dataMaps = that._getDataMaps();\n\n            options.schema = extend(true, {}, {\n                modelBase: TreeListModel,\n                model: TreeListModel\n            }, options.schema);\n\n            DataSource.fn.init.call(this, options);\n        },\n\n        _addRange: function() {\n            // empty override for performance - the treelist does not support virtualization\n        },\n\n        _createNewModel: function(data) {\n            var that = this;\n            var model = {};\n            var fromModel = data instanceof Model;\n            var parentIdField = this._modelParentIdField();\n\n            if (fromModel) {\n                model = data;\n            }\n\n            model = DataSource.fn._createNewModel.call(this, model);\n\n            if (!fromModel) {\n                if (data.parentId) {\n                    data[model.parentIdField] = data.parentId;\n                } else if (that._isPageable() && data[parentIdField]) {\n                    data[model.parentIdField] = data[parentIdField];\n                }\n\n                model.accept(data);\n            }\n\n            return model;\n        },\n\n        _shouldWrap: function() {\n            return true;\n        },\n\n        _push: function(result, operation) {\n            var data = DataSource.fn._readData.call(this, result);\n\n            if (!data) {\n                data = result;\n            }\n\n            this[operation](data);\n        },\n\n        _getData: function() {\n            // do not use .data(), which wraps the data items\n            return this._data || [];\n        },\n\n        _readData: function(newData) {\n            var that = this;\n            var data = that._isPageable() ? that._getData().toJSON() : that.data();\n\n            newData = DataSource.fn._readData.call(this, newData);\n\n            this._replaceData(((data.toJSON ? data.toJSON() : data)).concat(newData), data);\n\n            if (newData instanceof ObservableArray) {\n                return newData;\n            }\n\n            return data;\n        },\n\n        _replaceData: function(source, target) {\n            var sourceLength = source.length;\n\n            for (var i = 0; i < sourceLength; i++) {\n                target[i] = source[i];\n            }\n\n            target.length = sourceLength;\n        },\n\n        _readAggregates: function(data) {\n            var result = extend(this._aggregateResult, this.reader.aggregates(data));\n            if (\"\" in result) {\n                result[this._defaultParentId()] = result[\"\"];\n                delete result[\"\"];\n            }\n\n            return result;\n        },\n\n        read: function(data) {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._dataMaps = {};\n                if (!that._modelOptions().expanded) {\n                    that._skip = 0;\n                    that._page = 1;\n                    that._collapsedTotal = undefined;\n                }\n            }\n\n            return DataSource.fn.read.call(that, data);\n        },\n\n        remove: function(root) {\n            this._removeChildData(root);\n\n            this._removeFromDataMaps(root);\n\n            return DataSource.fn.remove.call(this, root);\n        },\n\n        _removeChildData: function(model, removePristine) {\n            var that = this;\n            var pageable = that._isPageable();\n            var data = pageable ? this._getData() : this.data();\n            var childrenMap = pageable ? that._getChildrenMap() || that.childrenMap(data) : that._childrenMap(data);\n            var items = this._subtree(childrenMap, model.id);\n            var shouldRemovePristine = isUndefined(removePristine) ? false : removePristine;\n\n            var removedItems = this._removeItems(items, shouldRemovePristine);\n\n            that._removeFromDataMaps(removedItems);\n        },\n\n        pushDestroy: function(items) {\n            var that = this;\n\n            if (!isArray(items)) {\n                items = [items];\n            }\n\n            for (var i = 0; i < items.length; i++) {\n                that._removeChildData(items[i], true);\n                that._removeFromDataMaps(items[i]);\n            }\n\n            DataSource.fn.pushDestroy.call(that, items);\n        },\n\n        insert: function(index, model) {\n            var that = this;\n            var newModel = that._createNewModel(model);\n\n            that._insertInDataMaps(newModel);\n\n            return DataSource.fn.insert.call(that, index, newModel);\n        },\n\n        _filterCallback: function(query) {\n            var that = this;\n            var i, item;\n            var map = {};\n            var result = [];\n            var data = query.toArray();\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var pageable = that._isPageable();\n            var parentSubtree = [];\n            var parent;\n\n            for (i = 0; i < data.length; i++) {\n                item = data[i];\n\n                if (pageable) {\n                    // return view from root nodes to child nodes\n                    parentSubtree = [];\n\n                    if (!map[item[idField]]) {\n                        map[item[idField]] = true;\n                        parentSubtree.push(item);\n                    }\n\n                    parent = that._parentNode(item);\n\n                    while (parent) {\n                        if (!map[parent[idField]]) {\n                            map[parent[idField]] = true;\n                            parentSubtree.unshift(parent);\n                            parent = that._parentNode(parent);\n                        } else {\n                            // the parent chain is already processed\n                            break;\n                        }\n                    }\n\n                    if (parentSubtree.length) {\n                        result = result.concat(parentSubtree);\n                    }\n                } else {\n                    while (item) {\n                        if (!map[item[idField]]) {\n                            map[item[idField]] = true;\n                            result.push(item);\n                        }\n\n                        if (!map[item[parentIdField]]) {\n                            map[item[parentIdField]] = true;\n                            item = this.parentNode(item);\n\n                            if (item) {\n                                result.push(item);\n                            }\n                        } else {\n                            break;\n                        }\n                    }\n                }\n            }\n\n            return new Query(result);\n        },\n\n        _subtree: function(map, id) {\n            var that = this;\n            var result = map[id] || [];\n            var defaultParentId = that._defaultParentId();\n            var idField = that._modelIdField();\n\n            for (var i = 0, len = result.length; i < len; i++) {\n                if (result[i][idField] !== defaultParentId) {\n                    result = result.concat(that._subtree(map, result[i][idField]));\n                }\n            }\n\n            return result;\n        },\n\n        // builds hash id -> children\n        _childrenMap: function(data) {\n            var map = {};\n            var i, item, id, parentId;\n\n            data = this._observeView(data);\n\n            for (i = 0; i < data.length; i++) {\n                item = data[i];\n                id = item.id;\n                parentId = item.parentId;\n\n                map[id] = map[id] || [];\n                map[parentId] = map[parentId] || [];\n                map[parentId].push(item);\n            }\n\n            return map;\n        },\n\n        childrenMap: function(data) {\n            var view = this._createTreeView(data);\n            var map = view.childrenMap();\n            return map;\n        },\n\n        _getChildrenMap: function() {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            return dataMaps.children;\n        },\n\n        _initIdsMap: function(data) {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n\n            if (isUndefined(dataMaps.ids)) {\n                dataMaps.ids = that._idsMap(data);\n            }\n\n            return dataMaps.ids;\n        },\n\n        _idsMap: function(data) {\n            var view = this._createTreeView(data);\n            var map = view.idsMap();\n            return map;\n        },\n\n        _getIdsMap: function() {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            return dataMaps.ids || {};\n        },\n\n        _getFilteredChildrenMap: function() {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            return dataMaps.filteredChildren;\n        },\n\n        _setFilteredChildrenMap: function(map) {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            dataMaps.filteredChildren = map;\n        },\n\n        _initDataMaps: function(data) {\n            var that = this;\n            var view = that._createTreeView(data);\n\n            that._dataMaps = view.dataMaps();\n\n            return that._dataMaps;\n        },\n\n        _initChildrenMapForParent: function(parent) {\n            var that = this;\n            var data = that._getData();\n            var childrenMap = that._getChildrenMap();\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var parentId = (parent || {})[idField];\n\n            if (childrenMap && parent) {\n                childrenMap[parentId] = [];\n\n                for (var i = 0; i < data.length; i++) {\n                    if (data[i][parentIdField] === parentId) {\n                        childrenMap[parentId].push(data[i]);\n                    }\n                }\n            }\n        },\n\n        _getDataMaps: function() {\n            var that = this;\n            that._dataMaps = that._dataMaps || {};\n            return that._dataMaps;\n        },\n\n        _createTreeView: function(data, options) {\n            var view = new TreeView(data, extend(options, this._defaultTreeModelOptions()));\n            return view;\n        },\n\n        _defaultTreeModelOptions: function() {\n            var that = this;\n            var modelOptions = that._modelOptions();\n\n            return {\n                defaultParentId: that._defaultParentId(),\n                idField: that._modelIdField(),\n                parentIdField: that._modelParentIdField(),\n                expanded: modelOptions.expanded\n            };\n        },\n\n        _defaultDataItemType: function() {\n            return this.reader.model || kendo.data.ObservableObject;\n        },\n\n        _calculateAggregates: function(data, options) {\n            options = options || {};\n            var that = this;\n            var result = {};\n            var item, subtree, i;\n            var filter = options.filter;\n            var skip = options.skip;\n            var take = options.take;\n            var maxDepth = !isUndefined(skip) && !isUndefined(take) ? (skip + take) : Infinity;\n            var pageable = that._isPageable();\n            var filteredChildrenMap = options.filteredChildrenMap;\n            var childrenMap = options.childrenMap;\n            var pageableChildrenMap;\n\n            if (pageable) {\n                if (isUndefined(options.aggregate)) {\n                    return result;\n                }\n\n                if (filteredChildrenMap) {\n                    pageableChildrenMap = filteredChildrenMap;\n                } else if (childrenMap) {\n                    pageableChildrenMap = childrenMap;\n                } else {\n                    pageableChildrenMap = that.childrenMap(that._getData());\n                }\n            }\n\n            if (!pageable && filter) {\n                data = Query.process(data, {\n                    filter: filter,\n                    filterCallback: this._filterCallback.bind(this)\n                }).data;\n            }\n\n            var map = pageable ? pageableChildrenMap : that._childrenMap(data);\n\n            // calculate aggregates for each subtree\n            result[this._defaultParentId()] = new Query(this._subtree(map, this._defaultParentId())).aggregate(options.aggregate);\n\n            for (i = 0; i < data.length; i++) {\n                if (i >= maxDepth) {\n                    break;\n                }\n\n                item = data[i];\n                subtree = this._subtree(map, item.id);\n\n                result[item.id] = new Query(subtree).aggregate(options.aggregate);\n            }\n\n            return result;\n        },\n\n        _queryProcess: function(data, options) {\n            var that = this;\n            var result = {};\n            options = options || {};\n            options.filterCallback = this._filterCallback.bind(this);\n\n            if (that._isPageable()) {\n                return that._processPageableQuery(data, options);\n            } else {\n                var defaultParentId = this._defaultParentId();\n                result = Query.process(data, options);\n                var map = this._childrenMap(result.data);\n                var hasLoadedChildren, i, item, children;\n\n                data = map[defaultParentId] || [];\n\n                for (i = 0; i < data.length; i++) {\n                    item = data[i];\n\n                    if (item.id === defaultParentId) {\n                        continue;\n                    }\n\n                    children = map[item.id];\n                    hasLoadedChildren = !!(children && children.length);\n\n                    if (!item.loaded()) {\n                        item.loaded(hasLoadedChildren || !item.hasChildren);\n                    }\n\n                    if (item.loaded() || item.hasChildren !== true) {\n                        item.hasChildren = hasLoadedChildren;\n                    }\n\n                    if (hasLoadedChildren) {\n                        //cannot use splice due to IE8 bug\n                        data = data.slice(0, i + 1).concat(children, data.slice(i + 1));\n                    }\n                }\n\n                result.data = data;\n            }\n\n            return result;\n        },\n\n        _processPageableQuery: function(data, options) {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            var result;\n            var filteredChildrenMap;\n\n            if (that._getData() !== data || !dataMaps.children || !dataMaps.ids) {\n                dataMaps = that._initDataMaps(that._getData());\n            }\n\n            options.childrenMap = dataMaps.children || {};\n            options.idsMap = dataMaps.ids || {};\n\n            result = that._processTreeQuery(data, options);\n\n            that._replaceWithObservedData(result.data, data);\n\n            that._processDataItemsState(result.data, result.childrenMap);\n\n            that._replaceItemsInDataMaps(result.data);\n\n            result.dataToAggregate = that._dataToAggregate(result.data, options);\n\n            if (options.filter || that.filter()) {\n                filteredChildrenMap = result.filteredChildrenMap;\n                that._replaceInMapWithObservedData(filteredChildrenMap, data);\n                that._setFilteredChildrenMap(filteredChildrenMap);\n                options.filteredChildrenMap = filteredChildrenMap;\n                that._calculateCollapsedTotal(result.data);\n            } else {\n                that._collapsedTotal = undefined;\n            }\n\n            return result;\n        },\n\n        _dataToAggregate: function(data) {\n            var that = this;\n            var firstDataItem = data[0] || {};\n            var firstItemParents = that._parentNodes(firstDataItem);\n            var dataToAggregate = firstItemParents.concat(data);\n\n            return dataToAggregate;\n        },\n\n        _replaceItemsInDataMaps: function(observableArray) {\n            var that = this;\n            var view = isArray(observableArray) ? observableArray : [observableArray];\n            var itemType = that._defaultDataItemType();\n            var defaultParentId = that._defaultParentId();\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var dataMaps = that._getDataMaps();\n            var item;\n            var parents;\n            var directParent;\n\n            for (var viewIndex = 0; viewIndex < view.length; viewIndex++) {\n                item = view[viewIndex];\n\n                if (!(item instanceof itemType)) {\n                    continue;\n                }\n\n                that._insertInIdsMap(item);\n\n                parents = that._parentNodes(item);\n                directParent = parents && parents.length ? parents[parents.length - 1] : undefined;\n\n                if (item[parentIdField] === defaultParentId) {\n                    that._replaceInMap(dataMaps.children, defaultParentId, item, itemType);\n                } else if (directParent) {\n                    that._replaceInMap(dataMaps.children, directParent[idField], item, itemType);\n                }\n            }\n        },\n\n        _replaceInMap: function(map, id, replacement, itemType) {\n            var idField = this._modelIdField();\n            map[id] = map[id] || [];\n            itemType = itemType || this._defaultDataItemType();\n\n            var itemInArray = map[id].filter(function(element) {\n                return replacement[idField] === element[idField];\n            })[0];\n\n            var itemIndex = itemInArray ? map[id].indexOf(itemInArray) : -1;\n\n            if (itemIndex !== -1 && !(itemInArray instanceof itemType)) {\n                map[id][itemIndex] = replacement;\n            }\n        },\n\n        _replaceWithObservedData: function(dataToReplace, replacementArray) {\n            var that = this;\n            var idsMap = that._getDataMaps().ids || {};\n            var idField = that._modelIdField();\n            var itemType = that._defaultDataItemType();\n            var itemToReplace;\n            var itemToReplaceId;\n            var dataItem;\n            var dataItemIndex;\n            var observableItem;\n\n            for (var i = 0; i < dataToReplace.length; i++) {\n                itemToReplace = dataToReplace[i];\n                itemToReplaceId = itemToReplace[idField];\n\n                if (!(itemToReplace instanceof itemType)) {\n                    if (!(idsMap[itemToReplaceId] instanceof itemType)) {\n                        dataItem = that._getById(itemToReplaceId);\n                        dataItemIndex = replacementArray.indexOf(dataItem);\n\n                        if (dataItem && dataItemIndex !== -1) {\n                            observableItem = replacementArray.at(dataItemIndex);\n                            dataToReplace[i] = observableItem;\n                        }\n                    } else {\n                        dataToReplace[i] = idsMap[itemToReplaceId];\n                    }\n                }\n            }\n        },\n\n        _replaceInMapWithObservedData: function(map, replacementArray) {\n            var that = this;\n\n            for (var key in map) {\n                that._replaceWithObservedData(map[key], replacementArray);\n            }\n        },\n\n        _insertInDataMaps: function(item) {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._insertInIdsMap(item);\n                that._insertInChildrenMap(item);\n            }\n        },\n\n        _insertInIdsMap: function(item) {\n            var that = this;\n            var idsMap = that._getIdsMap();\n            var idField = that._modelIdField();\n\n            if (!isUndefined(item[idField])) {\n                idsMap[item[idField]] = item;\n            }\n        },\n\n        _insertInChildrenMap: function(item, index) {\n            var that = this;\n            var childrenMap = that._getChildrenMap() || {};\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var itemId = item[idField];\n            var parentId = item[parentIdField];\n            index = index || 0;\n\n            childrenMap[itemId] = childrenMap[itemId] || [];\n            childrenMap[parentId] = childrenMap[parentId] || [];\n            childrenMap[parentId].splice(index, 0, item);\n        },\n\n        _removeFromDataMaps: function(items) {\n            var that = this;\n            items = isArray(items) ? items : [items];\n\n            if (that._isPageable()) {\n                for (var i = 0; i < items.length; i++) {\n                    that._removeFromIdsMap(items[i]);\n                    that._removeFromChildrenMap(items[i]);\n                }\n            }\n        },\n\n        _removeFromIdsMap: function(item) {\n            var that = this;\n            var idsMap = that._getIdsMap();\n            var idField = that._modelIdField();\n\n            if (!isUndefined(item[idField])) {\n                idsMap[item[idField]] = undefined;\n            }\n        },\n\n        _removeFromChildrenMap: function(item) {\n            var that = this;\n            var childrenMap = that._getChildrenMap() || {};\n            var parentIdField = that._modelParentIdField();\n            var parentId = item[parentIdField];\n\n            childrenMap[parentId] = childrenMap[parentId] || [];\n\n            var itemIndex = that._indexInChildrenMap(item);\n\n            if (itemIndex !== -1) {\n                childrenMap[parentId].splice(itemIndex, 1);\n            }\n        },\n\n        _indexInChildrenMap: function(item) {\n            var that = this;\n            return that._itemIndexInMap(item, that._getChildrenMap());\n        },\n\n        _itemIndexInMap: function(item, dataMap) {\n            var that = this;\n            var map = dataMap || {};\n            var parentIdField = that._modelParentIdField();\n            var parentId = item[parentIdField];\n\n            map[parentId] = map[parentId] || [];\n\n            var itemInArray = map[parentId].filter(function(element) {\n                return item.uid === element.uid;\n            })[0];\n\n            var itemIndex = itemInArray ? map[parentId].indexOf(itemInArray) : -1;\n\n            return itemIndex;\n        },\n\n        _getById: function(id) {\n            var that = this;\n            var idField = that._modelIdField();\n            var data = that._getData();\n\n            for (var i = 0; i < data.length; i++) {\n                if (data[i][idField] === id) {\n                    return data[i];\n                }\n            }\n        },\n\n        _isLastItemInView: function(dataItem) {\n            var view = this.view();\n            return view.length && view[view.length - 1] === dataItem;\n        },\n\n        _defaultPageableQueryOptions: function() {\n            var that = this;\n            var dataMaps = that._getDataMaps();\n            var options = {\n                skip: that.skip(),\n                take: that.take(),\n                page: that.page(),\n                pageSize: that.pageSize(),\n                sort: that.sort(),\n                filter: that.filter(),\n                group: that.group(),\n                aggregate: that.aggregate(),\n                filterCallback: that._filterCallback.bind(that),\n                childrenMap: dataMaps.children,\n                idsMap: dataMaps.ids\n            };\n\n            return options;\n        },\n\n        _isPageable: function() {\n            var pageSize = this.pageSize();\n            return (!isUndefined(pageSize) && pageSize > 0 && !this.options.serverPaging);\n        },\n\n        _updateTotalForAction: function(action, items) {\n            var that = this;\n\n            DataSource.fn._updateTotalForAction.call(that, action, items);\n\n            if (that._isPageable()) {\n                that._updateCollapsedTotalForAction(action, items);\n            }\n        },\n\n        _updateCollapsedTotalForAction: function(action, items) {\n            var that = this;\n            var total = parseInt(that._collapsedTotal, 10);\n\n            if (!isNumber(that._collapsedTotal)) {\n                that._calculateCollapsedTotal();\n                return;\n            }\n\n            if (action === \"add\") {\n                total += items.length;\n            } else if (action === \"remove\") {\n                total -= items.length;\n            } else if (action !== \"itemchange\" && action !== \"sync\" && !that.options.serverPaging) {\n                total = that._calculateCollapsedTotal();\n            } else if (action === \"sync\") {\n                total = that._calculateCollapsedTotal();\n            }\n\n            that._collapsedTotal = total;\n        },\n\n        _setFilterTotal: function(filterTotal, setDefaultValue) {\n            var that = this;\n\n            DataSource.fn._setFilterTotal.call(that, filterTotal, setDefaultValue);\n\n        },\n\n        collapsedTotal: function() {\n            var that = this;\n\n            if (!isUndefined(that._collapsedTotal)) {\n                return that._collapsedTotal;\n            }\n\n            return that._calculateCollapsedTotal();\n        },\n\n        _calculateCollapsedTotal: function(filteredData) {\n            var that = this;\n            var data = that._dataWithoutCollapsedSubtrees(filteredData);//\n\n            if (data.length) {\n                that._collapsedTotal = data.length;\n            }\n\n            return that._collapsedTotal;\n        },\n\n        _dataWithoutCollapsedSubtrees: function(filteredData) {\n            return this._removeCollapsedSubtrees(filteredData || this._getData());\n        },\n\n        _removeCollapsedSubtrees: function(data) {\n            var that = this;\n            var view = that._createTreeView(data);\n            var result = view.removeCollapsedSubtreesFromRootNodes({\n                expanded: that._modelOptions().expanded,\n                childrenMap: that.filter() ? that._getFilteredChildrenMap() : that._getChildrenMap()\n            });\n\n            return result;\n        },\n\n        _processTreeQuery: function(data, options) {\n            var result = TreeQuery.process(data, extend(options, this._defaultTreeModelOptions(), {\n                processFromRootNodes: true\n            }));\n\n            return result;\n        },\n\n        _processDataItemsState: function(data, childrenMap) {\n            var dataLength = data.length;\n            var i;\n\n            for (i = 0; i < dataLength; i++) {\n                this._processDataItemState(data[i], childrenMap);\n            }\n        },\n\n        _processDataItemState: function(dataItem, childrenMap) {\n            var defaultParentId = this._defaultParentId();\n\n            if (dataItem.id === defaultParentId) {\n                return;\n            }\n\n            var children = childrenMap[dataItem.id] || [];\n            var hasLoadedChildren = !!(children && children.length);\n\n            if (!dataItem.loaded) {\n                return;\n            }\n\n            if (!dataItem.loaded()) {\n                dataItem.loaded(hasLoadedChildren || !dataItem.hasChildren);\n            }\n\n            if (dataItem.loaded() || dataItem.hasChildren !== true) {\n                dataItem.hasChildren = hasLoadedChildren;\n            }\n        },\n\n        _queueRequest: function(options, callback) {\n            // allow simultaneous requests (loading multiple items at the same time)\n            callback.call(this);\n        },\n\n        _modelLoaded: function(id) {\n            var model = this.get(id);\n            model.loaded(true);\n            model.hasChildren = this.childNodes(model).length > 0;\n        },\n\n        _modelError: function(id, e) {\n            this.get(id)._error = e;\n        },\n\n        success: function(data, requestParams) {\n            if (!requestParams || typeof requestParams.id == \"undefined\") {\n                this._data = this._observe([]);\n            }\n\n            DataSource.fn.success.call(this, data, requestParams);\n\t\t\tthis._total = this._data.length;\n        },\n\n        load: function(model) {\n            var method = \"_query\";\n            var remote = this.options.serverSorting || this.options.serverPaging || this.options.serverFiltering || this.options.serverGrouping || this.options.serverAggregates;\n            var defaultPromise = $.Deferred().resolve().promise();\n\n            if (model.loaded()) {\n                if (remote) {\n                    return defaultPromise;\n                }\n            } else if (model.hasChildren) {\n                method = \"read\";\n                this._removeChildData(model);\n            }\n\n            return this[method]({ id: model.id })\n                .done(this._modelLoaded.bind(this, model.id))\n                .fail(this._modelError.bind(this, model.id));\n        },\n\n        contains: function(root, child) {\n            var that = this;\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var rootId = root[idField];\n            var pageable = that._isPageable();\n\n            while (child) {\n                if (child[parentIdField] === rootId) {\n                    return true;\n                }\n\n                child = pageable ? that._parentNode(child) : that.parentNode(child);\n            }\n\n            return false;\n        },\n\n        _byParentId: function(id, defaultId) {\n            var result = [];\n            var view = this.view();\n            var current;\n\n            if (id === defaultId) {\n                return [];\n            }\n\n            for (var i = 0; i < view.length; i++) {\n                current = view.at(i);\n\n                if (current.parentId == id) {\n                    result.push(current);\n                }\n            }\n\n            return result;\n        },\n\n        _defaultParentId: function() {\n            return this.reader.model.fn.defaults[this.reader.model.parentIdField];\n        },\n\n        _modelOptions: function() {\n            var modelOptions = ((this.options.schema || {}).model || {});\n            return modelOptions;\n        },\n\n        _modelIdField: function() {\n            var modelOptions = this._modelOptions();\n            return modelOptions.id || \"id\";\n        },\n\n        _modelParentIdField: function() {\n            var modelOptions = this._modelOptions();\n            return modelOptions.parentId || PARENTIDFIELD;\n        },\n\n        childNodes: function(model) {\n            return this._byParentId(model.id, this._defaultParentId());\n        },\n\n        allChildNodes: function(model, result) {\n            var directChildren = this.data().filter(function(item) {\n                return item.parentId === model.id;\n            });\n\n            for (var i = 0; i < directChildren.length; i++) {\n                result.push(directChildren[i]);\n                this.allChildNodes(directChildren[i], result);\n            }\n        },\n\n        rootNodes: function() {\n            return this._byParentId(this._defaultParentId());\n        },\n\n        _rootNode: function(child) {\n            return this._parentNodes(child)[0];\n        },\n\n        _pageableRootNodes: function(options) {\n            options = options || {};\n            var that = this;\n            var defaultParentId = that._defaultParentId();\n            var parentIdField = that._modelParentIdField();\n            var result = [];\n            var nodesWithoutParentInView = that._nodesWithoutParentInView(options);\n            var node;\n            var root;\n\n            for (var i = 0; i < nodesWithoutParentInView.length; i++) {\n                node = nodesWithoutParentInView[i];\n\n                if (node[parentIdField] === defaultParentId) {\n                    result.push(node);\n                } else {\n                    root = that._rootNode(node);\n\n                    if (root && result.indexOf(root) === -1) {\n                        result.push(root);\n                    }\n                }\n            }\n\n            return result;\n        },\n\n        parentNode: function(model) {\n            return this.get(model.parentId);\n        },\n\n        _parentNode: function(child) {\n            var that = this;\n            var parentIdField = that._modelParentIdField();\n            var idsMap = that._initIdsMap(that._getData());\n            var parentId = child[parentIdField];\n            var parent = idsMap[parentId] || that._getById(parentId);\n\n            return parent;\n        },\n\n        _parentNodes: function(child) {\n            var that = this;\n            var parent = that._parentNode(child);\n            var parents = [];\n\n            while (parent) {\n                parents.unshift(parent);\n                parent = that._parentNode(parent);\n            }\n\n            return parents;\n        },\n\n        _parentNodesNotInView: function() {\n            var that = this;\n            var view = that.view();\n            var result = [];\n            var defaultParentId = that._defaultParentId();\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var parentInView;\n            var parents = [];\n            var directParent;\n            var dataItem;\n            var dataItemId;\n            var dataItemParentId;\n\n            for (var i = 0; i < view.length; i++) {\n                dataItem = view[i];\n                dataItemId = dataItem[idField];\n                dataItemParentId = dataItem[parentIdField];\n                parentInView = that._parentInView(dataItemParentId);\n\n                if (!parentInView && dataItemParentId !== defaultParentId) {\n                    parents = that._parentNodes(dataItem);\n\n                    directParent = parents && parents.length ? parents[parents.length - 1] : that._getById(dataItemParentId);\n\n                    if (directParent && result.indexOf(directParent) === -1) {\n                        result.push(directParent);\n                    }\n                }\n            }\n\n            return result;\n        },\n\n        _nodesWithoutParentInView: function(options) {\n            options = options || {};\n            var that = this;\n            var view = that.view();\n            var childrenMap = options.childrenMap || that.childrenMap(that._getData());\n            var idField = that._modelIdField();\n            var parentIdField = that._modelParentIdField();\n            var dataItem;\n            var parentInView;\n            var children = [];\n            var result = [];\n\n            for (var i = 0; i < view.length; i++) {\n                dataItem = view[i];\n                children = childrenMap[dataItem[idField]];\n                parentInView = that._parentInView(dataItem[parentIdField]);\n\n                if (!parentInView) {\n                    result.push(dataItem);\n                }\n            }\n\n            return result;\n        },\n\n        _parentInView: function(parentId) {\n            var view = this.view();\n\n            for (var i = 0; i < view.length; i++) {\n                if (view[i].id === parentId) {\n                    return view[i];\n                }\n            }\n        },\n\n        level: function(model) {\n            var result = -1;\n\n            if (!(model instanceof TreeListModel)) {\n                model = this.get(model);\n            }\n\n            do {\n                model = this.parentNode(model);\n                result++;\n            } while (model);\n\n            return result;\n        },\n\n        _pageableModelLevel: function(model) {\n            var that = this;\n\n            if (!model || !that._isPageable()) {\n                return 0;\n            }\n\n            var parents = that._parentNodes(model);\n\n            return parents.length;\n        },\n\n        filter: function(value) {\n            var baseFilter = DataSource.fn.filter;\n\n            if (value === undefined) {\n                return baseFilter.call(this, value);\n            }\n\n            baseFilter.call(this, value);\n        },\n\n        _pageableQueryOptions: function(options) {\n            var dataMaps = this._getDataMaps();\n\n            options.childrenMap = dataMaps.children;\n            options.idsMap = dataMaps.ids;\n\n            return options;\n        },\n\n        _flatData: function(data, skip) {\n            skip = this._isPageable() ? true : skip;\n            return DataSource.fn._flatData.call(this, data, skip);\n        },\n\n        data: function(data) {\n            var that = this;\n            var result = DataSource.fn.data.call(that, data);\n\n            if (that._isPageable()) {\n                that._initDataMaps(that._getData());\n                that._calculateCollapsedTotal();\n            }\n\n            return result;\n        },\n\n        cancelChanges: function(model) {\n            var that = this;\n\n            DataSource.fn.cancelChanges.call(that, model);\n\n            that._restorePageSizeAfterAddChild();\n        },\n\n        _modelCanceled: function(model) {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._removeFromDataMaps(model);\n            }\n        },\n\n        _changesCanceled: function() {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._initDataMaps(that._getData());\n            }\n        },\n\n        _setAddChildPageSize: function() {\n            var that = this;\n            var queryOptions = {};\n\n            if (that._isPageable()) {\n                // increase the page size to make the new item visible in view\n                that._addChildPageSize = that.pageSize() + 1;\n\n                queryOptions = that._defaultPageableQueryOptions();\n                queryOptions.take = that._addChildPageSize;\n                queryOptions.pageSize = that._addChildPageSize;\n                that._query(queryOptions);\n            }\n        },\n\n        _restorePageSizeAfterAddChild: function() {\n            var that = this;\n            var queryOptions = {};\n\n            if (that._isPageable()) {\n                if (!isUndefined(that._addChildPageSize)) {\n                    queryOptions = that._defaultPageableQueryOptions();\n                    queryOptions.take = that._addChildPageSize - 1;\n                    queryOptions.pageSize = that._addChildPageSize - 1;\n                    that._query(queryOptions);\n                }\n            }\n\n            that._addChildPageSize = undefined;\n        },\n\n        sync: function() {\n            var that = this;\n\n            return DataSource.fn.sync.call(that)\n                .then(function() {\n                    that._restorePageSizeAfterAddChild();\n                });\n        },\n\n        _syncEnd: function() {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._initDataMaps(that._getData());\n            }\n        }\n    });\n\n    TreeListDataSource.create = function(options) {\n        if (Array.isArray(options)) {\n            options = { data: options };\n        } else if (options instanceof ObservableArray) {\n            options = { data: options.toJSON() };\n        }\n\n        return options instanceof TreeListDataSource ? options : new TreeListDataSource(options);\n    };\n\n    function isCellVisible() {\n        return this.style.display !== \"none\";\n    }\n\n    function sortCells(cells) {\n        var indexAttr = kendo.attr(\"index\");\n        return cells.sort(function(a, b) {\n            a = $(a);\n            b = $(b);\n\n            var indexA = a.attr(indexAttr);\n            var indexB = b.attr(indexAttr);\n\n            if (indexA === undefined) {\n                indexA = $(a).index();\n            }\n            if (indexB === undefined) {\n                indexB = $(b).index();\n            }\n\n            indexA = parseInt(indexA, 10);\n            indexB = parseInt(indexB, 10);\n            return indexA > indexB ? 1 : (indexA < indexB ? -1 : 0);\n        });\n    }\n\n    function leafDataCells(container) {\n        var rows = container.find(\">tr:not(.k-filter-row)\");\n\n        var filter = function() {\n            var el = $(this);\n            return !el.hasClass(\"k-group-cell\") && !el.hasClass(\"k-hierarchy-cell\");\n        };\n\n        var cells = $();\n        if (rows.length > 1) {\n            cells = rows.find(\"th[data-index]\")\n                .filter(filter);\n        }\n\n        cells = cells.add(rows.last().find(\"th\").filter(filter));\n\n        return sortCells(cells);\n    }\n\n    function createPlaceholders(options) {\n        var spans = [];\n        var className = options.className;\n\n        for (var i = 0, level = options.level; i < level; i++) {\n            spans.push(kendoDomElement(\"span\", { className: className }));\n        }\n\n        return spans;\n    }\n\n    function columnsWidth(cols) {\n        var colWidth, width = 0;\n\n        for (var idx = 0, length = cols.length; idx < length; idx++) {\n            colWidth = cols[idx].style.width;\n            if (colWidth && colWidth.indexOf(\"%\") == -1) {\n                width += parseInt(colWidth, 10);\n            }\n        }\n\n        return width;\n    }\n\n    function syncTableHeight(table1, table2) {\n       table1 = table1[0];\n       table2 = table2[0];\n\n       if (table1.rows.length && table2.rows.length && table1.rows.length !== table2.rows.length) {\n           var lockedHeigth = table1.offsetHeight;\n           var tableHeigth = table2.offsetHeight;\n\n           var row;\n           var diff;\n           if (lockedHeigth > tableHeigth) {\n               row = table2.rows[table2.rows.length - 1];\n\n               if (filterRowRegExp.test(row.className)) {\n                   row = table2.rows[table2.rows.length - 2];\n               }\n\n               diff = lockedHeigth - tableHeigth;\n           } else {\n               row = table1.rows[table1.rows.length - 1];\n\n                if (filterRowRegExp.test(row.className)) {\n                    row = table1.rows[table1.rows.length - 2];\n                }\n\n               diff = tableHeigth - lockedHeigth;\n           }\n           row.style.height = row.offsetHeight + diff + \"px\";\n       }\n    }\n\n    var TreeListPager = ui.Pager.extend({\n        options: {\n            name: \"TreeListPager\"\n        },\n\n        totalPages: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n\n            if (dataSource && dataSource._filter) {\n                return ui.Pager.fn.totalPages.call(that);\n            }\n\n            return Math.ceil((that._collapsedTotal() || 0) / (that.pageSize() || 1));\n        },\n\n        _createDataSource: function(options) {\n            this.dataSource = kendo.data.TreeListDataSource.create(options.dataSource);\n        },\n\n        _collapsedTotal: function() {\n            var dataSource = this.dataSource;\n            return dataSource ? (dataSource.collapsedTotal() || 0) : 0;\n        }\n    });\n\n    var Editor = kendo.Observable.extend({\n        init: function(element, options) {\n            kendo.Observable.fn.init.call(this);\n\n            options = this.options = extend(true, {}, this.options, options);\n\n            this.element = element;\n\n            this.bind(this.events, options);\n\n            this.model = this.options.model;\n\n            this.fields = this._fields(this.options.columns);\n\n            this._initContainer();\n\n            this.createEditable();\n        },\n\n        events: [],\n\n        _initContainer: function() {\n            this.wrapper = this.element;\n        },\n\n        createEditable: function() {\n            var options = this.options;\n\n            this.editable = new ui.Editable(this.wrapper, {\n                fields: this.fields,\n                target: options.target,\n                clearContainer: options.clearContainer,\n                model: this.model,\n                change: options.change\n            });\n        },\n\n        _isEditable: function(column) {\n            return isColumnEditable(column, this.model);\n        },\n\n        _fields: function(columns) {\n            var fields = [];\n            var idx, length, column;\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                column = columns[idx];\n\n                if (this._isEditable(column)) {\n                    fields.push({\n                        field: column.field,\n                        format: column.format,\n                        editor: column.editor\n                    });\n                }\n            }\n\n            return fields;\n        },\n\n        end: function() {\n            return this.editable.end();\n        },\n\n        close: function() {\n            this.destroy();\n        },\n\n        destroy: function() {\n            this.editable.destroy();\n            this.editable.element\n                .find(\"[\" + kendo.attr(\"container-for\") + \"]\")\n                .empty()\n                .end()\n                .removeAttr(kendo.attr(\"role\"));\n\n            this.model = this.wrapper = this.element = this.columns = this.editable = null;\n        }\n    });\n\n    var PopupEditor = Editor.extend({\n        init: function(element, options) {\n            Editor.fn.init.call(this, element, options);\n\n            this._attachHandlers();\n            kendo.cycleForm(this.wrapper);\n\n            this.open();\n        },\n\n        events: [\n            CANCEL,\n            SAVE\n        ],\n\n        options: {\n            window: {\n                modal: true,\n                resizable: false,\n                draggable: true,\n                title: \"Edit\",\n                visible: false\n            }\n        },\n\n        _initContainer: function() {\n            var options = this.options;\n            var formContent = [];\n\n            this.wrapper = $('<div class=\"k-popup-edit-form\"/>')\n                .attr(kendo.attr(\"uid\"), this.model.uid)\n                .append('<div class=\"k-edit-form-container\"/>');\n\n            if (options.template) {\n                this._appendTemplate(formContent);\n                this.fields = [];\n            } else {\n                this._appendFields(formContent);\n            }\n            this._appendButtons(formContent);\n\n            new kendoDom.Tree(this.wrapper.children()[0]).render(formContent);\n\n            this.wrapper.appendTo(options.appendTo);\n\n            this.window = new ui.Window(this.wrapper, options.window);\n        },\n\n        _appendTemplate: function(form) {\n            var template = this.options.template;\n\n            if (typeof template === STRING) {\n                template = kendo.unescape(template);\n            }\n\n            template = kendo.template(template)(this.model);\n\n            form.push(kendoHtmlElement(template));\n        },\n\n        _appendFields: function(form) {\n            var idx, length, column;\n            var columns = this.options.columns;\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                column = columns[idx];\n\n                if (column.selectable) {\n                    continue;\n                }\n\n                if (column.command) {\n                    continue;\n                }\n\n                form.push(kendoHtmlElement('<div class=\"k-edit-label\"><label for=\"' + column.field + '\">' + (column.title || column.field || \"\") + '</label></div>'));\n\n                if (this._isEditable(column)) {\n                    form.push(kendoHtmlElement('<div ' + kendo.attr(\"container-for\") + '=\"' + column.field +\n                                '\" class=\"k-edit-field\"></div>'));\n                } else {\n                    form.push(kendoDomElement(\"div\", {\n                            \"class\": \"k-edit-field\"\n                        },\n                        [ this.options.fieldRenderer(column, this.model) ]));\n                }\n            }\n        },\n\n        _appendButtons: function(form) {\n            form.push(kendoDomElement(\"div\", {\n                \"class\": \"k-edit-buttons\"\n            }, this.options.commandRenderer()));\n        },\n\n        _attachHandlers: function() {\n            var closeHandler = this._cancelProxy = this._cancel.bind(this);\n            this.wrapper.on(CLICK + NS, \".k-grid-cancel\", this._cancelProxy);\n\n            this._saveProxy = this._save.bind(this);\n            this.wrapper.on(CLICK + NS, \".k-grid-update\", this._saveProxy);\n\n            this.window.bind(\"close\", function(e) {\n                if (e.userTriggered) {\n                    closeHandler(e);\n                }\n            });\n        },\n\n        _detachHandlers: function() {\n            this._cancelProxy = null;\n            this._saveProxy = null;\n            this.wrapper.off(NS);\n        },\n\n        _cancel: function(e) {\n            this.trigger(CANCEL, e);\n        },\n\n        _save: function() {\n            this.trigger(SAVE);\n        },\n\n        open: function() {\n            this.window.center().open();\n        },\n\n        close: function() {\n            this.window.bind(\"deactivate\", this.destroy.bind(this)).close();\n        },\n\n        destroy: function() {\n            this.window.destroy();\n            this.window = null;\n            this._detachHandlers();\n\n            Editor.fn.destroy.call(this);\n        }\n    });\n\n    var IncellEditor = Editor.extend({\n        destroy: function() {\n            var that = this;\n\n            that.editable.destroy();\n\n            that.editable.element\n                .off()\n                .empty()\n                .removeAttr(kendo.attr(\"role\"));\n\n            that.model = that.wrapper = that.element = that.columns = that.editable = null;\n        }\n    });\n\n    var TreeList = DataBoundWidget.extend({\n        init: function(element, options, events) {\n            DataBoundWidget.fn.init.call(this, element, options);\n\n            if (events) {\n                this._events = events;\n            }\n\n            isRtl = kendo.support.isRtl(element);\n            this._dataSource(this.options.dataSource);\n            this._aria();\n            this._columns();\n            this._layout();\n            this._navigatable();\n            this._selectable();\n            this._sortable();\n            this._resizable();\n            this._filterable();\n            this._filterRow();\n            this._attachEvents();\n            this._toolbar();\n            this._scrollable();\n            this._reorderable();\n            this._columnMenu();\n            this._minScreenSupport();\n            this._draggable();\n            this._pageable();\n\n            if (this.options.autoBind) {\n                this.dataSource.fetch();\n            }\n\n            if (this._hasLockedColumns) {\n                var widget = this;\n                this.wrapper.addClass(\"k-grid-lockedcolumns\");\n                this._resizeHandler = function() { widget.resize(); };\n                $(window).on(\"resize\" + NS, this._resizeHandler);\n            }\n\n            kendo.notify(this);\n        },\n\n        _draggable: function() {\n            var that = this;\n            var editable = this.options.editable;\n            var dataSource = that.dataSource;\n            var idField = dataSource._modelIdField();\n            var parentIdField = dataSource._modelParentIdField();\n            var pageable = that._isPageable();\n            var reorderable;\n\n            if (!editable || !editable.move) {\n                return;\n            }\n\n            reorderable = editable.move.reorderable;\n\n            this._dragging = new kendo.ui.HierarchicalDragAndDrop(this.wrapper, {\n                $angular: this.$angular,\n                autoScroll: true,\n                holdToDrag: touchDevice,\n                filter: \"tbody>tr\",\n                itemSelector: \"tr\",\n                allowedContainers: this.wrapper,\n                hintText: function(row) {\n                    var text = function() { return $(this).text(); };\n                    var separator = \"<span class='k-drag-separator'></span>\";\n                    return row.children(\"td\").map(text).toArray().join(separator);\n                },\n                contains: (function(source, destination) {\n                    var dest = this.dataItem(destination);\n                    var src = this.dataItem(source);\n\n                    return src == dest || this.dataSource.contains(src, dest);\n                }).bind(this),\n                itemFromTarget: function(target) {\n                    var tr = target.closest(\"tr\");\n                    var prevRow = tr.prev();\n                    var nextRow = tr.next();\n                    var first;\n                    var last;\n\n                    if (prevRow) {\n                        first = !that.sameLevel(prevRow, tr);\n                    }\n\n                    if (nextRow) {\n                        last = !that.sameLevel(nextRow, tr);\n                    }\n\n                    return {\n                        item: tr,\n                        content: tr,\n                        first: first,\n                        last: last\n                    };\n                },\n                dragstart: (function(source) {\n                    this.wrapper.addClass(\"k-treelist-dragging\");\n\n                    if (this.wrapper.find('.k-grid-content').length) {\n                        this.wrapper.find('.k-grid-content table, .k-grid-content-locked table').css(\"position\", \"relative\");\n                    }\n\n                    var model = this.dataItem(source);\n\n                    return this.trigger(DRAGSTART, { source: model });\n                }).bind(this),\n                drag: (function(e) {\n                    e.source = this.dataItem(e.source);\n\n                    this.trigger(DRAG, e);\n                }).bind(this),\n                drop: (function(e) {\n                    e.source = this.dataItem(e.source);\n                    e.destination = this.dataItem(e.destination);\n\n                    this.wrapper.removeClass(\"k-treelist-dragging\");\n\n                    if (this.wrapper.find('.k-grid-content').length) {\n                        this.wrapper.find('.k-grid-content table, .k-grid-content-locked table').css(\"position\", \"static\");\n                    }\n\n                    return this.trigger(DROP, e);\n                }).bind(this),\n                dragend: (function(e) {\n                    var dest = this.dataItem(e.destination);\n                    var src = this.dataItem(e.source);\n                    var originalSrcParentId = src[parentIdField];\n                    var originalSrcIndex = dataSource._indexInChildrenMap(src);\n                    var position = e.position;\n\n                    if (position == \"over\") {\n                        if (pageable) {\n                            dataSource._removeFromChildrenMap(src);\n                            src[parentIdField] = dest ? dest[idField] : null;\n\n                            dataSource._initChildrenMapForParent(dest);\n\n                            // src.set() below will not work as the parent id is already set\n                            src[parentIdField] = originalSrcParentId;\n                        }\n\n                        var isPrevented = src.set(\"parentId\", dest ? dest.id : null);\n\n                        if (pageable && isPrevented) {\n                            dataSource._removeFromChildrenMap(src);\n                            src[parentIdField] = originalSrcParentId;\n                            dataSource._removeFromChildrenMap(src);\n                            dataSource._insertInChildrenMap(src, originalSrcIndex);\n                        }\n\n\n                    } else {\n                        if (position == \"before\") {\n                            that.insertBefore(src, dest);\n                        } else if (position == \"after\") {\n                            that.insertAfter(src, dest);\n                        }\n                    }\n\n                    e.source = src;\n                    e.destination = dest;\n\n                    this.trigger(DRAGEND, e);\n                }).bind(this),\n                reorderable: reorderable,\n                dropHintContainer: function(item) {\n                    return item.children(\"td:visible\").eq(0);\n                },\n                dropPositionFrom: function(dropHint) {\n                    var contents;\n                    var length;\n                    var i;\n                    var dropHintElement;\n                    var isAfterText = false;\n\n                    if (dropHint.parent().find('.k-i-none').length) {\n                        return dropHint.prevAll(\".k-i-none\").length > 0 ? \"after\" : \"before\";\n                    } else {\n                        contents = dropHint.parent().contents();\n                        length = contents.length;\n                        dropHintElement = dropHint[0];\n\n                        for (i = 0; i < length; i++) {\n                            if (contents[i] === dropHintElement) {\n                                break;\n                            }\n\n                            if (contents[i].nodeType === 3) {\n                                isAfterText = true;\n                            }\n                        }\n\n                        return isAfterText ? \"after\" : \"before\";\n                    }\n                }\n            });\n        },\n\n        sameLevel: function() {\n           return arguments[0].find(\".\" + classNames.iconHidden).length === arguments[1].find(\".\" + classNames.iconHidden).length;\n        },\n\n        insertAfter: function(nodeData, referenceNode) {\n            this.insertAction(nodeData, referenceNode, 1);\n        },\n\n        insertBefore: function(nodeData, referenceNode) {\n            this.insertAction(nodeData, referenceNode, 0);\n        },\n\n        insertAction: function(nodeData, referenceNode, indexOffset) {\n            var that = this;\n            var dataSource = that.dataSource;\n            var parentIdField = dataSource._modelParentIdField();\n            var referenceNodeIndex;\n            var nodeDataIndex = dataSource.indexOf(nodeData);\n            var pageable = that._isPageable();\n            var originalDestIndex = dataSource._indexInChildrenMap(referenceNode);\n            var destIndex;\n            var childrenMap = dataSource._getChildrenMap() || {};\n            var parentId = nodeData[parentIdField];\n\n            that._unbindDataSource();\n            that._unbindDataChange();\n\n            if (pageable) {\n                dataSource._removeFromChildrenMap(nodeData);\n            }\n\n            if (nodeData[parentIdField] != referenceNode[parentIdField]) {\n                 nodeData.set(\"parentId\", referenceNode && referenceNode.parentId ? referenceNode.parentId : null);\n            }\n\n            dataSource._data.splice(nodeDataIndex, 1);\n            referenceNodeIndex = dataSource.indexOf(referenceNode);\n            destIndex = referenceNodeIndex + indexOffset;\n\n            if (pageable) {\n                originalDestIndex += indexOffset;\n\n                if (childrenMap[parentId].length <= originalDestIndex) {\n                    originalDestIndex = childrenMap[parentId].length;\n                }\n                dataSource._insertInChildrenMap(nodeData, originalDestIndex);\n            }\n\n            dataSource._data.splice(destIndex, 0, nodeData);\n            dataSource._destroyed.pop();\n            that._bindDataChange();\n            that._bindDataSource();\n            that.refresh();\n        },\n\n        _bindDataChange: function() {\n            var dataSource = this.dataSource;\n            if (dataSource._data && dataSource._changeHandler) {\n                dataSource._data.bind(CHANGE, dataSource._changeHandler);\n                dataSource._data.trigger(CHANGE);\n            }\n        },\n\n        _unbindDataChange: function() {\n            var dataSource = this.dataSource;\n            if (dataSource._data && dataSource._changeHandler) {\n                dataSource._data.unbind(CHANGE, dataSource._changeHandler);\n            }\n        },\n\n        _bindDataSource: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n\n            if (dataSource) {\n                dataSource.bind(CHANGE, that._refreshHandler);\n            }\n        },\n\n        _unbindDataSource: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n\n            if (dataSource) {\n                dataSource.unbind(CHANGE, that._refreshHandler);\n            }\n        },\n\n        itemFor: function(model) {\n            if (typeof model == \"number\") {\n                model = this.dataSource.get(model);\n            }\n\n            return this.tbody.find(\"[\" + kendo.attr(\"uid\") + \"=\" + model.uid + \"]\");\n        },\n\n        _itemFor: function(model) {\n            var that = this;\n            var table = that.lockedContent ? that.lockedTable : that.table;\n\n            if (typeof model == \"number\") {\n                model = this.dataSource.get(model);\n            }\n\n            return table.find(\"[\" + kendo.attr(\"uid\") + \"=\" + model.uid + \"]\");\n        },\n\n        _scrollable: function() {\n            if (this.options.scrollable) {\n                var scrollables = this.thead.closest(\".k-grid-header-wrap\");\n                var lockedContent = $(this.lockedContent)\n                    .on(\"DOMMouseScroll\" + NS + \" mousewheel\" + NS, this._wheelScroll.bind(this));\n\n                this.content.on(\"scroll\" + NS, function() {\n                    kendo.scrollLeft(scrollables, this.scrollLeft);\n                    lockedContent.scrollTop(this.scrollTop);\n                });\n\n\n                var touchScroller = kendo.touchScroller(this.content);\n\n                if (touchScroller && touchScroller.movable) {\n                    this._touchScroller = touchScroller;\n\n                    touchScroller.movable.bind(\"change\", function(e) {\n                        kendo.scrollLeft(scrollables, -e.sender.x);\n                        if (lockedContent) {\n                            lockedContent.scrollTop(-e.sender.y);\n                        }\n                    });\n                }\n            }\n        },\n\n        _wheelScroll: function(e) {\n            if (e.ctrlKey) {\n                return;\n            }\n\n            var delta = kendo.wheelDeltaY(e);\n            var lockedDiv = $(e.currentTarget);\n\n            if (delta) {\n                if (lockedDiv[0].scrollHeight > lockedDiv[0].clientHeight &&\n                    (lockedDiv[0].scrollTop < lockedDiv[0].scrollHeight - lockedDiv[0].clientHeight && delta < 0 ||\n                    lockedDiv[0].scrollTop > 0 && delta > 0)) {\n                    e.preventDefault();\n                }\n                //In Firefox DOMMouseScroll event cannot be canceled\n                lockedDiv.one(\"wheel\" + NS, false);\n\n                this.content.scrollTop(this.content.scrollTop() + (-delta));\n            }\n        },\n\n        _progress: function() {\n            var messages = this.options.messages;\n\n            if (!this.tbody.find(\"tr\").length) {\n                this._showStatus(\n                    kendo.template(\n                        \"<span class='#= className #'></span> #: messages.loading #\"\n                    )({\n                        className: classNames.icon + \" \" + classNames.loading,\n                        messages: messages\n                    })\n                );\n            }\n        },\n\n        _error: function(e) {\n            if (!this.dataSource.rootNodes().length) {\n                this._render({ error: e });\n            }\n        },\n\n        refresh: function(e) {\n            var that = this;\n            e = e || {};\n\n            if (e.action == \"itemchange\" && this.editor) {\n                return;\n            }\n\n            if (this.trigger(DATABINDING)) {\n                return;\n            }\n            var current = $(this.current());\n            var isCurrentInHeader = false;\n            var currentIndex;\n\n            this._cancelEditor();\n\n            this._render();\n\n            this._adjustHeight();\n\n            if (this.options.navigatable) {\n                if (this._isActiveInTable() || this.editor) {\n                    isCurrentInHeader = current.is(\"th\");\n                    currentIndex = Math.max(this.cellIndex(current), 0);\n                }\n                this._restoreCurrent(currentIndex, isCurrentInHeader);\n            }\n\n            if (that._checkBoxSelection) {\n                that._deselectCheckRows(that.items(), true);\n            }\n\n            this.trigger(DATABOUND);\n        },\n\n        _angularFooters: function(command) {\n            var i, footer, aggregates;\n            var allAggregates = this.dataSource.aggregates();\n            var footerRows = this._footerItems();\n\n            for (i = 0; i < footerRows.length; i++) {\n                footer = footerRows.eq(i);\n                aggregates = allAggregates[footer.attr(\"data-parentId\")];\n\n                this._angularFooter(command, footer.find(\"td\").get(), aggregates);\n            }\n        },\n\n        _angularFooter: function(command, cells, aggregates) {\n            var columns = this.columns;\n            this.angular(command, function() {\n                return {\n                    elements: cells,\n                    data: map(columns, function(col) {\n                        return {\n                            column: col,\n                            aggregate: aggregates && aggregates[col.field]\n                        };\n                    })\n                };\n            });\n        },\n\n        items: function() {\n            if (this._hasLockedColumns) {\n                return this._items(this.tbody).add(this._items(this.lockedTable));\n            } else {\n                return this._items(this.tbody);\n            }\n        },\n\n        _items: function(container) {\n            return container.find(\"tr[data-uid]\").filter(function() {\n                return !$(this).hasClass(classNames.footerTemplate);\n            });\n        },\n\n        _footerItems: function() {\n            var container = this.tbody;\n            if (this._hasLockedColumns) {\n                container = container.add(this.lockedTable);\n            }\n\n            return container.find(\"tr\").filter(function() {\n                return $(this).hasClass(classNames.footerTemplate);\n            });\n        },\n\n        dataItems: function() {\n            var dataItems = kendo.ui.DataBoundWidget.fn.dataItems.call(this);\n            if (this._hasLockedColumns) {\n                var n = dataItems.length, tmp = new Array(2 * n);\n                for (var i = n; --i >= 0;) {\n                    tmp[i] = tmp[i + n] = dataItems[i];\n                }\n                dataItems = tmp;\n            }\n\n            return dataItems;\n        },\n\n        _showNoRecordsTemplate: function() {\n            var wrapper = '<div class=\"{0}\">{1}</div>';\n            var defaultTemplate = '<div class=\"k-grid-norecords-template\"{1}>{0}</div>';\n            var scrollableNoGridHeightStyles = (this.options.scrollable && !this.wrapper[0].style.height) ? ' style=\"margin:0 auto;position:static;\"' : '';\n            var template;\n\n            this._contentTree.render([]);\n            if (this._hasLockedColumns) {\n                this._lockedContentTree.render([]);\n            }\n\n            template = kendo.format(defaultTemplate, this.options.messages.noRows, scrollableNoGridHeightStyles);\n\n            $(kendo.template(kendo.format(wrapper, NORECORDSCLASS, template))({})).insertAfter(this.table);\n        },\n\n        _showStatus: function(message) {\n            var status = this.element.find(\".k-status\");\n            var content = $(this.content).add(this.lockedContent);\n\n            if (!status.length) {\n                status = $(\"<div class='k-status' role='alert' aria-live='polite' />\").appendTo(this.element);\n            }\n\n            this._contentTree.render([]);\n            if (this._hasLockedColumns) {\n                this._lockedContentTree.render([]);\n            }\n\n            content.hide();\n\n            status.html(message);\n        },\n\n        _hideStatus: function() {\n            this.element.find(\".k-status\").remove();\n            this._hideNoRecordsTempalte();\n\n            $(this.content).add(this.lockedContent).show();\n        },\n\n        _hideNoRecordsTempalte: function() {\n            this.element.find(\".\" + NORECORDSCLASS).remove();\n        },\n\n        _adjustHeight: function() {\n            var that = this;\n            var element = this.element;\n            var contentWrap = element.find(DOT + classNames.gridContentWrap);\n            var header = element.find(DOT + classNames.gridHeader);\n            var toolbar = element.find(DOT + classNames.gridToolbar);\n            var status = element.find(DOT + classNames.status);\n            var pagerHeight = that._isPageable() && that.pager && that.pager.element.is(\":visible\") ? outerHeight(that.pager.element) : 0;\n            var height;\n            var scrollbar = kendo.support.scrollbar();\n\n            element.css(HEIGHT, this.options.height);\n\n            // identical code found in grid & scheduler :(\n            var isHeightSet = function(el) {\n                var initialHeight, newHeight;\n                if (el[0].style.height) {\n                    return true;\n                } else {\n                    initialHeight = el.height();\n                }\n\n                el.height(\"auto\");\n                newHeight = el.height();\n                el.height(\"\");\n\n                return (initialHeight != newHeight);\n            };\n\n            if (isHeightSet(element)) {\n                height = element.height() - outerHeight(header) - outerHeight(toolbar) - outerHeight(status) - pagerHeight;\n\n                contentWrap.height(height);\n\n                if (this._hasLockedColumns) {\n                    scrollbar = this.table[0].offsetWidth > this.table.parent()[0].clientWidth ? scrollbar : 0;\n                    this.lockedContent.height(height - scrollbar);\n                }\n            }\n        },\n\n        _resize: function(size, force) {\n            this._applyLockedContainersWidth();\n            this._adjustHeight();\n\n            if (this.pager && this.pager.element) {\n                this.pager.resize(force);\n            }\n        },\n\n        _minScreenSupport: function() {\n            var any = this.hideMinScreenCols();\n\n            if (any) {\n                this.minScreenResizeHandler = this.hideMinScreenCols.bind(this);\n                $(window).on(\"resize\", this.minScreenResizeHandler);\n            }\n        },\n\n        _iterateMinScreenCols: function(cols, screenWidth) {\n            var any = false;\n\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                var minWidth = col.minScreenWidth;\n                if (minWidth !== undefined && minWidth !== null) {\n                    any = true;\n                    if (minWidth > screenWidth) {\n                        this.hideColumn(col);\n                    } else {\n                        this.showColumn(col);\n                    }\n                }\n                if (!col.hidden && col.columns) {\n                    any = this._iterateMinScreenCols(col.columns, screenWidth) || any;\n                }\n            }\n            return any;\n        },\n\n        hideMinScreenCols: function() {\n            var cols = this.columns,\n                screenWidth = (window.innerWidth > 0) ? window.innerWidth : screen.width;\n\n            return this._iterateMinScreenCols(cols, screenWidth);\n        },\n\n        destroy: function() {\n            this._destroyColumnAttachments();\n\n            DataBoundWidget.fn.destroy.call(this);\n\n            var dataSource = this.dataSource;\n\n            dataSource.unbind(CHANGE, this._refreshHandler);\n            dataSource.unbind(ERROR, this._errorHandler);\n            dataSource.unbind(PROGRESS, this._progressHandler);\n\n            this._navigatableTables = null;\n            this._current = null;\n\n            if (this._resizeHandler) {\n                $(window).off(\"resize\" + NS, this._resizeHandler);\n            }\n\n            if (this._dragging) {\n                this._dragging.destroy();\n                this._dragging = null;\n            }\n\n            if (this.resizable) {\n                this.resizable.destroy();\n                this.resizable = null;\n            }\n\n            if (this.reorderable) {\n                this.reorderable.destroy();\n                this.reorderable = null;\n            }\n\n            if (this._draggableInstance && this._draggableInstance.element) {\n                this._draggableInstance.destroy();\n                this._draggableInstance = null;\n            }\n\n            if (this.selectable) {\n                this.selectable.destroy();\n            }\n\n            if (this._userEvents) {\n                this._userEvents.destroy();\n                this._userEvents = null;\n            }\n\n            if (this.minScreenResizeHandler) {\n                $(window).off(\"resize\", this.minScreenResizeHandler);\n            }\n\n            this._destroyEditor();\n\n            this.element.off(NS);\n            if (this.wrapper) {\n                this.wrapper.off(NS);\n            }\n\n            if (this._touchScroller) {\n                this._touchScroller.destroy();\n            }\n\n            this._destroyPager();\n\n            if (dataSource) {\n                dataSource._dataMaps = null;\n            }\n\n            this._autoExpandable = null;\n\n            this._refreshHandler = this._errorHandler = this._progressHandler = this._dataSourceFetchProxy = null;\n\n            this.thead =\n                this.content =\n                this.tbody =\n                this.table =\n                this.element =\n                this.lockedHeader =\n                this.lockedContent = null;\n\n            this._statusTree =\n                this._headerTree =\n                this._contentTree =\n                this._lockedHeaderColsTree =\n                this._lockedContentColsTree =\n                this._lockedHeaderTree =\n                this._lockedContentTree = null;\n\n            kendo.destroy(this.wrapper);\n        },\n\n        options: {\n            name: \"TreeList\",\n            columns: [],\n            autoBind: true,\n            scrollable: true,\n            selectable: false,\n            sortable: false,\n            toolbar: null,\n            height: null,\n            columnMenu: false,\n            messages: {\n                noRows: \"No records to display\",\n                loading: \"Loading...\",\n                requestFailed: \"Request failed.\",\n                retry: \"Retry\",\n                commands: {\n                    edit: \"Edit\",\n                    update: \"Update\",\n                    canceledit: \"Cancel\",\n                    create: \"Add new record\",\n                    createchild: \"Add child record\",\n                    destroy: \"Delete\",\n                    excel: \"Export to Excel\",\n                    pdf: \"Export to PDF\",\n                    search: \"Search...\"\n                }\n            },\n            excel: {\n                hierarchy: true\n            },\n            resizable: false,\n            search: false,\n            filterable: false,\n            editable: false,\n            reorderable: false,\n            pageable: false,\n            renderAllRows: true,\n            rowTemplate: \"\",\n            altRowTemplate: \"\"\n        },\n\n        events: [\n            CHANGE,\n            BEFORE_EDIT,\n            EDIT,\n            PAGE,\n            SAVE,\n            SAVE_CHANGES,\n            REMOVE,\n            EXPAND,\n            COLLAPSE,\n            DATABINDING,\n            DATABOUND,\n            CANCEL,\n            DRAGSTART,\n            DRAG,\n            DROP,\n            DRAGEND,\n            FILTERMENUINIT,\n            ITEM_CHANGE,\n            CELL_CLOSE,\n            FILTERMENUOPEN,\n            COLUMNHIDE,\n            COLUMNSHOW,\n            COLUMNREORDER,\n            COLUMNRESIZE,\n            COLUMNMENUINIT,\n            COLUMNMENUOPEN,\n            COLUMNLOCK,\n            COLUMNUNLOCK\n        ],\n\n        getOptions: function() {\n            var options = this.options;\n            options.dataSource = null;\n\n            var result = extend(true, {}, this.options);\n            result.columns = kendo.deepExtend([], this.columns);\n\n            var dataSource = this.dataSource;\n\n            var initialData = dataSource.options.data && dataSource._data;\n            dataSource.options.data = null;\n\n            result.dataSource = $.extend(true, {}, dataSource.options);\n\n            dataSource.options.data = initialData;\n\n            result.dataSource.data = initialData;\n            result.dataSource.page = dataSource.page();\n            result.dataSource.filter = $.extend(true, {}, dataSource.filter());\n            result.dataSource.pageSize = dataSource.pageSize();\n            result.dataSource.sort = dataSource.sort();\n            result.dataSource.group = dataSource.group();\n            result.dataSource.aggregate = dataSource.aggregate();\n\n            if (result.dataSource.transport) {\n                result.dataSource.transport.dataSource = null;\n            }\n\n            if (result.pageable && result.pageable.pageSize) {\n                result.pageable.pageSize = dataSource.pageSize();\n            }\n\n            result.$angular = undefined;\n\n            return result;\n        },\n\n        setOptions: function(options) {\n            var currentOptions = this.getOptions();\n            kendo.deepExtend(currentOptions, options);\n            if (!options.dataSource) {\n                currentOptions.dataSource = this.dataSource;\n            }\n            var wrapper = this.wrapper;\n            var events = this._events;\n            var element = this.element;\n\n            this.destroy();\n            this.options = null;\n            if (wrapper[0] !== element[0]) {\n                wrapper.before(element);\n                wrapper.remove();\n            }\n            element.empty();\n\n            this.init(element, currentOptions, events);\n            this._setEvents(currentOptions);\n        },\n\n        _destroyColumnAttachments: function() {\n            var that = this;\n\n            if (!that.thead) {\n                return;\n            }\n\n            this.angular(\"cleanup\", function() {\n                return { elements: that.thead.get() };\n            });\n\n            that.thead.add(that.lockedHeader).find(\"th\").each(function() {\n                var th = $(this),\n                    filterMenu = th.data(\"kendoFilterMenu\"),\n                    sortable = th.data(\"kendoColumnSorter\"),\n                    columnMenu = th.data(\"kendoColumnMenu\");\n\n                if (filterMenu) {\n                    filterMenu.destroy();\n                }\n\n                if (sortable) {\n                    sortable.destroy();\n                }\n\n                if (columnMenu) {\n                    columnMenu.destroy();\n                }\n            });\n        },\n\n        _toggle: function(model, expand) {\n            var that = this;\n            var defaultPromise = $.Deferred().resolve().promise();\n            var loaded = model.loaded();\n\n             if (that._isIncellEditable() && that.editor) {\n                // manually trigger change as the expand/collapse icons are not focusable\n                $(activeElement()).change();\n                that.closeCell();\n            }\n\n            // reset error state\n            if (model._error) {\n                model.expanded = false;\n                model._error = undefined;\n            }\n\n            // do not load items that are currently loading\n            if (!loaded && model.expanded) {\n                return defaultPromise;\n            }\n\n            // toggle expanded state\n            if (typeof expand == \"undefined\") {\n                expand = !model.expanded;\n            }\n\n            model.expanded = expand;\n\n            function afterModelLoaded() {\n                that._toggleData();\n                if (that._isPageable()) {\n                    that.refresh();\n                } else {\n                    that._render();\n                }\n                that._syncLockedContentHeight();\n            }\n\n            if (!loaded) {\n                defaultPromise = this.dataSource.load(model)\n                    .always((function() {\n                        afterModelLoaded();\n                    }));\n            }\n\n            afterModelLoaded();\n\n            return defaultPromise;\n        },\n\n        _toggleData: function() {\n            var that = this;\n\n            if (that._isPageable()) {\n                that._togglePageableData();\n            }\n        },\n\n        _togglePageableData: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n            var data = dataSource._getData();\n            var result;\n            var queryOptions = dataSource._defaultPageableQueryOptions();\n\n            that._renderProgress(true);\n\n            var childrenMap = dataSource._getChildrenMap() || dataSource.childrenMap(dataSource._getData());\n\n            dataSource._processDataItemsState(data, childrenMap);\n\n            result = dataSource._processPageableQuery(data, queryOptions);\n\n            queryOptions.childrenMap = result.childrenMap;\n            queryOptions.filteredChildrenMap = result.filteredChildrenMap;\n\n            dataSource._aggregateResult = dataSource._calculateAggregates(result.dataToAggregate, queryOptions);\n\n            dataSource.view(result.data);\n\n            if (!dataSource.filter()) {\n                dataSource._calculateCollapsedTotal();\n            }\n\n            that._refreshPager();\n\n            that._renderProgress(false);\n        },\n\n        _refreshPager: function() {\n            var pager = this.pager;\n\n            if (pager) {\n                pager.refresh();\n            }\n        },\n\n        expand: function(row) {\n            return this._toggle(this.dataItem(row), true);\n        },\n\n        collapse: function(row) {\n            return this._toggle(this.dataItem(row), false);\n        },\n\n        _toggleChildren: function(e) {\n            var icon = $(e.target);\n            var model = this.dataItem(icon);\n\n            if (!model) {\n                return;\n            }\n\n            var event = !model.expanded ? EXPAND : COLLAPSE;\n\n            if (!this.trigger(event, { model: model })) {\n                this._toggle(model);\n            }\n\n            e.preventDefault();\n        },\n\n        _navigatable: function() {\n            var that = this;\n\n            if (!that.options.navigatable) {\n                return;\n            }\n            var tables = that.table.add(that.lockedTable);\n\n            var headerTables = that.thead.parent().add($(\">table\", that.lockedHeader));\n            if (that.options.scrollable) {\n                //add the header table when the widget is scrollable\n                tables = tables.add(headerTables);\n                //data tables will recive first focus on TAB\n                headerTables.attr(TABINDEX, -1);\n            }\n\n            headerTables\n                .on(\"keydown\" + NS, that._openHeaderMenu.bind(that))\n                .find(\"a.k-link\").attr(\"tabIndex\", -1);\n\n            this._navigatableTables = tables;\n\n            tables\n                //handle click on tables, will attempt to focus the table\n                .on((kendo.support.touch ? \"touchstart\" + NS : \"mousedown\" + NS), NAVROW + \">:visible\", that._tableClick.bind(that))\n                .on(\"focus\" + NS, that._tableFocus.bind(that))\n                .on(\"focusout\" + NS, that._tableBlur.bind(that))\n                .on(\"keydown\" + NS, that._tableKeyDown.bind(that));\n        },\n\n        _openHeaderMenu: function(e) {\n            if (e.altKey && e.keyCode == keys.DOWN) {\n                this.current().find(\".k-grid-filter, .k-header-column-menu\").click();\n                e.stopImmediatePropagation();\n            }\n        },\n\n        cellIndex: function(td) {\n            var lockedColumnOffset = 0;\n\n            if (this.lockedTable && !$.contains(this.lockedTable[0], td[0])) {\n                lockedColumnOffset = leafColumns(lockedColumns(this.columns)).length;\n            }\n\n            return $(td).parent().children().index(td) + lockedColumnOffset;\n        },\n\n        _isActiveInTable: function() {\n            var active = kendo._activeElement();\n\n            if (!active) { return false; }\n\n            return this.table[0] === active ||\n                $.contains(this.table[0], active) ||\n                (this.lockedTable &&\n                    (this.lockedTable[0] === active || $.contains(this.lockedTable[0], active))\n                );\n        },\n\n        _restoreCurrent: function(currentIndex, isCurrentInHeader) {\n            var rowIndex;\n            var row;\n            var td;\n\n            if (currentIndex === undefined || currentIndex < 0) {\n                return;\n            }\n\n            if (this._current) {\n                this._current.removeClass(\"k-state-focused\");\n            }\n\n            if (isCurrentInHeader) {\n                this.current(this.thead.find(\"th\").eq(currentIndex));\n            } else {\n                rowIndex = 0;\n                currentIndex = 0;\n\n                row = $();\n\n                if (this.lockedTable) {\n                    row = this.lockedTable.find(\">tbody>tr:visible\").eq(rowIndex);\n                }\n                row = row.add(this.tbody.children().eq(rowIndex));\n\n                td = row.find(\">td:visible\")\n                    .eq(currentIndex);\n\n                this.current(td);\n            }\n\n            if (this._current) {\n                focusTable(this._current.closest(\"table\")[0], true);\n            }\n        },\n\n        current: function(newCurrent) {\n            var current = this._current;\n            newCurrent = $(newCurrent);\n\n            if (newCurrent.length && (!current || current[0] !== newCurrent[0])) {\n                this._updateCurrentAttr(current, newCurrent);\n\n                this._scrollCurrent();\n            }\n\n            if (newCurrent && newCurrent.length) {\n                this._lastCellIndex = newCurrent.parent().children(DATA_CELL).index(newCurrent);\n            }\n\n            return this._current;\n        },\n\n        _setCurrent: function(newCurrent) {\n            var that = this;\n            newCurrent = $(newCurrent);\n\n            if (newCurrent[0]) {\n                that._current = newCurrent;\n                that._updateCurrentAttr(that._current, newCurrent);\n                that._scrollCurrent();\n            }\n\n            return that._current;\n        },\n\n        _scrollCurrent: function() {\n            var current = this._current;\n            var scrollable = this.options.scrollable;\n\n            if (!current || !scrollable) {\n                return;\n            }\n\n            var row = current.parent();\n            var tableContainer = row.closest(\"table\").parent();\n\n            var isInLockedContainer = tableContainer.is(\".k-grid-content-locked,.k-grid-header-locked\");\n            var isInContent = tableContainer.is(\".k-grid-content-locked,.k-grid-content\");\n\n            var scrollableContainer = $(this.content)[0];\n\n            //adjust scroll vertically\n            if (isInContent) {\n                this._scrollTo(this._relatedRow(row)[0], scrollableContainer);\n            }\n\n            if (this.lockedContent) {\n                //sync locked and non-locked content scrollTop\n                this.lockedContent[0].scrollTop = scrollableContainer.scrollTop;\n            }\n\n            //adjust scroll horizontally, if not inside locked tables\n            if (!isInLockedContainer) {\n                this._scrollTo(current[0], scrollableContainer);\n            }\n        },\n\n        _findCurrentCell: function() {\n            var that = this;\n            var current = that.current();\n            var elements = $(that.table).add(that.header).add(that.lockedTable).add(that.lockedHeader);\n\n            if (current && elements.find(current).length > 0) {\n                return current;\n            } else {\n                return elements.find(DOT + classNames.focused);\n            }\n        },\n\n        _scrollTo: function(element, container) {\n            var elementToLowercase = element.tagName.toLowerCase();\n            var isHorizontal = elementToLowercase === \"td\" || elementToLowercase === \"th\";\n            var table = $(element).closest(\"table\")[0];\n            var elementOffsetDir = element[isHorizontal ? \"offsetWidth\" : \"offsetHeight\"];\n            var containerScroll = container[isHorizontal ? \"scrollLeft\" : \"scrollTop\"];\n            var containerOffsetDir = container[isHorizontal ? \"clientWidth\" : \"clientHeight\"];\n            var elementOffset = $(element).css(\"position\") === \"relative\" && isRtl && isHorizontal ? Math.abs(table.offsetLeft - element.offsetLeft) : element[isHorizontal ? \"offsetLeft\" : \"offsetTop\"];\n            var bottomDistance = elementOffset + elementOffsetDir;\n            var result = 0;\n            var ieCorrection = 0;\n            var firefoxCorrection = 0;\n\n            if (isRtl && isHorizontal) {\n                if (browser.msie || browser.edge) {\n                    ieCorrection = table.offsetLeft;\n                } else if (browser.mozilla || (browser.webkit && (browser.version > 85))) {\n                    firefoxCorrection = table.offsetLeft - kendo.support.scrollbar();\n                }\n            }\n            containerScroll = Math.abs(containerScroll + ieCorrection - firefoxCorrection);\n            if (containerScroll > elementOffset) {\n                result = elementOffset;\n            } else if (bottomDistance > (containerScroll + containerOffsetDir)) {\n                if (elementOffsetDir <= containerOffsetDir) {\n                    result = (bottomDistance - containerOffsetDir);\n                } else {\n                    result = elementOffset;\n                }\n            } else {\n                result = containerScroll;\n            }\n            result = Math.abs(result + ieCorrection) + firefoxCorrection;\n            container[isHorizontal ? \"scrollLeft\" : \"scrollTop\"] = result;\n        },\n\n        _aria: function() {\n            var id = this.element.attr(\"id\") || \"aria\";\n\n            if (id) {\n                this._elementId = id + \"_active_element\";\n            }\n        },\n\n        _currentDataIndex: function(table, current) {\n            var index = current.attr(\"data-index\");\n\n            if (!index) {\n                return undefined;\n            }\n\n            var lockedColumnsCount = lockedColumns(this.columns).length;\n            if (lockedColumnsCount && !table.closest(\"div\").hasClass(\"k-grid-content-locked\")[0]) {\n                return index - lockedColumnsCount;\n            }\n\n            return index;\n        },\n\n        _prevVerticalCell: function(container, current) {\n            var cells;\n            var row = current.parent();\n            var rows = container.children(NAVROW);\n            var rowIndex = rows.index(row);\n            //get data-index in case of last level of multi-level columns\n            var index = this._currentDataIndex(container, current);\n            var cellSelector = DATA_CELL + \",\" + FILTER_CELL;\n\n            //current is in the header, but not at the last level of multi-level columns\n            if (index || current.hasClass(\"k-header\")) {\n                cells = parentColumnsCells(current);\n                return cells.eq(cells.length - 2);\n            }\n\n            index = Math.max(row.children(cellSelector).index(current), this._lastCellIndex || 0);\n\n            //if current is inside filter row\n            if (row.hasClass(\"k-filter-row\")) {\n                return leafDataCells(container).filter(isCellVisible).eq(index);\n            }\n\n            //move up to header container\n            if (rowIndex == -1) {\n                //is there filter row in the header container\n                row = container.find(\"tr.k-filter-row:visible\");\n                if (!row[0]) {\n                    return leafDataCells(container).filter(isCellVisible).eq(index);\n                }\n            } else {\n                row = rowIndex === 0 ? $() : rows.eq(rowIndex - 1);\n            }\n\n            cells = row.children(cellSelector);\n            if (cells.length > index) {\n                return cells.eq(index);\n            }\n\n            return cells.eq(0);\n        },\n\n        _nextVerticalCell: function(container, current) {\n            var cells;\n            var row = current.parent();\n            var rows = container.children(NAVROW);\n            var rowIndex = rows.index(row);\n            //get data-index in case of last level of multi-level columns\n            var index = this._currentDataIndex(container, current);\n            var cellSelector = DATA_CELL + \",\" + FILTER_CELL;\n\n            //current is in the header, but not at the last level of multi-level columns\n            //and we are not changing the table\n            if (rowIndex != -1 && index === undefined && current.hasClass(\"k-header\")) {\n                return childColumnsCells(current).eq(1);\n            }\n\n            index = index ? parseInt(index, 10) : row.children(cellSelector).index(current);\n            index = Math.max(index, this._lastCellIndex || 0);\n\n            //move down to data container\n            if (rowIndex == -1) {\n                row = rows.eq(0);\n            } else {\n                row = rows.eq(rowIndex + current[0].rowSpan);\n            }\n\n            var tmpIndex = index;\n            //in case of last level of multi-level columns the index should be updated depending on the hidden columns\n            if (this._currentDataIndex(container, current) !== undefined) {\n                var currentRowCells = row.children(\":not(.k-group-cell):not(.k-hierarchy-cell)\");\n                var hiddenColumns = currentRowCells.filter(\":hidden\");\n                for (var idx = 0, length = hiddenColumns.length; idx < length; idx++) {\n                    if (currentRowCells.index(hiddenColumns[idx]) < index) {\n                        tmpIndex--;\n                    }\n                }\n            }\n            index = tmpIndex;\n\n            cells = row.children(cellSelector);\n            if (cells.length > index) {\n                return cells.eq(index);\n            }\n\n            return cells.eq(0);\n        },\n\n        _verticalContainer: function(container, up) {\n            var table = container.parent();\n            var length = this._navigatableTables.length;\n            var step = Math.floor(length / 2);\n            var index = inArray(table[0], this._navigatableTables);\n\n            if (up) {\n                step *= -1;\n            }\n            index += step;\n\n            if (index >= 0 || index < length) {\n                table = this._navigatableTables.eq(index);\n            }\n\n            return table.find(up ? \"thead\" : \"tbody\");\n        },\n\n        _updateCurrentAttr: function(current, next) {\n            var headerId = $(current).data(\"headerId\");\n\n            $(current)\n                .removeClass(classNames.focused)\n                .closest(\"table\")\n                .removeAttr(\"aria-activedescendant\");\n\n            if (headerId) {\n                headerId = headerId.replace(this._elementId, \"\");\n                $(current).attr(\"id\", headerId);\n            } else {\n                $(current).removeAttr(\"id\");\n            }\n\n            next\n                .data(\"headerId\", next.attr(\"id\"))\n                .attr(\"id\", this._elementId)\n                .addClass(classNames.focused)\n                .closest(\"table\")\n                .attr(\"aria-activedescendant\", this._elementId);\n\n            this._current = next;\n        },\n\n        _tableKeyDown: function(e) {\n            var handled = false;\n            var current = this.current();\n            var target = $(e.target);\n            var canHandle = !e.isDefaultPrevented() && !target.is(\":button,a,:input,a>.k-icon\");\n\n            current = current ? current : $(this.lockedTable).add(this.table).find(NAVROW + \" > td:visible\").first();\n\n            if (canHandle && e.keyCode == keys.UP) {\n                handled = this._moveUp(current, e.shiftKey);\n            }\n\n            if (canHandle && e.keyCode == keys.DOWN) {\n                handled = this._moveDown(current, e.shiftKey);\n            }\n\n            if (canHandle && e.keyCode == (isRtl ? keys.LEFT : keys.RIGHT)) {\n                if (e.altKey) {\n                    handled = this._handleExpand(current);\n                } else {\n                    handled = this._moveRight(current);\n                }\n            }\n\n            if (canHandle && e.keyCode == (isRtl ? keys.RIGHT : keys.LEFT)) {\n                if (e.altKey) {\n                    handled = this._handleCollapse(current);\n                } else {\n                    handled = this._moveLeft(current);\n                }\n            }\n\n            if (canHandle && e.keyCode == keys.PAGEDOWN) {\n                handled = this._handlePageDown();\n            }\n\n            if (canHandle && e.keyCode == keys.PAGEUP) {\n                handled = this._handlePageUp();\n            }\n\n            if (e.keyCode == keys.ENTER || e.keyCode == keys.F2) {\n                handled = this._handleEnterKey(current, e.currentTarget, target);\n            }\n\n            if (e.keyCode == keys.ESC) {\n                handled = this._handleEscKey(current, e.currentTarget);\n            }\n\n            if (canHandle && e.keyCode == keys.HOME) {\n                handled = this._handleHome(current, e.ctrlKey);\n            }\n\n            if (canHandle && e.keyCode == keys.END) {\n                handled = this._handleEnd(current, e.ctrlKey);\n            }\n\n            if (e.keyCode == keys.TAB) {\n                handled = this._handleTabKey(current, e.currentTarget, e.shiftKey);\n            }\n\n            if (handled) {\n                //prevent scrolling while pressing the keys\n                e.preventDefault();\n                //required in hierarchy\n                e.stopPropagation();\n            }\n        },\n\n        _handleExpand: function(current) {\n            var that = this;\n            var row = current.parent();\n            var model = that.dataItem(row);\n\n            if (current.hasClass(\"k-header\")) {\n                return false;\n            }\n\n            if (model && model.hasChildren && !model.expanded && !that.trigger(EXPAND, { model: model })) {\n                this.expand(row);\n                return true;\n            }\n\n            return false;\n        },\n\n        _handleCollapse: function(current) {\n            var that = this;\n            var row = current.parent();\n            var model = that.dataItem(row);\n\n            if (current.hasClass(\"k-header\")) {\n                return false;\n            }\n\n            if (model && model.hasChildren && model.expanded && !that.trigger(COLLAPSE, { model: model })) {\n                that.collapse(row);\n                return true;\n            }\n\n            return false;\n        },\n\n        _handleHome: function(current, ctrl) {\n            var row = current.parent();\n            var rowContainer = row.parent();\n            var isInLockedTable = this.lockedTable && this.lockedTable.children(\"tbody\")[0] === rowContainer[0];\n            var isInBody = rowContainer[0] === this.tbody[0];\n            var prev;\n\n            if (ctrl) {\n                if (this.lockedTable) {\n                    prev = this.lockedTable.find(NAVROW + \" > td:visible\").first();\n                } else {\n                    prev = this.table.find(NAVROW + \" > td:visible\").first();\n                }\n            } else if (isInBody || isInLockedTable) {\n                if (isInBody && this.lockedTable) {\n                    row = this._relatedRow(row);\n                }\n                prev = row.children(NAVCELL).first();\n            }\n\n            if (prev && prev.length) {\n                this.current(prev);\n                return true;\n            }\n        },\n\n        _handleEnd: function(current, ctrl) {\n            var row = current.parent();\n            var rowContainer = row.parent();\n            var isInLockedTable = this.lockedTable && this.lockedTable.children(\"tbody\")[0] === rowContainer[0];\n            var isInBody = rowContainer[0] === this.tbody[0];\n            var next;\n\n            if (ctrl) {\n                next = this.table.find(ITEMROW).last().children(NAVCELL).last();\n            } else if (isInBody || isInLockedTable) {\n                if (!isInBody && this.lockedTable) {\n                    row = this._relatedRow(row);\n                }\n                next = row.children(NAVCELL).last();\n            }\n\n            if (next && next.length) {\n                this.current(next);\n                return true;\n            }\n        },\n\n        _handlePageDown: function() {\n            var that = this;\n\n            if (!that._isPageable()) {\n                return false;\n            }\n\n            that.dataSource._restorePageSizeAfterAddChild();\n            that.dataSource.page(that.dataSource.page() + 1);\n\n            return true;\n        },\n\n        _handlePageUp: function() {\n            var that = this;\n\n            if (!that._isPageable()) {\n                return false;\n            }\n\n            that.dataSource._restorePageSizeAfterAddChild();\n            that.dataSource.page(that.dataSource.page() - 1);\n\n            return true;\n        },\n\n        _handleEscKey: function(current, currentTable) {\n            var active = kendo._activeElement();\n            var currentIndex;\n            var that = this;\n            var row;\n            var rowIndex;\n            var cellIndex;\n            var tbody;\n\n            if (!current || !current.parent().hasClass(\"k-grid-edit-row\")) {\n                if (current.has(active).length) {\n                    // return focus back to the table\n                    focusTable(currentTable, true);\n\n                    return true;\n                }\n                return false;\n            }\n\n            if (that._isIncellEditable()) {\n                row = current.parent();\n                cellIndex = current.index();\n                rowIndex = row.index();\n                tbody = row.closest(\"tbody\");\n\n                that.closeCell(true);\n\n                // refresh the current element as the DOM element reference can be changed after render()\n                // moving this to closeCell() causes flickering when clicking on a cell and then on another\n                // as 'k-state-focused' is shown for the closing cell and then added to the newly edited cell\n                that._setCurrent(tbody.children().eq(rowIndex).children().eq(cellIndex));\n            } else {\n                currentIndex = $(current).parent().index();\n                if (active) {\n                    active.blur();\n                }\n                this.cancelRow();\n                if (currentIndex >= 0) {\n                    this.current(this.items().eq(currentIndex).children(NAVCELL).first());\n                }\n            }\n\n            focusTable(currentTable, true);\n\n            return true;\n        },\n\n        _handleEnterKey: function(current, currentTable, target) {\n            var editable = this.options.editable;\n            var container = target.closest(\"[role=gridcell]\");\n            var focusable;\n\n            if (!target.is(\"table\") && !$.contains(current[0], target[0])) {\n                current = container;\n            }\n\n            if (current.is(\"th\")) {\n                // sort the column, if possible\n                current.find(\".k-link\").click();\n                return true;\n            }\n\n            focusable = current.find(\":kendoFocusable\").first();\n            if (focusable[0] && current.hasClass(\"k-state-focused\")) {\n                focusable.trigger(\"focus\");\n\n                return true;\n            }\n\n            if (editable && !target.is(\":button,.k-button,textarea\")) {\n                if (!container[0]) {\n                    container = current;\n                }\n\n                this._handleEditing(container, false, currentTable);\n\n                return true;\n            }\n\n            return false;\n        },\n\n        _handleTabKey: function(current, currentTable, shiftKey) {\n            var that = this;\n            var incellEditing = that.options.editable && that._isIncellEditable();\n            var cell;\n\n            if (!incellEditing || current.is(\"th\")) {\n                return false;\n            }\n\n            cell = $(activeElement()).closest(DOT + classNames.editCell);\n\n            if (cell[0] && cell[0] !== current[0]) {\n                current = cell;\n            }\n\n            cell = that._tabNext(current, currentTable, shiftKey);\n\n            if (cell.length) {\n                that._handleEditing(current, cell, cell.closest(TABLE));\n                return true;\n            } else {\n                that._preventPageSizeRestore = false;\n            }\n\n            return false;\n        },\n\n        _tabNext: function(current, currentTable, back) {\n            var that = this;\n            var switchRow = true;\n            var next = back ? current.prevAll(DATA_CELL).first() : current.nextAll(\":visible\").first();\n\n            if (!next.length) {\n                next = current.parent();\n                if (that.lockedTable) {\n                    switchRow = (back && currentTable == that.lockedTable[0]) || (!back && currentTable == that.table[0]);\n                    next = that._relatedRow(next);\n                }\n\n                if (switchRow) {\n                    next = next[back ? \"prevAll\" : \"nextAll\"](\"tr:not(.k-grouping-row):not(.k-detail-row):visible\").first();\n                }\n\n                if (back) {\n                    next = next.children(DATA_CELL).last();\n                } else {\n                    next = next.children(DATA_CELL).first();\n                }\n\n\n                that.dataSource._restorePageSizeAfterAddChild();\n            }\n\n            return next;\n        },\n\n        _handleEditing: function(current, next, table) {\n            var that = this,\n                active = $(kendo._activeElement()),\n                isIE = browser.msie,\n                editContainer,\n                focusable,\n                isEdited;\n            var editable = that.options.editable && that.options.editable.update !== false;\n            var incellEditing = that._isIncellEditable();\n            var nextFocusableCellRowIndex = $(next).parents(\"tr\").index();\n            var nextFocusableCellIndex = $(next).index();\n            var currentFocusedCellRowIndex = $(current).parents(\"tr\").index();\n            var currentFocusedCellIndex = current.index();\n            var editedCell;\n\n            table = $(table);\n\n            if (incellEditing) {\n                isEdited = current.hasClass(classNames.editCell);\n            } else {\n                isEdited = current.parent().hasClass(\"k-grid-edit-row\");\n            }\n\n            if (that.editor) {\n                editContainer = that.editor.wrapper;\n                if (editContainer && $.contains(editContainer[0], active[0])) {\n                    if (browser.opera) {\n                        active.trigger(\"blur\").change().triggerHandler(\"blur\");\n                    } else {\n                        active.trigger(\"blur\");\n                        if (isIE) {\n                            //IE10 with jQuery 1.9.x does not trigger blur handler\n                            //numeric textbox does trigger change\n                            active.trigger(\"blur\");\n                        }\n                    }\n                }\n\n                if (!that.editor) {\n                    focusTable(table);\n                    return;\n                }\n\n                if (that.editor.end()) {\n                    if (incellEditing) {\n                        that._preventPageSizeRestore = true;\n                        that.closeCell();\n                        that._preventPageSizeRestore = false;\n\n                        if ($(that.table).add(that.lockedTable).find(DOT + classNames.editCell).length === 0) {\n                            that.current(table.find(\"tbody\").children().eq(currentFocusedCellRowIndex).children().eq(currentFocusedCellIndex));\n                        }\n                    } else {\n                        that.saveRow();\n                        isEdited = true;\n                    }\n                } else {\n                    if (incellEditing) {\n                        that.current(editContainer);\n                    } else {\n                        that.current(editContainer.children().filter(NAVCELL).first());\n                    }\n\n                    focusable = editContainer.find(\":kendoFocusable\").first()[0];\n                    if (focusable) {\n                        focusable.focus();\n                    }\n                    return;\n                }\n            }\n\n            // the next cell to focus might be re-rendered, so update the reference to it if it is an element\n            next = $(next).length && table.find(next).length === 0 ? table.find(\"tbody\").children().eq(nextFocusableCellRowIndex).children().eq(nextFocusableCellIndex) : next;\n\n            if (next) {\n                that.current(next);\n            }\n\n            focusTable(table, true);\n\n            if (!editable) {\n                return;\n            }\n\n            if ((!isEdited && !next) || next) {\n                var currentIndex = that.current().index();\n\n                if (incellEditing) {\n                    that.editCell(that.current());\n\n                    editedCell = $(that.table).add(that.lockedTable).find(DOT + classNames.editCell)[0];\n\n                    if (editedCell) {\n                        that._current = $(editedCell);\n                    } else {\n                        that.current(that._findCurrentCell());\n                    }\n                } else {\n                    that.editRow(that.current().parent());\n                    that.current(that.editor.wrapper.children().eq(currentIndex));\n                    that.current().removeClass(\"k-state-focused\");\n                }\n            } else {\n                that.dataSource._restorePageSizeAfterAddChild();\n            }\n        },\n\n        _moveRight: function(current) {\n            var next = current.nextAll(NAVCELL).first();\n            var row = current.parent();\n            var rowIndex = row.index();\n\n            if (current.hasClass(\"k-header\") || row.is('.k-filter-row')) {\n                next = current.nextAll(NAVHEADER).first();\n                if (!next[0] && this.lockedTable && current.closest(\"table\")[0] === this.lockedHeader.find(\"table\")[0]) {\n                    next = this.thead.find(\"tr\").eq(rowIndex).find(NAVHEADER).first();\n                }\n            }\n\n            if (!next[0] && this.lockedTable && current.closest(\"table\")[0] === this.lockedTable[0]) {\n               next = this._relatedRow(row).children(NAVCELL).first();\n            }\n\n            if (next[0] && next[0] !== current[0]) {\n                focusTable(next.closest(\"table\"), true);\n            }\n\n            this.current(next);\n\n            return true;\n        },\n\n        _moveLeft: function(current) {\n            var prev = current.prevAll(NAVCELL).first();\n            var row = current.parent();\n            var rowIndex = row.index();\n\n            if (current.hasClass(\"k-header\") || row.is('.k-filter-row')) {\n                prev = current.prevAll(NAVHEADER).first();\n                if (!prev[0] && this.lockedTable && current.closest(\"table\")[0] === this.thead.parent()[0]) {\n                    prev = this.lockedHeader.find(\">table>thead>tr\").eq(rowIndex).children(NAVHEADER).last();\n                }\n            }\n\n            if (!prev[0] && this.lockedTable && current.closest(\"table\")[0] === this.table[0]) {\n               prev = this._relatedRow(row).children(NAVCELL).last();\n            }\n\n            if (prev[0] && prev[0] !== current[0]) {\n                focusTable(prev.closest(\"table\"), true);\n            }\n\n            this.current(prev);\n\n            return true;\n        },\n\n        _moveUp: function(current, shiftKey) {\n            var container = current.parent().parent();\n            var prev;\n\n            if (shiftKey) {\n               prev = current.parent();\n               prev = prev.prevAll(ITEMROW).first();\n               prev = current.parent().is(ITEMROW) ? prev.children().eq(current.index()) : prev.children(DATA_CELL).last();\n            } else {\n               prev = this._prevVerticalCell(container, current);\n               if (!prev[0]) {\n                  this._lastCellIndex = 0;\n                  container = this._verticalContainer(container, true);\n\n                  prev = this._prevVerticalCell(container, current);\n\n                  if (prev[0]) {\n                      focusTable(container.parent(), true);\n                  }\n               }\n            }\n\n            var tmp = this._lastCellIndex || 0;\n            this.current(prev);\n            this._lastCellIndex = tmp;\n\n            return true;\n        },\n\n        _moveDown: function(current, shiftKey) {\n            var container = current.parent().parent();\n            var next;\n\n            if (shiftKey) {\n                next = current.parent();\n                next = next.nextAll(ITEMROW).first();\n                next = current.parent().is(ITEMROW) ? next.children().eq(current.index()) : next.children(DATA_CELL).first();\n            } else {\n                next = this._nextVerticalCell(container, current);\n                if (!next[0]) {\n                    this._lastCellIndex = 0;\n                    container = this._verticalContainer(container);\n\n                    next = this._nextVerticalCell(container, current);\n                    if (next[0]) {\n                        focusTable(container.parent(), true);\n                    }\n                }\n            }\n            var tmp = this._lastCellIndex || 0;\n            this.current(next);\n            this._lastCellIndex = tmp;\n            return true;\n        },\n\n        _tableClick: function(e) {\n            var currentTarget = $(e.currentTarget),\n                isHeader = currentTarget.is(\"th\"),\n                table = this.table.add(this.lockedTable),\n                headerTable = this.thead.parent().add($(\">table\", this.lockedHeader)),\n                isInput = isInputElement(e.target),\n                currentTable = currentTarget.closest(\"table\")[0];\n\n            if (kendo.support.touch) {\n                return;\n            }\n\n            if (currentTable !== table[0] && currentTable !== table[1] && currentTable !== headerTable[0] && currentTable !== headerTable[1]) {\n                return;\n            }\n\n            if (this.options.navigatable) {\n                this.current(currentTarget);\n            }\n\n            if (isHeader || !isInput) {\n                setTimeout(function() {\n                   if (!isInputElement(kendo._activeElement()) || !$.contains(currentTable, kendo._activeElement())) {\n                       focusTable(currentTable, true);\n                   }\n                });\n            }\n\n            if (isHeader) {\n                e.preventDefault(); //if any problem occurs, call preventDefault only for the clicked header links\n            }\n        },\n\n        _setTabIndex: function(table) {\n            this._navigatableTables.attr(TABINDEX, -1);\n\n            table.attr(TABINDEX, 0);\n        },\n\n        _tableFocus: function(e) {\n            var current = this.current();\n            var table = $(e.currentTarget);\n\n            if (current && current.is(\":visible\")) {\n                current.addClass(classNames.focused);\n            } else {\n                this.current(table.find(NAVROW + \" > td:visible\").first());\n            }\n\n            this._setTabIndex(table);\n        },\n\n        _tableBlur: function() {\n            var current = this.current();\n\n            if (current) {\n                current.removeClass(classNames.focused);\n            }\n        },\n\n        _attachEvents: function() {\n            var that = this;\n            var retryButton = DOT + classNames.retry;\n\n            that._userEvents = new kendo.UserEvents(that.element, {\n                press: that._onPress.bind(that),\n                allowSelection: true\n            });\n\n            this.element\n                .on(CLICK + NS, retryButton, this._dataSourceFetchProxy)\n                .on(CLICK + NS, \".k-button[data-command]\", this._commandClick.bind(this))\n                .on(INPUT + NS, \".k-grid-search input\", this._search.bind(this));\n\n            this._attachCellEditingEventHandlers();\n        },\n\n        _onPress: function(e) {\n            var that = this;\n            var icons = DOT + classNames.iconCollapse +\n                \", .\" + classNames.iconExpand +\n                \", .\" + classNames.refresh;\n\n            if ($(e.event.target).is(icons)) {\n                that._toggleChildren.call(that, e.event);\n            }\n        },\n\n        _attachCellEditingEventHandlers: function() {\n            var that = this;\n            var editable = that.options.editable;\n            var selectable = that.selectable && that.selectable.options.multiple;\n            var closeCell = function(e) {\n                var target = activeElement();\n                var editor = that.editor || {};\n                var cell = editor.element;\n\n                if (cell && !$.contains(cell[0], target) && cell[0] !== target && !$(target).closest(\".k-animation-container\").length) {\n                    if (editor.end()) {\n                        if (!e.relatedTarget && that._isPageable() && !isUndefined(that.dataSource._addChildPageSize)) {\n                            that._preventPageSizeRestore = false;\n                        }\n\n                        that.closeCell();\n                    }\n                }\n\n                that._preventPageSizeRestore = false;\n            };\n\n            if (that._isIncellEditable() && editable.update !== false) {\n                that.wrapper\n                    .on(CLICK + NS, \"tr:not(.k-grouping-row) > td\", function(e) {\n                        var td = $(this),\n                            isLockedCell = that.lockedTable && td.closest(\"table\")[0] === that.lockedTable[0];\n\n                        if (td.hasClass(classNames.editCell) ||\n                            td.has(\"a.k-grid-delete\").length ||\n                            td.has(\"button.k-grid-delete\").length ||\n                            (td.closest(\"tbody\")[0] !== that.tbody[0] && !isLockedCell) ||\n                            $(e.target).is(\":input\") ||\n                            $(e.target).hasClass(classNames.iconExpand) ||\n                            $(e.target).hasClass(classNames.iconCollapse)) {\n\n                            if (!that.editor) {\n                                that.dataSource._restorePageSizeAfterAddChild();\n                            }\n\n                            that._preventPageSizeRestore = false;\n\n                            return;\n                        }\n\n                        if (that.editor) {\n                            if (that.editor.end()) {\n                                if (selectable) {\n                                    $(activeElement()).trigger(\"blur\");\n                                }\n                                that.closeCell();\n                                that.editCell(td);\n                            }\n                        } else {\n                            that.editCell(td);\n                        }\n                    })\n                    .on(\"mousedown\" + NS, \"tr:not(.k-grouping-row) > td\", function(e) {\n                        // cache the result on \"mousedown\", which is fired before \"focusout\" and \"click\"\n                        if (that.editor && that._isPageable() && !isUndefined(that.dataSource._addChildPageSize)) {\n                            that._preventPageSizeRestore = $(e.target).parents(DOT + classNames.editRow).length > 0;\n                        } else {\n                            that._preventPageSizeRestore = false;\n                        }\n                    })\n                    .on(\"focusin\" + NS, function() {\n                        // fix focus issue in IE\n                        if (!$.contains(this, activeElement())) {\n                            clearTimeout(that._closeCellTimeout);\n                            that._closeCellTimeout = null;\n                        }\n                    })\n                    .on(\"focusout\" + NS, function(e) {\n                        that._closeCellTimeout = setTimeout(function() {\n                            closeCell(e);\n                        }, 1);\n                    });\n            }\n        },\n\n        _commandByName: function(name) {\n            var columns = this.columns;\n            var toolbar = Array.isArray(this.options.toolbar) ? this.options.toolbar : [];\n            var i, j, commands, currentName;\n\n            name = name.toLowerCase();\n\n            if (defaultCommands[name]) {\n                return defaultCommands[name];\n            }\n\n            // command not found in defaultCommands, must be custom\n            for (i = 0; i < columns.length; i++) {\n                commands = columns[i].command;\n                if (commands) {\n                    for (j = 0; j < commands.length; j++) {\n                        currentName = commands[j].name;\n\n                        if (!currentName) {\n                            continue;\n                        }\n\n                        if (currentName.toLowerCase() == name) {\n                            return commands[j];\n                        }\n                    }\n                }\n            }\n\n            // custom command in toolbar\n            for (i = 0; i < toolbar.length; i++) {\n                currentName = toolbar[i].name;\n\n                if (!currentName) {\n                    continue;\n                }\n\n                if (currentName.toLowerCase() == name) {\n                    return toolbar[i];\n                }\n            }\n        },\n\n        _commandClick: function(e) {\n            var button = $(e.currentTarget);\n            var commandName = button.attr(\"data-command\");\n            var command = this._commandByName(commandName);\n            var row = button.parentsUntil(this.wrapper, \"tr\");\n\n            row = row.length ? row : undefined;\n\n            if (command) {\n                if (command.methodName) {\n                    this[command.methodName](row);\n                } else if (command.click) {\n                    command.click.call(this, e);\n                }\n\n                e.preventDefault();\n            }\n        },\n\n        _search: function(e) {\n            var that = this;\n            var input = e.currentTarget;\n            clearTimeout(that._searchTimeOut);\n            that._searchTimeOut = setTimeout(function() {\n                that._searchTimeOut = null;\n                var options = that.options;\n                var searchFields = options.search ? options.search.fields : null;\n                var expression = { filters: [], logic: \"or\" };\n                var value = input.value;\n\n                if (!searchFields) {\n                    searchFields = getColumnsFields(options.columns);\n                }\n\n                if (value) {\n                    for (var i = 0; i < searchFields.length; i++) {\n                        expression.filters.push({ field: searchFields[i], operator: \"contains\", value: value });\n                    }\n                } else {\n                    expression = {};\n                }\n\n                that.dataSource.filter(expression);\n\n            }, 300);\n        },\n\n        _ensureExpandableColumn: function() {\n            if (this._autoExpandable) {\n                delete this._autoExpandable.expandable;\n            }\n\n            var visibleColumns = grep(this.columns, not(is(\"hidden\")));\n            visibleColumns = grep(visibleColumns, not(is(\"command\")));\n            visibleColumns = grep(visibleColumns, not(is(\"selectable\")));\n            var expandableColumns = grep(visibleColumns, is(\"expandable\"));\n\n            if (this.columns.length && !expandableColumns.length) {\n                this._autoExpandable = visibleColumns[0];\n                visibleColumns[0].expandable = true;\n            }\n        },\n\n        _columns: function() {\n            var that = this;\n            var columns = this.options.columns || [];\n\n            this.columns = map(columns, function(column) {\n                column = (typeof column === \"string\") ? { field: column } : column;\n\n                return extend({ encoded: true }, column);\n            });\n\n            var lockedCols = lockedColumns(columns);\n            if (lockedCols.length > 0) {\n                if (this.options.rowTemplate || this.options.altRowTemplate) {\n                    throw new Error(\"Having both row template and locked columns is not supported\");\n                }\n                this._hasLockedColumns = true;\n                this.columns = lockedCols.concat(nonLockedColumns(this.columns));\n            }\n\n            this.columns = normalizeColumns(this.columns);\n\n            this._ensureExpandableColumn();\n\n            this._columnTemplates();\n            this._columnAttributes();\n\n            if ($.grep(leafColumns(that.columns), function(col) {\n                if (col.selectable) {\n                    that._includeChildren = col.includeChildren;\n                }\n                return col.selectable;\n            }).length) {\n                that._checkBoxSelection = true;\n                that.element.on(CLICK + NS, \"tbody > tr \" + CHECKBOXINPUT, that._checkboxClick.bind(that));\n                that.element.on(CLICK + NS, \"thead > tr \" + CHECKBOXINPUT, that._headerCheckboxClick.bind(that));\n            }\n        },\n\n        _columnTemplates: function() {\n            var idx, length, column;\n            var columns = leafColumns(this.columns);\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                column = columns[idx];\n                if (column.template) {\n                    column.template = kendo.template(column.template);\n                }\n\n                if (this._isIncellEditable()) {\n                    column.dirtyCellTemplate = this._createDirtyColumnTemplate(column);\n                    column.dirtyIndicatorTemplate = this._createIndicatorTemplate(column);\n                }\n\n                if (column.headerTemplate) {\n                    column.headerTemplate = kendo.template(column.headerTemplate);\n                }\n\n                if (column.footerTemplate) {\n                    column.footerTemplate = kendo.template(column.footerTemplate);\n                }\n            }\n        },\n\n        _columnAttributes: function() {\n            // column style attribute is string, kendo.dom expects object\n            var idx, length;\n            var columns = this.columns;\n\n            function convertStyle(attr) {\n                var properties, i, declaration;\n\n                if (attr && attr.style && attr.style.split) {\n                    properties = attr.style.split(\";\");\n                    attr.style = {};\n\n                    for (i = 0; i < properties.length; i++) {\n                        declaration = properties[i].split(\":\");\n\n                        var name = kendo.trim(declaration[0]);\n\n                        if (name) {\n                            attr.style[$.camelCase(name)] = kendo.trim(declaration[1]);\n                        }\n                    }\n                }\n            }\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                convertStyle(columns[idx].attributes);\n                convertStyle(columns[idx].headerAttributes);\n            }\n        },\n\n        _clearSortClasses: function() {\n            var that = this;\n\n            if (that.content) {\n                that.content.find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").removeClass(\"k-sorted\");\n            }\n\n            if (that.lockedContent) {\n                that.lockedContent.find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").removeClass(\"k-sorted\");\n            }\n        },\n\n        _layout: function() {\n            var columns = this.columns;\n            var element = this.element;\n            var layout = \"\";\n\n            this.wrapper = element.addClass(classNames.wrapper);\n\n            layout = \"<div class='#= gridHeader #'>\";\n\n            if (this._hasLockedColumns) {\n                layout += \"<div class='k-grid-header-locked'>\" +\n                                \"<table role='grid'>\" +\n                                    \"<colgroup></colgroup>\" +\n                                    \"<thead role='rowgroup'></thead>\" +\n                                \"</table>\" +\n                            \"</div>\";\n            }\n\n            layout += \"<div class='#= gridHeaderWrap #'>\" +\n                            \"<table role='grid'>\" +\n                                \"<colgroup></colgroup>\" +\n                                \"<thead role='rowgroup'></thead>\" +\n                            \"</table>\" +\n                        \"</div>\" +\n                        \"</div>\";\n\n            if (this._hasLockedColumns) {\n                layout += \"<div class='k-grid-content-locked'>\" +\n                                \"<table role='treegrid' tabindex='0'>\" +\n                                    \"<colgroup></colgroup>\" +\n                                    \"<tbody></tbody>\" +\n                                \"</table>\" +\n                            \"</div>\";\n            }\n\n            layout += \"<div class='#= gridContentWrap # k-auto-scrollable'>\" +\n                            \"<table role='treegrid' tabindex='0'>\" +\n                                \"<colgroup></colgroup>\" +\n                                \"<tbody></tbody>\" +\n                            \"</table>\" +\n                        \"</div>\";\n\n            if (!this.options.scrollable) {\n                layout =\n                    \"<table role='treegrid' tabindex='0'>\" +\n                        \"<colgroup></colgroup>\" +\n                        \"<thead class='#= gridHeader #' role='rowgroup'></thead>\" +\n                        \"<tbody></tbody>\" +\n                    \"</table>\";\n            }\n\n            if (this.options.toolbar) {\n                layout = \"<div class='#= toolbar # #= gridToolbar #'></div>\" + layout;\n            }\n\n            element.append(\n                kendo.template(layout)(classNames) +\n                \"<div class='k-status' role='alert' aria-live='polite'></div>\"\n            );\n\n            this.toolbar = element.find(DOT + classNames.gridToolbar);\n\n            var header = element.find(DOT + classNames.gridHeader).find(\"thead\").addBack().filter(\"thead\");\n            this.thead = header.last();\n\n            if (this.options.scrollable) {\n                var rtl = kendo.support.isRtl(element);\n\n                element.find(\"div.\" + classNames.gridHeader)\n                    .css(rtl ? \"padding-left\" : \"padding-right\", kendo.support.scrollbar());\n            }\n\n\n            var content = element.find(DOT + classNames.gridContentWrap);\n            if (!content.length) {\n                content = element;\n            } else {\n                this.content = content;\n            }\n\n            this.table = content.find(\">table\");\n            this.tbody = this.table.find(\">tbody\");\n\n            if (this._hasLockedColumns) {\n                this.lockedHeader = header.first().closest(\".k-grid-header-locked\");\n                this.lockedContent = element.find(\".k-grid-content-locked\");\n                this.lockedTable = this.lockedContent.children();\n            }\n\n            this._initVirtualTrees();\n\n            this._renderCols();\n            this._renderHeader();\n\n            this.angular(\"compile\", function() {\n                return {\n                    elements: header.find(\"th.k-header\").get(),\n                    data: map(columns, function(col) { return { column: col }; })\n                };\n            });\n        },\n\n        _initVirtualTrees: function() {\n            this._headerColsTree = new kendoDom.Tree(this.thead.prev()[0]);\n            this._contentColsTree = new kendoDom.Tree(this.tbody.prev()[0]);\n            this._headerTree = new kendoDom.Tree(this.thead[0]);\n            this._contentTree = new kendoDom.Tree(this.tbody[0]);\n            this._statusTree = new kendoDom.Tree(this.element.children(\".k-status\")[0]);\n\n            if (this.lockedHeader) {\n                this._lockedHeaderColsTree = new kendoDom.Tree(this.lockedHeader.find(\"colgroup\")[0]);\n                this._lockedContentColsTree = new kendoDom.Tree(this.lockedTable.find(\">colgroup\")[0]);\n                this._lockedHeaderTree = new kendoDom.Tree(this.lockedHeader.find(\"thead\")[0]);\n                this._lockedContentTree = new kendoDom.Tree(this.lockedTable.find(\">tbody\")[0]);\n            }\n        },\n\n        _toolbar: function() {\n            var options = this.options.toolbar;\n            var toolbar = this.toolbar;\n\n            if (!options) {\n                return;\n            }\n\n            if (Array.isArray(options)) {\n                var buttons = this._buildCommands(options);\n                new kendoDom.Tree(toolbar[0]).render(buttons);\n            } else {\n                toolbar.append(kendo.template(options)({}));\n            }\n\n            this.angular(\"compile\", function() {\n                return { elements: toolbar.get() };\n            });\n        },\n\n        _lockedColumns: function() {\n            return grep(this.columns, is(\"locked\"));\n        },\n\n        _nonLockedColumns: function() {\n            return grep(this.columns, not(is(\"locked\")));\n        },\n\n        _templateColumns: function() {\n            return grep(this.columns, is(\"template\"));\n        },\n\n        _flushCache: function() {\n            if (this.options.$angular && this._templateColumns().length) {\n                this._contentTree.render([]);\n                if (this._hasLockedColumns) {\n                    this._lockedContentTree.render([]);\n                }\n            }\n        },\n\n        _render: function(options) {\n            var that = this;\n            options = options || {};\n            options = that._renderOptions(options);\n            var messages = this.options.messages;\n            var pageable = that._isPageable();\n            var dataSource = that.dataSource;\n\n            var maps = { children: (options.filteredChildrenMap || options.childrenMap), ids: options.idsMap };\n            var dataMaps = pageable ? (maps && maps.children && maps.ids ? maps : dataSource._initDataMaps(dataSource._getData())) : {};\n            var childrenMap = dataMaps.children;\n            var idsMap = dataMaps.ids;\n            options.childrenMap = childrenMap;\n            options.idsMap = idsMap;\n\n            var data = that._dataToRender(options);\n            var level = that._renderedModelLevel(data[0], options);\n            var uidAttr = kendo.attr(\"uid\");\n            var hasFooterTemplate;\n            var selected = this.select().removeClass(\"k-state-selected\").map(function(_, row) {\n                return $(row).attr(uidAttr);\n            });\n            var viewChildrenMap;\n\n            this._absoluteIndex = 0;\n\n            this._angularItems(\"cleanup\");\n            this._angularFooters(\"cleanup\");\n            this._flushCache();\n\n            that._clearRenderMap();\n\n            if (options.error) {\n                // root-level error message\n                this._showStatus(kendo.template(\n                    \"#: messages.requestFailed # \" +\n                    \"<button class='#= buttonClass # k-button-md k-rounded-md k-button-solid k-button-solid-base'><span class='k-button-text'>#: messages.retry #</span></button>\"\n                )({\n                    buttonClass: [classNames.button, classNames.retry].join(\" \"),\n                    messages: messages\n                }));\n            } else if (!data.length) {\n                // no rows message\n                this._hideStatus();\n                this._showNoRecordsTemplate();\n            } else {\n                if (pageable) {\n                    viewChildrenMap = that._viewChildrenMap(options);\n                }\n\n                // render rows\n                this._hideStatus();\n\n                hasFooterTemplate = this._hasFooterTemplate();\n\n                this._contentTree.render(this._trs({\n                    columns: leafColumns(nonLockedColumns(this.columns)),\n                    editedColumn: options.editedColumn,\n                    editedColumnIndex: options.editedColumnIndex,\n                    aggregates: options.aggregates,\n                    selected: selected,\n                    data: data,\n                    childrenMap: childrenMap,\n                    viewChildrenMap: viewChildrenMap,\n                    hasFooterTemplate: hasFooterTemplate,\n                    visible: true,\n                    level: 0\n                }));\n\n                if (this._hasLockedColumns) {\n                    this._absoluteIndex = 0;\n                    this._lockedContentTree.render(this._trs({\n                        columns: leafColumns(lockedColumns(this.columns)),\n                        editedColumn: options.editedColumn,\n                        editedColumnIndex: options.editedColumnIndex,\n                        aggregates: options.aggregates,\n                        selected: selected,\n                        data: data,\n                        childrenMap: childrenMap,\n                        viewChildrenMap: viewChildrenMap,\n                        hasFooterTemplate: hasFooterTemplate,\n                        visible: true,\n                        level: level\n                    }));\n                }\n            }\n\n            if (this._touchScroller) {\n                this._touchScroller.contentResized();\n            }\n\n            this._muteAngularRebind(function() {\n                this._angularItems(\"compile\");\n                this._angularFooters(\"compile\");\n            });\n\n            this.items().filter(function() {\n                return $.inArray($(this).attr(uidAttr), selected) >= 0;\n            })\n            .addClass(\"k-state-selected\");\n\n            this._syncLockedContentHeight();\n\n            that._togglePagerVisibility();\n\n            that._setExpanderElement();\n        },\n\n        _setExpanderElement: function() {\n            var that = this,\n                hiddenDivClass = 'k-grid-content-expander',\n                hiddenDiv = '<div class=\"' + hiddenDivClass + '\"></div>',\n                expander;\n\n            if (that.options.scrollable && that.wrapper.is(\":visible\")) {\n                expander = that.table.parent().children('.' + hiddenDivClass);\n                if (!that.dataSource || !that.dataSource.view().length) {\n                    if (!expander[0]) {\n                        expander = $(hiddenDiv).appendTo(that.table.parent());\n                    }\n                    if (that.thead) {\n                        expander.width(that.thead.width());\n                    }\n                } else if (expander[0]) {\n                    expander.remove();\n                }\n            }\n        },\n\n        _renderProgress: function(toggle) {\n            kendo.ui.progress(this.wrapper, toggle);\n        },\n\n        _renderOptions: function(options) {\n            options = options || {};\n            var that = this;\n            var dataMaps = that.dataSource._getDataMaps();\n            var filter = that.dataSource.filter();\n\n            if (that._isPageable()) {\n                options.childrenMap = dataMaps.children;\n                options.idsMap = dataMaps.ids;\n\n                if (filter) {\n                    options.filteredChildrenMap = dataMaps.filteredChildren;\n                }\n            }\n\n            return options;\n        },\n\n        _renderedModelLevel: function(model, options) {\n            return !this._isPageable() ? 0 : this.dataSource._pageableModelLevel(model, options);\n        },\n\n        _viewChildrenMap: function(options) {\n            options = options || {};\n            var that = this;\n            var dataSource = that.dataSource;\n            var viewChildrenMap = dataSource.childrenMap(dataSource.view());\n            var idField = dataSource._modelIdField();\n            var parentsNotInView = dataSource._parentNodesNotInView();\n            var parentNotInView;\n            var parentNotInViewId;\n            var parents;\n            var parent;\n            var parentId;\n            var child;\n            var childId;\n            var parentsCopy;\n\n            that._clearRenderMap();\n\n            for (var i = 0; i < parentsNotInView.length; i++) {\n                parentNotInView = parentsNotInView[i];\n                parentNotInViewId = parentNotInView[idField];\n\n                that._markNodeAsNonRenderable(parentNotInViewId);\n\n                viewChildrenMap[parentNotInViewId] = viewChildrenMap[parentNotInViewId] || [];\n\n                parents = dataSource._parentNodes(parentNotInView);\n\n                // copy the items to avoid mutating the original collection\n                parentsCopy = parents.slice();\n                parentsCopy.push(parentNotInView);\n\n                for (var parentIndex = 0; parentIndex < parentsCopy.length - 1; parentIndex++) {\n                    parent = parentsCopy[parentIndex];\n                    parentId = parent[idField];\n                    that._markNodeAsNonRenderable(parentId);\n                    viewChildrenMap[parentId] = viewChildrenMap[parentId] || [];\n\n                    child = parentsCopy[parentIndex + 1];\n                    childId = child[idField];\n                    that._markNodeAsNonRenderable(childId);\n                    viewChildrenMap[childId] = viewChildrenMap[childId] || [];\n\n                    if (viewChildrenMap[parentId].indexOf(child) === -1) {\n                        viewChildrenMap[parentId].unshift(child);\n                    }\n                }\n            }\n\n            return viewChildrenMap;\n        },\n\n        _clearRenderMap: function() {\n            this._skipRenderingMap = {};\n        },\n\n        _dataToRender: function(options) {\n            var that = this;\n\n            if (that._isPageable()) {\n                return that.dataSource._pageableRootNodes(options);\n            }\n\n            return that.dataSource.rootNodes();\n        },\n\n        _markNodeAsNonRenderable: function(nodeId) {\n            this._skipRenderingMap[nodeId] = true;\n        },\n\n        _adjustRowsHeight: function(table1, table2) {\n            if (!this._hasLockedColumns) {\n                return;\n            }\n\n            var rows = table1[0].rows;\n            var length = rows.length;\n            var idx;\n            var rows2 = table2[0].rows;\n            var containers = table1.add(table2);\n            var containersLength = containers.length;\n            var heights = [];\n\n            for (idx = 0; idx < length; idx++) {\n                if (!rows2[idx]) {\n                    break;\n                }\n\n                if (rows[idx].style.height) {\n                    rows[idx].style.height = rows2[idx].style.height = \"\";\n                }\n            }\n\n            for (idx = 0; idx < length; idx++) {\n                if (!rows2[idx]) {\n                    break;\n                }\n\n                var offsetHeight1 = rows[idx].offsetHeight;\n                var offsetHeight2 = rows2[idx].offsetHeight;\n                var height = 0;\n\n                if (offsetHeight1 > offsetHeight2) {\n                    height = offsetHeight1;\n                } else if (offsetHeight1 < offsetHeight2) {\n                    height = offsetHeight2;\n                }\n\n                heights.push(height);\n            }\n\n            for (idx = 0; idx < containersLength; idx++) {\n                containers[idx].style.display = \"none\";\n            }\n\n            for (idx = 0; idx < length; idx++) {\n                if (heights[idx]) {\n                    //add one to resolve row misalignment in IE\n                    rows[idx].style.height = rows2[idx].style.height = (heights[idx] + 1) + \"px\";\n                }\n            }\n\n            for (idx = 0; idx < containersLength; idx++) {\n                containers[idx].style.display = \"\";\n            }\n        },\n\n        _ths: function(columns, rowSpan) {\n            var ths = [];\n            var column, title, children, cellClasses, attr, headerContent;\n            var index;\n            var leafs;\n\n            for (var i = 0, length = columns.length; i < length; i++) {\n                column = columns[i];\n                children = [];\n                cellClasses = [classNames.header];\n\n                if (column.selectable) {\n                    leafs = leafColumns(columns);\n                    index = inArray(column, leafs);\n                    attr = {\n                        scope: \"col\",\n                        role: \"columnheader\",\n                        className: cellClasses.join(\" \")\n                    };\n\n                    if (column.headerTemplate) {\n                        title = column.headerTemplate({});\n                    }\n\n                    title = column.headerTemplate ? title : kendo.template(SELECTCOLUMNHEADERTMPL)({});\n\n\n                    if (rowSpan && !column.colSpan) {\n                        attr.rowSpan = rowSpan;\n                    }\n\n                    if (index > -1) {\n                        attr[kendo.attr(\"index\")] = index;\n                    }\n\n                    children.push(kendoHtmlElement(title));\n\n                    ths.push(kendoDomElement(\"th\", $.extend(true, {}, attr, column.headerAttributes), children));\n                    continue;\n                }\n\n                if (column.headerTemplate) {\n                    title = column.headerTemplate({});\n                } else {\n                    title = column.title || column.field || \"\";\n                }\n\n                if (column.headerTemplate) {\n                    headerContent = kendoHtmlElement(title);\n                } else {\n                    headerContent = kendoTextElement(title);\n                }\n\n                if (this.options.sortable) {\n                    children.push(kendoDomElement(\"span\", { className: classNames.headerCellInner }, [\n                        kendoDomElement(\"span\", { className: classNames.link }, [\n                            kendoDomElement(\"span\", { className: classNames.columnTitle }, [\n                                headerContent\n                            ])\n                        ])\n                    ]));\n                } else {\n                    children.push(headerContent);\n                }\n\n                attr = {\n                    \"data-field\": column.field,\n                    \"data-title\": column.title,\n                    \"style\": column.hidden === true ? { \"display\": \"none\" } : {},\n                    className: cellClasses.join(\" \"),\n                    \"role\": \"columnheader\"\n                };\n\n                if (!column.columns) {\n                    attr.rowSpan = rowSpan ? rowSpan : 1;\n                }\n\n                if (column.headerAttributes) {\n                    if (column.headerAttributes.colSpan === 1) {\n                        delete column.headerAttributes.colSpan;\n                    }\n                    if (column.headerAttributes[\"class\"]) {\n                        attr.className += \" \" + column.headerAttributes[\"class\"];\n                        delete column.headerAttributes[\"class\"];\n                    }\n                }\n\n                if (column[\"data-index\"] > -1) {\n                    attr[\"data-index\"] = column[\"data-index\"];\n                }\n\n                attr = extend(true, {}, attr, column.headerAttributes);\n\n                ths.push(kendoDomElement(\"th\", attr, children));\n            }\n\n            return ths;\n        },\n\n        _cols: function(columns) {\n            var cols = [];\n            var width, attr;\n\n            for (var i = 0; i < columns.length; i++) {\n                if (columns[i].hidden === true) {\n                    continue;\n                }\n\n                width = columns[i].width;\n                attr = {};\n\n                if (width && parseInt(width, 10) !== 0) {\n                    attr.style = {\n                        width: typeof width === \"string\" ? width : width + \"px\"\n                    };\n                }\n\n                cols.push(kendoDomElement(\"col\", attr));\n            }\n\n            return cols;\n        },\n\n        _clearColsCache: function() {\n            this._headerColsTree.render([]);\n            if (this.options.scrollable) {\n                this._contentColsTree.render([]);\n            }\n            if (this._hasLockedColumns) {\n                this._lockedHeaderColsTree.render([]);\n                this._lockedContentColsTree.render([]);\n            }\n        },\n\n        _renderCols: function() {\n            var columns = nonLockedColumns(this.columns);\n            this._headerColsTree.render(this._cols(leafColumns(columns)));\n\n            if (this.options.scrollable) {\n                this._contentColsTree.render(this._cols(leafColumns(columns)));\n            }\n\n            if (this._hasLockedColumns) {\n                columns = lockedColumns(this.columns);\n                this._lockedHeaderColsTree.render(this._cols(leafColumns(columns)));\n                this._lockedContentColsTree.render(this._cols(leafColumns(columns)));\n            }\n        },\n\n        _retrieveFirstColumn: function(columns, rows) {\n            var result = $();\n\n            if (rows.length && columns[0]) {\n                var column = columns[0];\n\n                while (column.columns && column.columns.length) {\n                    column = column.columns[0];\n                    rows = rows.filter(\":not(:first)\");\n                }\n\n                result = result.add(rows);\n            }\n\n            return result;\n        },\n\n        _updateFirstColumnClass: function() {\n            var that = this;\n            var columns = that.columns || [];\n            var tr = that.thead.find(\">tr:not(:first, .k-filter-row)\");\n            var rows;\n\n            columns = nonLockedColumns(columns);\n\n            rows = that._retrieveFirstColumn(columns, tr);\n\n            if (that.lockedHeader) {\n                tr = that.lockedHeader.find(\"thead>tr:not(.k-filter-row):not(:first)\");\n                columns = lockedColumns(that.columns);\n\n                rows = rows.add(that._retrieveFirstColumn(columns, tr));\n            }\n\n            rows.each(function() {\n                var ths = $(this).find(\"th\");\n                ths.removeClass(\"k-first\");\n                ths.eq(0).addClass(\"k-first\");\n            });\n        },\n\n        _updateRowSpans: function(rows) {\n            for (var i = rows.length - 1; i >= 0; i--) {\n                var included = visibleChildColumns(rows[i].cells).length > 0;\n\n                if (included) {\n                    rows[i].rowSpan = rows.length - i;\n                }\n            }\n        },\n\n        _setColumnDataIndexes: function(columns) {\n            for (var i = 0; i < columns.length; i++) {\n               columns[i][\"data-index\"] = i;\n            }\n        },\n\n        _updateColumnCellIndex: function() {\n            var header;\n            var offset = 0;\n\n            if (this.lockedHeader) {\n                header = this.lockedHeader.find(\"thead\");\n                offset = updateCellIndex(header, lockedColumns(this.columns));\n            }\n            updateCellIndex(this.thead, nonLockedColumns(this.columns), offset);\n        },\n\n        _setParentsVisibility: function(column, visible) {\n            var columns = this.columns;\n            var idx;\n            var parents = [];\n            var parent;\n\n            var predicate = visible ?\n                function(p) { return visibleColumns(p.columns).length && p.hidden; } :\n                function(p) { return !visibleColumns(p.columns).length && !p.hidden; };\n\n\n            if (columnParents(column, columns, parents) && parents.length) {\n                for (idx = parents.length - 1; idx >= 0; idx--) {\n                    parent = parents[idx];\n\n                    if (predicate(parent)) {\n                        parent.hidden = !visible;\n                    }\n                }\n            }\n        },\n\n        _prepareColumns: function(rows, columns, parentCell, parentRow, parentColumn) {\n            var row = parentRow || rows[rows.length - 1];\n\n            var childRow = rows[row.index + 1];\n            var totalColSpan = 0;\n\n            for (var idx = 0; idx < columns.length; idx++) {\n                var cell = $.extend({}, columns[idx], { headerAttributes: columns[idx].headerAttributes || {} } );\n                row.cells.push(cell);\n\n                if (columns[idx].columns && columns[idx].columns.length) {\n                    if (!childRow) {\n                        childRow = { rowSpan: 0, cells: [], index: rows.length };\n                        rows.push(childRow);\n                    }\n                    if (columns[idx].columns.length) {\n                        cell.headerAttributes.colSpan = visibleChildColumns(columns[idx].columns).length || 1;\n                        cell.headerAttributes[\"data-colspan\"] = leafColumns(columns[idx].columns).length;\n                    }\n                    this._prepareColumns(rows, columns[idx].columns, cell, childRow, columns[idx]);\n                    if (!cell.hidden) {\n                        totalColSpan += cell.headerAttributes.colSpan - 1;\n                    }\n                    row.rowSpan = rows.length - row.index;\n                }\n                columns[idx].rowIndex = row.index;\n                if (parentColumn) {\n                    columns[idx].parentColumn = parentColumn;\n                }\n                columns[idx].cellIndex = row.cells.length - 1;\n            }\n            if (parentCell) {\n                parentCell.headerAttributes.colSpan += totalColSpan;\n            }\n        },\n\n        _renderHeaderTree: function(tree, columns, hasMultiColumnHeaders) {\n            var idx;\n            var rows = [];\n            var rowsToRender = [];\n            var filterThs = [];\n\n            if (hasMultiColumnHeaders) {\n                rows = [{ rowSpan: 1, cells: [], index: 0 }];\n                this._prepareColumns(rows, columns);\n                this._updateRowSpans(rows);\n                for (idx = 0; idx < rows.length; idx++) {\n                    rowsToRender.push(kendoDomElement(\"tr\", { \"role\": \"row\" }, this._ths(rows[idx].cells, rows[idx].rowSpan)));\n                }\n            } else {\n                rowsToRender.push(kendoDomElement(\"tr\", { \"role\": \"row\" }, this._ths(columns)));\n            }\n\n            if (this._hasFilterRow()) {\n                this._filterThs(columns, filterThs);\n                rowsToRender.push(kendoDomElement(\"tr\", { \"class\": \"k-filter-row\" }, filterThs));\n            }\n\n            tree.render(rowsToRender);\n        },\n\n        _renderHeader: function() {\n            var columns = nonLockedColumns(this.columns);\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n            this._setColumnDataIndexes(leafColumns(this.columns));\n            this._renderHeaderTree(this._headerTree, columns, hasMultiColumnHeaders);\n\n            if (this._hasLockedColumns) {\n                columns = lockedColumns(this.columns);\n                this._renderHeaderTree(this._lockedHeaderTree, columns, hasMultiColumnHeaders);\n\n                this._applyLockedContainersWidth();\n                this._syncLockedHeaderHeight();\n            }\n            this._updateFirstColumnClass();\n        },\n\n        _filterThs: function(columns, ths) {\n            var column;\n            var attr;\n            var uidAttr = kendo.attr('uid');\n\n            for (var i = 0, length = columns.length; i < length; i++) {\n                column = columns[i];\n\n                if (column.columns) {\n                    this._filterThs(column.columns, ths);\n                }\n\n                if (column.columns && column.columns.length) {\n                    continue;\n                }\n\n                attr = {\n                    \"style\": column.hidden === true ? { \"display\": \"none\" } : {}\n                };\n                attr[uidAttr] = column.headerAttributes.id;\n                ths.push(kendoDomElement(\"th\", attr));\n            }\n        },\n\n        _updateFilterThs: function(before, column, refColumn) {\n            var columns = leafColumns([column]);\n            var filterRowThs = $(this.lockedHeader).add(this.thead).find(\"tr.k-filter-row th\");\n            var refIndex;\n            var currIndex;\n            var uidAttr = kendo.attr('uid');\n\n            function thIndex(ths, uid) {\n                for (var i = 0; i < ths.length; i++) {\n                    if (ths.eq(i).attr(uidAttr) === uid) {\n                        return i;\n                    }\n                }\n            }\n\n            for (var i = columns.length - 1; i >= 0; i--) {\n                column = columns[i];\n                currIndex = thIndex(filterRowThs, column.headerAttributes.id);\n                refIndex = thIndex(filterRowThs, refColumn.headerAttributes.id);\n                filterRowThs.eq(currIndex)[before ? \"insertBefore\" : \"insertAfter\"](filterRowThs.eq(refIndex));\n            }\n        },\n\n        _applyLockedContainersWidth: function() {\n            if (!this._hasLockedColumns) {\n                return;\n            }\n\n            var lockedWidth = columnsWidth(this.lockedHeader.find(\">table>colgroup>col\"));\n\n            var headerTable = this.thead.parent();\n            var nonLockedWidth = columnsWidth(headerTable.find(\">colgroup>col\"));\n\n            var wrapperWidth = this.wrapper[0].clientWidth;\n            var scrollbar = kendo.support.scrollbar();\n\n            if (lockedWidth >= wrapperWidth) {\n                lockedWidth = wrapperWidth - 3 * scrollbar;\n            }\n\n            this.lockedHeader\n                .add(this.lockedContent)\n                .width(lockedWidth);\n\n            headerTable.add(this.table).width(nonLockedWidth);\n\n            var width = wrapperWidth - lockedWidth;\n            this.content.width(width - 1);\n            headerTable.parent().width(width - scrollbar - 2);\n        },\n\n        _trs: function(options) {\n            var that = this;\n            var model, attr, className, hasChildren, childNodes, i, length;\n            var modelId;\n            var rows = [];\n            var level = options.level;\n            var data = options.data;\n            var dataSource = this.dataSource;\n            var aggregates = dataSource.aggregates() || {};\n            var idField = dataSource._modelIdField();\n            var parentIdField = dataSource._modelParentIdField();\n            var columns = options.columns;\n            var pageable = that._isPageable();\n            var childrenMap = options.childrenMap || dataSource.childrenMap(dataSource._getData());\n\n            for (i = 0, length = data.length; i < length; i++) {\n                className = [];\n\n                model = data[i];\n                modelId = model[idField];\n\n                childNodes = pageable ? childrenMap[modelId] : (model.loaded() ? dataSource.childNodes(model) : []);\n                hasChildren = childNodes && childNodes.length;\n\n                attr = { \"role\": \"row\" };\n\n                attr[kendo.attr(\"uid\")] = model.uid;\n\n                if (hasChildren) {\n                    attr[\"aria-expanded\"] = !!model.expanded;\n                }\n\n                if (options.visible) {\n                    if (!pageable || (pageable && !that._skipRenderingMap[modelId])) {\n                        if (this._absoluteIndex % 2 !== 0) {\n                            className.push(classNames.alt);\n                        }\n\n                        this._absoluteIndex++;\n                    }\n                } else {\n                    attr.style = { display: \"none\" };\n                }\n\n                if ($.inArray(model.uid, options.selected) >= 0) {\n                    className.push(classNames.selected);\n                }\n\n                if (hasChildren) {\n                    className.push(classNames.group);\n                }\n\n                if (model._edit) {\n                    className.push(\"k-grid-edit-row\");\n                }\n\n                attr.className = className.join(\" \");\n\n                if (!that._skipRenderingMap[modelId]) {\n                    var row;\n                    var rowOptions = {\n                        model: model,\n                        attr: attr,\n                        level: pageable ? that._renderedModelLevel(model, options) : level,\n                        editedColumn: options.editedColumn,\n                        editedColumnIndex: options.editedColumnIndex,\n                        hasChildren: hasChildren,\n                        visible: options.visible,\n                        isAlt: this._absoluteIndex % 2 === 0\n                    };\n\n                    if (that.options.rowTemplate) {\n                        row = this. _trFromTemplate(rowOptions);\n                    } else {\n                        row = this._tds(rowOptions, columns, this._td.bind(this));\n                    }\n\n                    rows.push(row);\n                }\n\n\n                if (hasChildren && (that.options.renderAllRows || !!model.expanded)) {\n                    if (pageable) {\n                        // render the child nodes in the paged view only\n                        childNodes = (options.viewChildrenMap || {})[modelId] || [];\n                    }\n\n                    if (childNodes.length === 0) {\n                        continue;\n                    }\n\n                    rows = rows.concat(this._trs({\n                        columns: columns,\n                        editedColumn: options.editedColumn,\n                        editedColumnIndex: options.editedColumnIndex,\n                        aggregates: aggregates,\n                        selected: options.selected,\n                        visible: pageable ? options.visible : (options.visible && !!model.expanded),\n                        data: childNodes,\n                        childrenMap: options.childrenMap || childrenMap,\n                        hasFooterTemplate: options.hasFooterTemplate,\n                        viewChildrenMap: options.viewChildrenMap,\n                        level: level + 1\n                    }));\n                }\n            }\n\n            if (options.hasFooterTemplate && model) {\n                attr = {\n                    className: classNames.footerTemplate,\n                    \"data-parentId\": model[parentIdField]\n                };\n\n                if (!options.visible) {\n                    attr.style = { display: \"none\" };\n                }\n\n                rows.push(this._tds({\n                    model: aggregates[model[parentIdField]],\n                    attr: attr,\n                    level: level,\n                    editedColumn: options.editedColumn,\n                    editedColumnIndex: options.editedColumnIndex\n                }, columns, this._footerId));\n            }\n\n            return rows;\n        },\n\n        _trFromTemplate: function(options) {\n            var rowTemplate = this.options.rowTemplate;\n            var altRowTemplate = this.options.altRowTemplate;\n            var row;\n            var template;\n\n            altRowTemplate = altRowTemplate ? altRowTemplate : rowTemplate;\n\n            if (!kendo.isFunction(rowTemplate)) {\n                rowTemplate = kendo.template(rowTemplate);\n            }\n\n            if (!kendo.isFunction(altRowTemplate)) {\n                altRowTemplate = kendo.template(altRowTemplate);\n            }\n\n            if (this._absoluteIndex % 2 !== 0) {\n                template = rowTemplate(options);\n            } else {\n                template = altRowTemplate(options);\n            }\n\n            if (!$(template).length) {\n                return kendoTextElement(template);\n            }\n\n            row = this.parseRowTemplate($(template)[0], options);\n\n            return row;\n        },\n\n        parseRowTemplate: function(element, options) {\n            var nodeName = element.nodeName.toLocaleLowerCase();\n            var childNodes = element.childNodes;\n            var children = [];\n            var currElement;\n            var attributes;\n\n            attributes = this.parseAttributes(element);\n\n            for (var i = 0; i < childNodes.length; i++) {\n                if (!/\\S/.test(childNodes[i].nodeValue)) {\n                   continue;\n                }\n                if (childNodes[i].nodeName.toLocaleLowerCase() === \"td\") {\n                    children.push(this._createCellElement(childNodes[i]));\n                }\n            }\n\n            if (options && !options.visible) {\n               attributes.style = attributes.style || {};\n               attributes.style = $.extend(true, attributes.style, { display: \"none\" });\n            }\n\n            if (this._isTextNode(nodeName)) {\n                currElement = kendoTextElement(element.nodeValue);\n            } else {\n                currElement = kendoDomElement(nodeName, attributes, children);\n            }\n\n            return currElement;\n        },\n\n        _createCellElement: function(element) {\n            var attributes = this.parseAttributes(element);\n            var spaceElements = $(element).find('.' + classNames.iconHidden).remove();\n            var iconElement = $(element).find('.' + classNames.iconExpand + ',.' + classNames.iconCollapse).remove()[0];\n            var children = [];\n\n            for (var i = 0; i < spaceElements.length; i++) {\n                children.push(kendoDomElement(\"span\", this.parseAttributes(spaceElements[i])));\n            }\n\n            if (iconElement) {\n                children.push(kendoDomElement(\"span\", this.parseAttributes(iconElement)));\n            }\n            children.push(kendoHtmlElement($(element).html()));\n\n            return kendoDomElement(\"td\", attributes, children);\n        },\n\n        parseAttributes: function(element) {\n            if (this._isTextNode(element.nodeName)) {\n                return null;\n            }\n\n            element = $(element)[0];\n            var attributes = element.attributes;\n            var length = attributes.length;\n            var result = {};\n\n            for (var i = 0; i < length; i++) {\n                result[attributes[i].name] = attributes[i].value;\n            }\n\n            return result;\n        },\n\n        _isTextNode: function(nodeName) {\n            return nodeName.indexOf('text') >= 0;\n        },\n\n        _footerId: function(options) {\n            var content = [];\n            var column = options.column;\n            var template = options.column.footerTemplate || $.noop;\n            var aggregates = options.model[column.field] || {};\n            var attr = {\n                \"role\": \"gridcell\",\n                \"style\": column.hidden === true ? { \"display\": \"none\" } : {}\n            };\n\n            if (column.expandable) {\n                content = content.concat(createPlaceholders({\n\n                    level: options.level + 1,\n                    className: classNames.iconPlaceHolder\n                }));\n            }\n\n            if (column.attributes) {\n                extend(true, attr, column.attributes, {\n                    \"style\": column.hidden === true ? { \"display\": \"none\" } : {}\n                });\n            }\n\n            content.push(kendoHtmlElement(template(aggregates) || \"\"));\n\n            return kendoDomElement(\"td\", attr, content);\n        },\n\n        _hasFooterTemplate: function() {\n            return !!grep(leafColumns(this.columns), function(c) {\n                return c.footerTemplate;\n            }).length;\n        },\n\n        _tds: function(options, columns, renderer) {\n            var children = [];\n            var column;\n            var editedColumnField = (options.editedColumn || {}).field;\n            var incellEditing = this._isIncellEditable();\n            var length = columns.length;\n\n            for (var i = 0; i < length; i++) {\n                column = columns[i];\n\n                var col = renderer({\n                    model: options.model,\n                    column: column,\n                    editColumn: !incellEditing || (incellEditing && column.field === editedColumnField && options.editedColumnIndex === i),\n                    level: options.level\n                });\n\n                children.push(col);\n            }\n\n            return kendoDomElement(\"tr\", options.attr, children);\n        },\n\n        _td: function(options) {\n            var children = [];\n            var model = options.model;\n            var column = options.column;\n            var iconClass;\n            var attr = {\n                \"role\": \"gridcell\",\n                \"style\": column.hidden === true ? { \"display\": \"none\" } : {}\n            };\n            var incellEditing = this._isIncellEditable();\n            var columnHasEditCommand = false;\n\n            if (column.attributes) {\n                extend(true, attr, column.attributes);\n            }\n\n            if (!!column.headerAttributes && !!column.headerAttributes.id) {\n                attr[\"aria-describedby\"] = column.headerAttributes.id;\n            }\n\n            if (model._edit && column.field && options.editColumn && (incellEditing || (!incellEditing && isColumnEditable(column, model)))) {\n                attr[kendo.attr(\"container-for\")] = column.field;\n\n                if (incellEditing) {\n                    if (attr.className && attr.className.indexOf(classNames.editCell) !== -1) {\n                        attr.className += \" \" + classNames.editCell;\n                    } else if (!attr.className) {\n                        attr.className = classNames.editCell;\n                    }\n                }\n            } else {\n                if (column.expandable) {\n                    children = createPlaceholders({ level: options.level, className: classNames.iconPlaceHolder });\n                    iconClass = [classNames.icon];\n\n                    if (model.hasChildren) {\n                        iconClass.push(model.expanded ? classNames.iconCollapse : classNames.iconExpand);\n                    } else {\n                        iconClass.push(classNames.iconHidden);\n                    }\n\n                    if (model._error) {\n                        iconClass.push(classNames.refresh);\n                    } else if (!model.loaded() && model.expanded) {\n                        iconClass.push(classNames.loading);\n                        attr[\"aria-busy\"] = true;\n                    }\n\n                    children.push(kendoDomElement(\"span\", { className: iconClass.join(\" \") }));\n\n                    attr.style[\"white-space\"] = \"nowrap\";\n                }\n\n                if (isDirtyColumn(column, model)) {\n                    if (attr.className) {\n                        attr.className += classNames.dirtyCell;\n                    } else if (!attr.className) {\n                        attr.className = classNames.dirtyCell;\n                    }\n                }\n\n                if (column.command) {\n                    if (attr.className && attr.className.indexOf(\"k-command-cell\") !== -1 ) {\n                        attr.className += \" k-command-cell\";\n                    } else if (!attr.className) {\n                        attr.className = \"k-command-cell\";\n                    }\n\n                    columnHasEditCommand = grep(column.command, function(command) {\n                        return command === EDIT || command.name === EDIT;\n                    }).length > 0;\n\n                    if (model._edit && !this._isIncellEditable() && columnHasEditCommand) {\n                        children = this._buildCommands([\"update\", \"canceledit\"]);\n                    } else {\n                        children = this._buildCommands(column.command);\n                    }\n                } else {\n                    children.push(this._cellContent(column, model));\n                }\n\n                attr.className = [attr[\"class\"], attr.className].join(\" \").trim();\n            }\n\n            return kendoDomElement(\"td\", attr, children);\n        },\n\n        _cellContent: function(column, model) {\n            var that = this;\n            var value;\n            var incellEditing = that._isIncellEditable();\n            var dirtyIndicator;\n\n            if (column.selectable) {\n                return kendoHtmlElement(SELECTCOLUMNTMPL);\n            }\n\n            if (column.template) {\n                value = that._evalColumnTemplate(column, model);\n            } else if (column.field) {\n                value = model.get(column.field);\n                dirtyIndicator = incellEditing ? column.dirtyIndicatorTemplate(model) : \"\";\n                if (value !== null && !isUndefined(value)) {\n                    if (column.format) {\n                        value = kendo.format(column.format, value);\n                    }\n\n                    value = dirtyIndicator + value;\n                } else {\n                    value = dirtyIndicator;\n                }\n            } else if (value === null || isUndefined(value)) {\n                value = \"\";\n            }\n\n            if (column.template || !column.encoded) {\n                return kendoHtmlElement(value);\n            } else {\n                if (incellEditing) {\n                    return kendoHtmlElement(value);\n                } else {\n                    return kendoTextElement(value);\n                }\n            }\n        },\n\n        _evalColumnTemplate: function(column, model) {\n            if (this._isIncellEditable()) {\n                return column.dirtyCellTemplate(model);\n            } else {\n                return column.template(model);\n            }\n        },\n\n        _createDirtyColumnTemplate: function(column) {\n            var that = this;\n            var templateSettings = that._customTemplateSettings();\n            var columnTemplateAlias = \"#=this.columnTemplate(\" + templateSettings.paramName + \")#\";\n\n            var templateString = that._dirtyIndicatorTemplate(column.field) + columnTemplateAlias;\n            var templateFunction = kendoTemplate(templateString, templateSettings).bind({ columnTemplate: column.template });\n\n            return templateFunction;\n        },\n\n        _createIndicatorTemplate: function(column) {\n            var dirtyIndicatorTemplate = this._dirtyIndicatorTemplate(column.field);\n\n            return kendoTemplate(dirtyIndicatorTemplate);\n        },\n\n        _dirtyIndicatorTemplate: function(field) {\n            var that = this;\n            var dirtyField;\n            var templateSettings = that._customTemplateSettings();\n            var paramName = templateSettings.paramName;\n\n            if (field && paramName) {\n                dirtyField = field.charAt(0) === \"[\" ? kendo.expr(field, paramName + \".dirtyFields\") : paramName + \".dirtyFields['\" + field + \"']\";\n\n                return \"#= \" + paramName + \" && \" + paramName + \".dirty && \" + paramName + \".dirtyFields && \" + dirtyField +\n                        \" ? '<span class=\\\"k-dirty\\\"></span>' : '' #\";\n            }\n\n            return \"\";\n        },\n\n        _customTemplateSettings: function() {\n            return extend({}, kendo.Template, this.options.templateSettings);\n        },\n\n        _buildCommands: function(commands) {\n            var i, result = [];\n\n            for (i = 0; i < commands.length; i++) {\n                result.push(this._handleCommand(commands[i]));\n            }\n\n            return result;\n        },\n\n        _handleCommand: function(command) {\n            var name = (command.name || command).toLowerCase();\n            var text = this.options.messages.commands[name];\n            var icon = [];\n\n            command = extend({}, defaultCommands[name], { text: text }, command);\n\n            if (command.imageClass) {\n                icon.push(kendoDomElement(\"span\", {\n                    className: [ \"k-icon\", \"k-button-icon\", command.imageClass ].join(\" \")\n                }));\n            }\n\n            if (command.template) {\n                return kendoHtmlElement(kendo.template(command.template)({ message: command.text || this.options.messages.commands.search }));\n            } else {\n                return this._button(command, name, icon);\n            }\n        },\n\n        _button: function(command, name, icon) {\n            if (command.className && command.className.indexOf(\"k-primary\") > -1) {\n                command.className = command.className.replace(\"k-primary\", \"k-button-solid-primary\");\n            }\n\n            if (!command.className || command.className.indexOf(\"k-button-solid-primary\") === -1) {\n                command.className += \" k-button-solid-base\";\n            }\n\n            var button = kendoDomElement(\n                \"button\", {\n                    \"type\": \"button\",\n                    \"data-command\": name,\n                    className: [ \"k-button k-button-md k-rounded-md k-button-solid\", command.className ].join(\" \")\n                }, icon.concat([ kendoDomElement(\"span\", {\n                    type: \"span\",\n                    className: \"k-button-text\"\n                }, [ kendoTextElement(command.text || command.name) ]) ])\n            );\n\n            return button;\n        },\n\n        _positionResizeHandle: function(e) {\n            var th = $(e.currentTarget);\n            var resizeHandle = this.resizeHandle;\n            var position = th.position();\n            var left;\n            var rtlCorrection = 0;\n            var headerWrap;\n            var ieCorrection;\n            var webkitCorrection;\n            var firefoxCorrection;\n            var leftMargin;\n            var invisibleSpace;\n            var leftBorderWidth;\n            var scrollLeft;\n            var cellWidth = outerWidth(th);\n            var container = th.closest(\"div\");\n            var button = typeof e.buttons !== \"undefined\" ? e.buttons : (e.which || e.button);\n            var indicatorWidth = this.options.columnResizeHandleWidth || 3;\n            var halfResizeHandle = (indicatorWidth * 3) / 2;\n\n            left = cellWidth;\n\n            if (typeof button !== \"undefined\" && button !== 0) {\n                //do not create a new resize handle if a mouse button is still pressed\n                //this happens during resizing or before UserEvents trigger \"start\"\n                return;\n            }\n\n            if (!resizeHandle) {\n                resizeHandle = this.resizeHandle = $(\n                    '<div class=\"k-resize-handle\"><div class=\"k-resize-handle-inner\"></div></div>'\n                );\n            }\n\n            var cells = leafDataCells(th.closest(\"thead\")).filter(\":visible\");\n            if (isRtl) {\n                scrollLeft = kendo.scrollLeft(container);\n\n                if (browser.mozilla || (browser.webkit && browser.version >= 85)) {\n                    scrollLeft = scrollLeft * -1;\n                }\n                leftBorderWidth = parseFloat(container.css(\"borderLeftWidth\"));\n                left = th.offset().left + scrollLeft - parseFloat(th.css(\"marginLeft\")) - (container.offset().left + leftBorderWidth);\n                rtlCorrection = (left <= scrollLeft ? halfResizeHandle : 0);// when shown on first column headers are misaligned due to the width of the resize handler\n                headerWrap = th.closest(\".k-grid-header-wrap, .k-grid-header-locked\");\n                invisibleSpace = headerWrap[0].scrollWidth - headerWrap[0].offsetWidth; // the difference between the entire width and the visible area\n                leftMargin = parseFloat(headerWrap.css(\"marginLeft\"));\n                ieCorrection = browser.msie ? 2 * kendo.scrollLeft(headerWrap) + leftBorderWidth - leftMargin - rtlCorrection : 0;\n                webkitCorrection = browser.webkit && (browser.version < 85) ? (invisibleSpace - rtlCorrection - leftMargin + leftBorderWidth) : -rtlCorrection; //margin left is added due to a margin that avoids double borders\n                firefoxCorrection = browser.mozilla ? leftBorderWidth - leftMargin - rtlCorrection : 0;\n                left -= webkitCorrection + firefoxCorrection + ieCorrection;\n            } else {\n                for (var idx = 0; idx < cells.length; idx++) {\n                    if (cells[idx] == th[0]) {\n                        break;\n                    }\n                    left += cells[idx].offsetWidth;\n                }\n            }\n\n            container.append(resizeHandle);\n\n            resizeHandle\n                .show()\n                .css({\n                    top: position.top,\n                    left: left - halfResizeHandle,\n                    height: outerHeight(th),\n                    width: indicatorWidth * 3\n                })\n                .data(\"th\", th);\n\n            var that = this;\n            resizeHandle.off(\"dblclick\" + NS).on(\"dblclick\" + NS, function() {\n                //TODO handle frozen columns index\n                var index = th.index();\n                if ($.contains(that.thead[0], th[0])) {\n                    index += grep(that.columns, function(val) { return val.locked && !val.hidden; }).length;\n                }\n                that.autoFitColumn(index);\n            });\n        },\n\n        autoFitColumn: function(column) {\n            var that = this,\n                options = that.options,\n                columns = that.columns,\n                index,\n                th,\n                headerTable,\n                isLocked,\n                visibleLocked = that.lockedHeader ? leafDataCells(that.lockedHeader.find(\">table>thead\")).filter(isCellVisible).length : 0,\n                col;\n\n            //  retrieve the column object, depending on the method argument\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else if (isPlainObject(column)) {\n                column = grep(columns, function(item) {\n                    return item === column;\n                })[0];\n            } else {\n                column = grep(columns, function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || column.hidden) {\n                return;\n            }\n\n            index = inArray(column, columns);\n            isLocked = column.locked;\n\n            if (isLocked) {\n                headerTable = that.lockedHeader.children(\"table\");\n            } else {\n                headerTable = that.thead.parent();\n            }\n\n            th = headerTable.find(\"[data-index='\" + index + \"']\");\n\n            var contentTable = isLocked ? that.lockedTable : that.table,\n                footer = that.footer || $();\n\n            if (that.footer && that.lockedContent) {\n                footer = isLocked ? that.footer.children(\".k-grid-footer-locked\") : that.footer.children(\".k-grid-footer-wrap\");\n            }\n\n            var footerTable = footer.find(\"table\").first();\n\n            if (that.lockedHeader && visibleLocked >= index && !isLocked) {\n                index -= visibleLocked;\n            }\n\n            // adjust column index, depending on previous hidden columns\n            for (var j = 0; j < columns.length; j++) {\n                if (columns[j] === column) {\n                    break;\n                } else {\n                    if (columns[j].hidden) {\n                        index--;\n                    }\n                }\n            }\n\n            // get col elements\n            if (options.scrollable) {\n                col = headerTable.find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index)\n                    .add(contentTable.children(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index))\n                    .add(footerTable.find(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index));\n            } else {\n                col = contentTable.children(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index);\n            }\n\n            var tables = headerTable.add(contentTable).add(footerTable);\n\n            var oldColumnWidth = outerWidth(th);\n\n            // reset the table and autofitted column widths\n            // if scrolling is disabled, we need some additional repainting of the table\n            col.width(\"\");\n            tables.css(\"table-layout\", \"fixed\");\n            col.width(\"auto\");\n            tables.addClass(\"k-autofitting\");\n            tables.css(\"table-layout\", \"\");\n\n            var newColumnWidth = Math.ceil(\n                    Math.max(\n                        outerWidth(th),\n                        outerWidth(contentTable.find(\"tr\").eq(0).children(\"td:visible\").eq(index)),\n                        outerWidth(footerTable.find(\"tr\").eq(0).children(\"td:visible\").eq(index))\n            ));\n\n            col.width(newColumnWidth);\n            column.width = newColumnWidth;\n\n            // if all visible columns have widths, the table needs a pixel width as well\n            if (options.scrollable) {\n                var cols = headerTable.find(\"col\"),\n                    colWidth,\n                    totalWidth = 0;\n                for (var idx = 0, length = cols.length; idx < length; idx += 1) {\n                    colWidth = cols[idx].style.width;\n                    if (colWidth && colWidth.indexOf(\"%\") == -1) {\n                        totalWidth += parseInt(colWidth, 10);\n                    } else {\n                        totalWidth = 0;\n                        break;\n                    }\n                }\n\n                if (totalWidth) {\n                    tables.each(function() {\n                        this.style.width = totalWidth + \"px\";\n                    });\n                }\n            }\n\n            tables.removeClass(\"k-autofitting\");\n\n            that.trigger(COLUMNRESIZE, {\n                column: column,\n                oldWidth: oldColumnWidth,\n                newWidth: newColumnWidth\n            });\n\n            that._applyLockedContainersWidth();\n            that._syncLockedContentHeight();\n            that._syncLockedHeaderHeight();\n        },\n\n        _adjustLockedHorizontalScrollBar: function() {\n            var table = this.table,\n                content = table.parent();\n\n            var scrollbar = table[0].offsetWidth > content[0].clientWidth ? kendo.support.scrollbar() : 0;\n            this.lockedContent.height(outerHeight(content) - scrollbar);\n        },\n\n        _syncLockedContentHeight: function() {\n            if (this.lockedTable) {\n                if (!this._touchScroller) {\n                    this._adjustLockedHorizontalScrollBar();\n                }\n                this._adjustRowsHeight(this.table, this.lockedTable);\n                this._syncLockedScroll();\n            }\n        },\n\n        _syncLockedHeaderHeight: function() {\n            if (this.lockedHeader) {\n                var lockedTable = this.lockedHeader.children(\"table\");\n                var table = this.thead.parent();\n\n                this._adjustRowsHeight(lockedTable, table);\n\n                syncTableHeight(lockedTable, table);\n            }\n        },\n\n        _syncLockedScroll: function() {\n            if (!this.options.scrollable) {\n                return;\n            }\n            this.lockedContent[0].scrollTop = this.content[0].scrollTop;\n        },\n\n        _resizable: function() {\n            if (!this.options.resizable) {\n                return;\n            }\n\n            if (this.resizable) {\n                this.resizable.destroy();\n            }\n\n            var treelist = this;\n\n            $(this.lockedHeader).find(\"thead\").add(this.thead)\n                .on(\"mousemove\" + NS, \"tr:not(.k-filter-row) > th\", this._positionResizeHandle.bind(this));\n\n            this.resizable = new kendo.ui.Resizable(this.wrapper, {\n                handle: \".k-resize-handle\",\n                start: function(e) {\n                    var th = $(e.currentTarget).data(\"th\");\n                    var index = $.inArray(th[0], leafDataCells(th.closest(\"thead\")).filter(\":visible\"));\n                    var header, contentTable;\n\n                    treelist.wrapper.addClass(\"k-grid-column-resizing\");\n\n                    if (treelist.lockedHeader && $.contains(treelist.lockedHeader[0], th[0])) {\n                        header = treelist.lockedHeader;\n                        contentTable = treelist.lockedTable;\n                    } else {\n                        header = treelist.thead.parent();\n                        contentTable = treelist.table;\n                    }\n\n                    this.col = contentTable.children(\"colgroup\").find(\"col\").eq(index)\n                          .add(header.find(\"col\").eq(index));\n                    this.th = th;\n                    this.startLocation = e.x.location;\n                    this.columnWidth = outerWidth(th);\n                    this.table = this.col.closest(\"table\");\n                    this.totalWidth = this.table.width();\n                },\n                resize: function(e) {\n                    var rtlModifier = isRtl ? -1 : 1;\n                    var minColumnWidth = 11;\n                    var delta = (e.x.location * rtlModifier) - (this.startLocation * rtlModifier);\n\n                    if (this.columnWidth + delta < minColumnWidth) {\n                        delta = minColumnWidth - this.columnWidth;\n                    }\n\n                    this.table.width(this.totalWidth + delta);\n                    this.col.width(this.columnWidth + delta);\n                },\n                resizeend: function() {\n                    treelist.wrapper.removeClass(\"k-grid-column-resizing\");\n\n                    var field = this.th.attr(\"data-field\");\n                    var column = grep(leafColumns(treelist.columns), function(c) {\n                        return c.field == field;\n                    });\n                    var newWidth = Math.floor(outerWidth(this.th));\n\n                    column[0].width = newWidth;\n                    treelist._resize();\n                    treelist._syncLockedContentHeight();\n                    treelist._syncLockedHeaderHeight();\n                    treelist.trigger(COLUMNRESIZE, {\n                        column: column,\n                        oldWidth: this.columnWidth,\n                        newWidth: newWidth\n                    });\n\n                    this.table = this.col = this.th = null;\n                }\n            });\n        },\n\n        _sortable: function() {\n            var columns;\n            var column;\n            var sortableInstance;\n            var cells;\n            var cell, idx, length;\n            var sortable = this.options.sortable;\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n\n            if (!sortable) {\n                return;\n            }\n\n            if (hasMultiColumnHeaders) {\n                if (this.lockedHeader) {\n                    cells = sortCells(leafDataCells(this.lockedHeader.find(\">table>thead\")).add(leafDataCells(this.thead)));\n                } else {\n                    cells = leafDataCells(this.thead);\n                }\n            } else {\n                cells = $(this.lockedHeader).add(this.thead).find(\"tr:not(.k-filter-row) th\");\n            }\n            columns = leafColumns(this.columns);\n\n            for (idx = 0, length = cells.length; idx < length; idx++) {\n                column = columns[idx];\n\n                if (column.sortable !== false && !column.command && column.field && !column.selectable) {\n                    cell = cells.eq(idx);\n\n                    sortableInstance = cell.data(\"kendoColumnSorter\");\n                    if (sortableInstance) {\n                        sortableInstance.destroy();\n                    }\n\n                    cell.kendoColumnSorter(\n                            extend({}, sortable, column.sortable, {\n                                dataSource: this.dataSource\n                            })\n                        );\n                }\n            }\n        },\n\n        _filterable: function() {\n            var cells;\n            var filterable = this.options.filterable;\n            var idx;\n            var length;\n            var columns;\n            var column;\n            var cell;\n            var filterMenuInstance;\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n\n            if (!filterable || this.options.columnMenu) {\n                return;\n            }\n\n            var filterInit = (function(e) {\n                this.trigger(FILTERMENUINIT, { field: e.field, container: e.container });\n            }).bind(this);\n\n            var filterOpen = (function(e) {\n                this.trigger(FILTERMENUOPEN, { field: e.field, container: e.container });\n            }).bind(this);\n\n            if (hasMultiColumnHeaders) {\n                if (this.lockedHeader) {\n                    cells = leafDataCells(this.lockedHeader.find(\">table>thead\").add(this.thead));\n                } else {\n                    cells = leafDataCells(this.thead);\n                }\n            } else {\n                cells = $(this.lockedHeader).add(this.thead).find(\"tr:not(.k-filter-row) th\");\n            }\n            columns = leafColumns(this.columns);\n\n            if (filterable && typeof filterable.mode == STRING && filterable.mode.indexOf(\"menu\") == -1) {\n                filterable = false;\n            }\n\n            if (!filterable) {\n                return;\n            }\n\n            for (idx = 0, length = cells.length; idx < length; idx++) {\n                column = columns[idx];\n                cell = cells.eq(idx);\n\n                filterMenuInstance = cell.data(\"kendoFilterMenu\");\n                if (filterMenuInstance) {\n                    filterMenuInstance.destroy();\n                }\n\n                if (column.command || column.filterable === false || column.selectable) {\n                    continue;\n                }\n\n                cell.kendoFilterMenu(extend(true, {}, filterable, column.filterable, {\n                    dataSource: this.dataSource,\n                    init: filterInit,\n                    open: filterOpen,\n                    appendTo: DOT + classNames.headerCellInner\n                }));\n            }\n        },\n\n        _filterRow: function() {\n            var that = this;\n            if (!that._hasFilterRow()) {\n               return;\n            }\n\n            var settings;\n            var $angular = that.options.$angular;\n            var uidAttr = kendo.attr('uid');\n            var columns = leafColumns(that.columns),\n                filterable = that.options.filterable,\n                filterHandler = function(e) {\n                    if (that.trigger(\"filter\", { filter: e.filter, field: e.field })) {\n                        e.preventDefault();\n                    }\n                },\n                existingInstance;\n\n            for (var i = 0; i < columns.length; i++) {\n                var suggestDataSource,\n                    col = columns[i],\n                    operators = that.options.filterable.operators,\n                    customDataSource = false,\n                    th = this.wrapper.find('.k-grid-header .k-filter-row th[' + uidAttr + '=\"' + col.headerAttributes.id + '\"]'),\n                    field = col.field,\n                    parentColumn = col.parentColumn;\n\n                delete col.parentColumn;\n\n                if (field && col.filterable !== false) {\n                    var cellOptions = col.filterable && col.filterable.cell || {};\n                    existingInstance = th.find('.k-filtercell').data('kendoFilterCell');\n\n                    if (existingInstance) {\n                        existingInstance.destroy();\n                        th.empty();\n                    }\n\n                    suggestDataSource = that.options.dataSource;\n                    if (suggestDataSource instanceof DataSource) {\n                        suggestDataSource = that.options.dataSource.options;\n                    }\n\n                    var messages = extend(true, {}, filterable.messages);\n                    if (col.filterable) {\n                        extend(true, messages, col.filterable.messages);\n                    }\n\n                    if (cellOptions.enabled === false) {\n                        th.html(\"&nbsp;\");\n                        continue;\n                    }\n                    if (cellOptions.dataSource) {\n                        suggestDataSource = cellOptions.dataSource;\n                        customDataSource = true;\n                    }\n                    if (col.filterable && col.filterable.operators) {\n                        operators = col.filterable.operators;\n                    }\n\n                    settings = {\n                        column: col,\n                        dataSource: that.dataSource,\n                        suggestDataSource: suggestDataSource,\n                        customDataSource: customDataSource,\n                        field: field,\n                        messages: messages,\n                        values: col.values,\n                        template: cellOptions.template,\n                        delay: cellOptions.delay,\n                        inputWidth: cellOptions.inputWidth,\n                        suggestionOperator: cellOptions.suggestionOperator,\n                        minLength: cellOptions.minLength,\n                        dataTextField: cellOptions.dataTextField,\n                        operator: cellOptions.operator,\n                        operators: operators,\n                        showOperators: cellOptions.showOperators,\n                        change: filterHandler\n                    };\n\n                    if ($angular) {\n                        settings.$angular = $angular;\n                    }\n\n                    $(\"<span/>\").attr(kendo.attr(\"field\"), field)\n                        .appendTo(th)\n                        .kendoFilterCell(settings);\n                    col.parentColumn = parentColumn;\n                } else {\n                    th.html(\"&nbsp;\");\n                }\n            }\n        },\n\n        _hasFilterRow: function() {\n            var filterable = this.options.filterable;\n            var hasFiltering = filterable &&\n                    typeof filterable.mode == STRING &&\n                    filterable.mode.indexOf(\"row\") != -1;\n            var columns = this.columns;\n            var columnsWithoutFiltering = $.grep(columns, function(col) {\n                return col.filterable === false;\n            });\n\n            if (columns.length && columnsWithoutFiltering.length == columns.length) {\n                hasFiltering = false;\n            }\n\n            return hasFiltering;\n        },\n\n        _change: function() {\n            var that = this;\n            var selectedValues;\n\n            if (that._checkBoxSelection) {\n                selectedValues = that.selectable.value();\n                that._uncheckCheckBoxes();\n                that._checkRows(selectedValues);\n                if (selectedValues.length && selectedValues.length === that.items().length) {\n                    that._toggleHeaderCheckState(true);\n                } else {\n                    that._toggleHeaderCheckState(false);\n                }\n            }\n            this.trigger(CHANGE);\n        },\n\n        _isLocked: function() {\n            return this.lockedHeader !== null;\n        },\n\n        _selectable: function() {\n            var that = this;\n            var selectable = this.options.selectable;\n            var filter;\n            var element = this.table;\n            var useAllItems;\n            var isLocked = that._isLocked();\n            var multi;\n            var cell;\n\n            if (selectable) {\n                selectable = kendo.ui.Selectable.parseOptions(selectable);\n\n                if (this._hasLockedColumns) {\n                    element = element.add(this.lockedTable);\n                    useAllItems = selectable.multiple && selectable.cell;\n                }\n\n                filter = \">tbody>tr:not(.k-footer-template)\";\n\n                if (selectable.cell) {\n                    filter = filter + \">td\";\n                }\n\n                this.selectable = new kendo.ui.Selectable(element, {\n                    filter: filter,\n                    aria: true,\n                    multiple: selectable.multiple,\n                    change: this._change.bind(this),\n                    useAllItems: useAllItems,\n                    continuousItems: this._continuousItems.bind(this, filter, selectable.cell),\n                    relatedTarget: !selectable.cell && this._hasLockedColumns ? this._selectableTarget.bind(this) : undefined\n                });\n\n                if (that.options.navigatable) {\n                    multi = selectable.multiple;\n                    cell = selectable.cell;\n\n                    element.on(\"keydown\" + NS, function(e) {\n                        var current = that.current();\n                        var target = e.target;\n                        if (e.keyCode === keys.SPACEBAR && !e.shiftKey && $.inArray(target, element) > -1 &&\n                            !current.is(\".k-header\")) {\n\n                                e.preventDefault();\n                                e.stopPropagation();\n                                current = cell ? current : current.parent();\n\n                                if (isLocked && !cell) {\n                                    current = current.add(that._relatedRow(current));\n                                }\n\n                                if (multi) {\n                                    if (!e.ctrlKey) {\n                                        that.selectable.clear();\n                                    } else {\n                                        if (current.hasClass(classNames.selected)) {\n                                            current.removeClass(classNames.selected);\n                                            that.trigger(CHANGE);\n                                            return;\n                                        }\n                                    }\n                                } else {\n                                    that.selectable.clear();\n                                }\n                                if (!cell) {\n                                    that.selectable._lastActive = current;\n                                }\n\n                                that.selectable.value(current);\n                        } else if (!cell && ((e.shiftKey && e.keyCode == keys.LEFT) ||\n                                    (e.shiftKey && e.keyCode == keys.RIGHT) ||\n                                    (e.shiftKey && e.keyCode == keys.UP) ||\n                                    (e.shiftKey && e.keyCode == keys.DOWN) ||\n                                    (e.keyCode === keys.SPACEBAR && e.shiftKey))) {\n\n                            e.preventDefault();\n                            e.stopPropagation();\n                            current = current.parent();\n\n                            if (isLocked) {\n                                current = current.add(that._relatedRow(current));\n                            }\n\n                            if (multi) {\n                                if (!that.selectable._lastActive) {\n                                    that.selectable._lastActive = current;\n                                }\n                                that.selectable.selectRange(that.selectable._firstSelectee(), current);\n                            } else {\n                                that.selectable.clear();\n                                that.selectable.value(current);\n                            }\n                        }\n                    });\n                }\n            }\n        },\n\n        _continuousItems: function(filter, cell) {\n            if (!this.lockedContent) {\n                return;\n            }\n\n            var lockedItems = $(filter, this.lockedTable);\n            var nonLockedItems = $(filter, this.table);\n            var columns = cell ? lockedColumns(this.columns).length : 1;\n            var nonLockedColumns = cell ? this.columns.length - columns : 1;\n            var result = [];\n\n            for (var idx = 0; idx < lockedItems.length; idx += columns) {\n                push.apply(result, lockedItems.slice(idx, idx + columns));\n                push.apply(result, nonLockedItems.splice(0, nonLockedColumns));\n            }\n\n            return result;\n        },\n\n        _selectableTarget: function(items) {\n            var related;\n            var result = $();\n            for (var idx = 0, length = items.length; idx < length; idx ++) {\n                related = this._relatedRow(items[idx]);\n\n                if (inArray(related[0], items) < 0) {\n                    result = result.add(related);\n                }\n            }\n\n            return result;\n        },\n\n        _relatedRow: function(row) {\n            var lockedTable = this.lockedTable;\n            row = $(row);\n\n            if (!lockedTable) {\n                return row;\n            }\n\n            var table = row.closest(this.table.add(this.lockedTable));\n            var index = table.find(\">tbody>tr\").index(row);\n\n            table = table[0] === this.table[0] ? lockedTable : this.table;\n\n            return table.find(\">tbody>tr\").eq(index);\n        },\n\n        select: function(value) {\n            var that = this;\n            var selectable = this.selectable;\n\n            if (that._checkBoxSelection) {\n                if (value) {\n                    that._checkRows(value);\n                    if (that.select().length === that.items().length) {\n                        that._toggleHeaderCheckState(true);\n                    }\n                }\n\n                return that.items().filter(\".\" + SELECTED);\n            }\n\n            if (!selectable) {\n                return $();\n            }\n\n            if (typeof value !== \"undefined\") {\n                if (!selectable.options.multiple) {\n                    selectable.clear();\n\n                    value = value.first();\n                }\n\n                if (this._hasLockedColumns) {\n                    value = value.add($.map(value, this._relatedRow.bind(this)));\n                }\n            }\n\n            return selectable.value(value);\n        },\n\n        clearSelection: function() {\n            var that = this;\n\n            if (that.selectable && !that._checkBoxSelection) {\n                that.selectable.clear();\n            }\n\n            if (that._checkBoxSelection) {\n                that._deselectCheckRows(that.select(), true);\n                return;\n            }\n        },\n\n        _uncheckCheckBoxes: function() {\n            var that = this;\n            var tables = that.table.add(that.lockedTable);\n\n            tables.find(\"tbody \" + CHECKBOXINPUT).attr(\"aria-checked\", false)\n                .prop(\"checked\", false).attr(\"aria-label\", \"Select row\");\n\n        },\n\n        _deselectCheckRows: function(items, preventChange) {\n            var that = this;\n            items = that.table.add(that.lockedTable).find(items);\n\n            if (that._isLocked()) {\n                items = items.add(items.map(function() {\n                    return that._relatedRow(this);\n                }));\n            }\n\n            items.each(function() {\n                $(this).removeClass(SELECTED).find(CHECKBOXINPUT).attr(\"aria-checked\", false)\n                    .prop(\"checked\", false).attr(\"aria-label\", \"Select row\");\n            });\n            that._toggleHeaderCheckState(false);\n\n            if (!preventChange) {\n                that.trigger(CHANGE);\n            }\n        },\n\n        _headerCheckboxClick: function(e) {\n            var that = this,\n                checkBox = $(e.target),\n                checked = checkBox.prop(\"checked\"),\n                parentGrid = checkBox.closest(\".k-grid.k-widget\").getKendoTreeList();\n\n            if (that !== parentGrid) {\n                return;\n            }\n\n            if (checked) {\n                that.select(parentGrid.items());\n            } else {\n                that.clearSelection();\n            }\n            that.trigger(CHANGE);\n        },\n\n        _checkboxClick: function(e) {\n            var that = this,\n                row = $(e.target).closest(\"tr\"),\n                isSelecting = !row.hasClass(SELECTED),\n                dataItem = that.dataItem(row),\n                children = [],\n                selector = \"\";\n\n            if (that !== row.closest(\".k-grid.k-widget\").getKendoTreeList()) {\n                return;\n            }\n\n            if (that._includeChildren) {\n                that.dataSource.allChildNodes(dataItem, children);\n\n                for (var i = 0; i < children.length; i++) {\n                    selector += \"tr[data-uid='\" +\tchildren[i].uid + \"'],\";\n                }\n            }\n\n            selector += \"tr[data-uid='\" +\tdataItem.uid + \"']\";\n            row = $(selector);\n\n            if (isSelecting) {\n                that.select(row);\n                that.trigger(CHANGE);\n            } else {\n                that._deselectCheckRows(row);\n            }\n        },\n\n        _checkRows: function(items) {\n            items.each(function() {\n                $(this).addClass(SELECTED).find(CHECKBOXINPUT).prop(\"checked\", true)\n                    .attr(\"aria-label\", \"Deselect row\").attr(\"aria-checked\", true);\n            });\n        },\n\n        _toggleHeaderCheckState: function(checked) {\n            var that = this;\n            if (checked) {\n                that.thead.add(that.lockedHeader).find(\"tr \" + CHECKBOXINPUT)\n                    .prop(\"checked\", true).attr(\"aria-checked\", true)\n                    .attr(\"aria-label\", \"Deselect all rows\");\n            } else {\n                that.thead.add(that.lockedHeader).find(\"tr \" + CHECKBOXINPUT)\n                    .prop(\"checked\", false).attr(\"aria-checked\", false)\n                    .attr(\"aria-label\", \"Select all rows\");\n            }\n        },\n\n        _dataSource: function(dataSource) {\n            var that = this;\n            var ds = this.dataSource;\n            var pageable = that.options.pageable;\n\n            if (ds) {\n                ds.unbind(CHANGE, this._refreshHandler);\n                ds.unbind(ERROR, this._errorHandler);\n                ds.unbind(SORT, this._sortHandler);\n                ds.unbind(PROGRESS, this._progressHandler);\n            }\n\n            this._refreshHandler = this.refresh.bind(this);\n            this._errorHandler = this._error.bind(this);\n            this._sortHandler = this._clearSortClasses.bind(this);\n            this._progressHandler = this._progress.bind(this);\n\n\n            if (isPlainObject(dataSource)) {\n                extend(dataSource, { table: that.table, fields: that.columns });\n\n                if (isPlainObject(pageable) && pageable.pageSize !== undefined) {\n                    dataSource.pageSize = pageable.pageSize;\n                }\n            }\n\n            ds = this.dataSource = TreeListDataSource.create(dataSource);\n\n            if (pageable) {\n                ds._collapsedTotal = undefined;\n            }\n\n            ds.bind(CHANGE, this._refreshHandler);\n            ds.bind(ERROR, this._errorHandler);\n            ds.bind(SORT, this._sortHandler);\n            ds.bind(PROGRESS, this._progressHandler);\n\n            this._dataSourceFetchProxy = (function() {\n                this.dataSource.fetch();\n            }).bind(this);\n        },\n\n        setDataSource: function(dataSource) {\n            this._dataSource(dataSource);\n            this._sortable();\n            this._filterable();\n            this._filterRow();\n            this._columnMenu();\n            this._pageable();\n\n            this._contentTree.render([]);\n\n            if (this.options.autoBind) {\n                this.dataSource.fetch();\n            }\n        },\n\n        dataItem: function(element) {\n            if (element instanceof TreeListModel) {\n                return element;\n            }\n\n            var row = $(element).closest(\"tr\");\n            var uid = row.attr(kendo.attr(\"uid\"));\n            var model = isUndefined(uid) ? null : this.dataSource.getByUid(uid);\n\n            return model;\n        },\n\n        editRow: function(row) {\n            var that = this;\n            var model;\n\n            if (this._isIncellEditable() || !this.options.editable) {\n                return;\n            }\n\n            if (typeof row === STRING) {\n                row = this.tbody.find(row);\n            }\n\n            if (that._isPageable() && that._isPopupEditable() && row instanceof TreeListModel) {\n                // popup editor can be created without a rendered row\n                model = row;\n            } else {\n                model = this.dataItem(row);\n            }\n\n            if (!model) {\n                return;\n            }\n\n            if (that.editor) {\n                model._edit = true;\n                this._render();\n                this._cancelEditor();\n            } else {\n                that._preventPageSizeRestore = false;\n\n            }\n\n            if (this._editMode() != \"popup\") {\n                model._edit = true;\n            }\n\n            if (this.trigger(BEFORE_EDIT, { model: model })) {\n                that.dataSource._restorePageSizeAfterAddChild();\n                return;\n            }\n\n            this._render();\n\n            this._createEditor(model);\n\n            this.trigger(EDIT, {\n                container: this.editor.wrapper,\n                model: model\n            });\n        },\n\n        _cancelEdit: function(e) {\n            if (!this.editor) {\n                return;\n            }\n            var currentIndex;\n\n            e = extend(e, {\n                container: this.editor.wrapper,\n                model: this.editor.model\n            });\n\n            if (this.trigger(CANCEL, e)) {\n                return;\n            }\n\n            if (this.options.navigatable) {\n                currentIndex = this.items().index($(this.current()).parent());\n            }\n\n            this.cancelRow();\n\n            if (this.options.navigatable) {\n                this.current(this.items().eq(currentIndex).children().filter(NAVCELL).first());\n                focusTable(this.table, true);\n            }\n        },\n\n        cancelRow: function() {\n            if (this._isIncellEditable()) {\n                return;\n            }\n\n            this._cancelEditor();\n\n            this._render();\n        },\n\n        saveRow: function() {\n            var editor = this.editor;\n            var args;\n\n            if (this._isIncellEditable()) {\n                return;\n            }\n\n            if (!editor) {\n                return;\n            }\n\n            args = {\n                model: editor.model,\n                container: editor.wrapper\n            };\n\n            if (editor.end() && !this.trigger(SAVE, args)) {\n                this.dataSource.sync();\n            }\n        },\n\n        addRow: function(parent) {\n            var that = this;\n            var dataSource = that.dataSource;\n            var pageable = that._isPageable();\n            var incellEditing = that._isIncellEditable();\n            var inlineEditing = that._isInlineEditable();\n            var editor = this.editor;\n            var index = 0;\n            var model = {};\n\n            if ((editor && !editor.end()) || !this.options.editable) {\n                return;\n            }\n\n            if (parent) {\n                if (!(parent instanceof TreeListModel)) {\n                    parent = this.dataItem(parent);\n                }\n\n                model[parent.parentIdField] = parent.id;\n                index = this.dataSource.indexOf(parent) + 1;\n\n                this.expand(parent)\n                    .then(function() {\n                        var showNewModelInView = pageable && dataSource._isLastItemInView(parent) && (incellEditing || inlineEditing);\n                        that._insertAt(model, index, showNewModelInView);\n                    });\n\n                return;\n            }\n\n            this._insertAt(model, index);\n        },\n\n        _insertAt: function(model, index, showNewModelInView) {\n            var that = this;\n            var dataSource = that.dataSource;\n            model = that.dataSource.insert(index, model);\n\n            if (showNewModelInView) {\n                dataSource._setAddChildPageSize();\n            }\n\n            var row = this._itemFor(model);\n            var cell;\n\n            if (that._isIncellEditable()) {\n                cell = row.children(\"td\").eq(that._firstEditableColumnIndex(row));\n                that.editCell(cell);\n            } else if (row && row[0]) {\n                that.editRow(row);\n            } else if ((that._isPageable() || that.dataSource.filter()) && (that._isPopupEditable() || that._isInlineEditable())) {\n                that.editRow(model);\n            }\n        },\n\n        _firstEditableColumnIndex: function(container) {\n            var that = this;\n            var model = that.dataItem(container);\n            var columns = leafColumns(that.columns);\n            var length = columns.length;\n            var column;\n            var idx;\n\n            for (idx = 0; idx < length; idx++) {\n                column = columns[idx];\n\n                if (model && (!model.editable || model.editable(column.field)) && !column.command && column.field && column.hidden !== true) {\n                    return idx;\n                }\n            }\n\n            return -1;\n        },\n\n        removeRow: function(row) {\n            var model = this.dataItem(row);\n            var args = {\n                model: model,\n                row: row\n            };\n\n            if (this.options.editable && model && !this.trigger(REMOVE, args)) {\n                if (document.activeElement === $(row).find(\".k-grid-delete\")[0]) {\n                    $(row).find(\".k-grid-delete\").trigger(\"blur\");\n                }\n                this.dataSource.remove(model);\n\n                if (!this._isIncellEditable()) {\n                    this.dataSource.sync();\n                }\n            }\n        },\n\n        _cancelEditor: function() {\n            var that = this;\n            var model;\n            var editor = that.editor;\n\n            if (editor) {\n                model = editor.model;\n\n                that._destroyEditor();\n\n                if (!that._isIncellEditable()) {\n                    that.dataSource.cancelChanges(model);\n                } else if (that._shouldRestorePageSize()) {\n                    that.dataSource._restorePageSizeAfterAddChild();\n                }\n\n                model._edit = false;\n            }\n\n            that._preventPageSizeRestore = false;\n        },\n\n        _shouldRestorePageSize: function() {\n            var that = this;\n            return that._isPageable() && that._isIncellEditable() && !that._preventPageSizeRestore;\n        },\n\n        _destroyEditor: function() {\n            if (!this.editor) {\n                return;\n            }\n\n            this.editor.close();\n            this.editor = null;\n        },\n\n        _createEditor: function(model) {\n            var row = this.itemFor(model);\n            var columns = leafColumns(this.columns);\n            var leafCols = [];\n\n            for (var idx = 0; idx < columns.length; idx++) {\n                leafCols.push(extend({}, columns[idx]));\n                delete leafCols[idx].parentColumn;\n            }\n\n            row = row.add(this._relatedRow(row));\n\n            var mode = this._editMode();\n\n            var options = {\n                columns: leafCols,\n                model: model,\n                target: this,\n                clearContainer: false,\n                template: this.options.editable.template\n            };\n\n            if (mode == \"inline\") {\n                this.editor = new Editor(row, options);\n            } else {\n                extend(options, {\n                    window: this.options.editable.window,\n                    commandRenderer: (function() {\n                        return this._buildCommands([\"update\", \"canceledit\"]);\n                    }).bind(this),\n                    fieldRenderer: this._cellContent.bind(this),\n                    save: this.saveRow.bind(this),\n                    cancel: this._cancelEdit.bind(this),\n                    appendTo: this.wrapper\n                });\n\n                this.editor = new PopupEditor(row, options);\n            }\n        },\n\n        _createIncellEditor: function(cell, options) {\n            var that = this;\n            var column = extend({}, options.columns[0]);\n\n            delete column.parentColumn;\n\n            return new IncellEditor(cell, extend({}, {\n                fieldRenderer: that._cellContent.bind(that),\n                appendTo: that.wrapper,\n                clearContainer: false,\n                target: that,\n                columns: [column],\n                model: options.model,\n                change: options.change\n            }));\n        },\n\n        editCell: function(cell) {\n            var that = this;\n            cell = $(cell);\n            var column = leafColumns(that.columns)[that.cellIndex(cell)];\n            var model = that.dataItem(cell);\n\n            if (that._isIncellEditable() && model && isColumnEditable(column, model)) {\n                that._editCell(cell, column, model);\n            }\n        },\n\n        _editCell: function(cell, column, model) {\n            var that = this;\n            var editedCell;\n\n            if (that.trigger(BEFORE_EDIT, { model: model })) {\n                that.dataSource._restorePageSizeAfterAddChild();\n                return;\n            }\n\n            that.closeCell();\n\n            model._edit = true;\n\n            that._cancelEditor();\n\n            that._render({\n                editedColumn: column,\n                editedColumnIndex: cell.index()\n            });\n\n            editedCell = that.table.add(that.lockedTable).find(DOT + classNames.editCell).first();\n\n            that.editor = that._createIncellEditor(editedCell, {\n                columns: [column],\n                model: model,\n                change: function(e) {\n                    if (that.trigger(SAVE, { values: e.values, container: cell, model: model } )) {\n                        e.preventDefault();\n                    }\n\n                }\n            });\n\n            // refresh the current element as the DOM element reference can be changed after render()\n            that._current = editedCell;\n\n            that.trigger(EDIT, { container: cell, model: model });\n        },\n\n        closeCell: function(isCancel) {\n            var that = this;\n            var cell = (that.editor || {}).element;\n            var tr;\n            var model;\n\n            if (!cell || !cell[0] || !that._isIncellEditable()) {\n                return;\n            }\n\n            model = that.dataItem(cell);\n\n            if (isCancel && that.trigger(CANCEL, { container: cell, model: model })) {\n                return;\n            }\n\n            that.trigger(CELL_CLOSE, { type: isCancel ? CANCEL : SAVE, model: model, container: cell });\n\n            that._cancelEditor();\n\n            cell.removeClass(classNames.editCell);\n\n            tr = cell.parent().removeClass(classNames.editRow);\n\n            if (that.lockedContent) {\n                that._relatedRow(tr).removeClass(classNames.editRow);\n            }\n\n            that._render();\n\n            that.trigger(ITEM_CHANGE, { item: tr, data: model, ns: ui });\n\n            if (that.lockedContent) {\n                adjustRowHeight(tr.css(\"height\", \"\")[0], that._relatedRow(tr).css(\"height\", \"\")[0]);\n            }\n        },\n\n        cancelChanges: function() {\n            this.dataSource.cancelChanges();\n        },\n\n        saveChanges: function() {\n            var that = this;\n            var editable = (that.editor || {}).editable;\n            var valid = editable && editable.end();\n\n            if ((valid || !editable) && !that.trigger(SAVE_CHANGES)) {\n                that.dataSource.sync();\n            }\n        },\n\n        _editMode: function() {\n            var mode = \"inline\",\n                editable = this.options.editable;\n\n            if (editable !== true) {\n                if (typeof editable == \"string\") {\n                    mode = editable;\n                } else {\n                    mode = editable.mode || mode;\n                }\n            }\n\n            return mode.toLowerCase();\n        },\n\n        _isIncellEditable: function() {\n            return this._editMode() === INCELL;\n        },\n\n        _isInlineEditable: function() {\n            return this._editMode() === INLINE;\n        },\n\n        _isPopupEditable: function() {\n            return this._editMode() === POPUP;\n        },\n\n        hideColumn: function(column) {\n            this._toggleColumnVisibility(column, true);\n        },\n\n        showColumn: function(column) {\n            this._toggleColumnVisibility(column, false);\n        },\n\n        _toggleColumnVisibility: function(column, hidden) {\n            column = this._findColumn(column);\n\n            if (!column || column.hidden === hidden) {\n                return;\n            }\n\n            column.hidden = hidden;\n            this._setParentsVisibility(column, !hidden);\n\n            this._ensureExpandableColumn();\n            this._clearColsCache();\n            this._renderCols();\n            this._renderHeader();\n            this._render();\n\n            this._adjustTablesWidth();\n\n            this.trigger(hidden ? COLUMNHIDE : COLUMNSHOW, { column: column });\n\n            if (!hidden && !column.width) {\n                this.table\n                    .add(this.thead.closest(\"table\"))\n                    .width(\"\");\n            }\n            this._updateFirstColumnClass();\n        },\n\n        _findColumn: function(column) {\n            if (typeof column == \"number\") {\n                column = this.columns[column];\n            } else if (isPlainObject(column)) {\n                column = grep(leafColumns(this.columns), function(item) {\n                    return item === column;\n                })[0];\n            } else {\n                column = grep(leafColumns(this.columns), function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            return column;\n        },\n\n        _adjustTablesWidth: function() {\n            var idx, length;\n            var cols = this.thead.prev().children();\n            var colWidth, width = 0;\n\n            for (idx = 0, length = cols.length; idx < length; idx++ ) {\n                colWidth = cols[idx].style.width;\n                if (colWidth && colWidth.indexOf(\"%\") == -1) {\n                    width += parseInt(colWidth, 10);\n                } else {\n                    width = 0;\n                    break;\n                }\n            }\n\n\n            if (width) {\n                this.table\n                    .add(this.thead.closest(\"table\"))\n                    .width(width);\n            }\n        },\n\n        _reorderable: function() {\n            if (!this.options.reorderable) {\n                return;\n            }\n\n            var scrollable = this.options.scrollable === true;\n            var selector = (scrollable ? \".k-grid-header:first \" : \"table:first>.k-grid-header \") + HEADERCELLS;\n            var that = this;\n\n            this._draggableInstance = new ui.Draggable(this.wrapper, {\n                group: kendo.guid(),\n                filter: selector,\n                hint: function(target) {\n                    return $('<div class=\"k-reorder-clue k-drag-clue\" />')\n                    .html(target.attr(kendo.attr(\"title\")) || target.attr(kendo.attr(\"field\")) || target.text())\n                    .prepend('<span class=\"k-icon k-drag-status k-i-cancel\" />');\n                }\n            });\n\n            this.reorderable = new ui.Reorderable(this.wrapper, {\n                draggable: this._draggableInstance,\n                dragOverContainers: this._allowDragOverContainers.bind(this),\n                inSameContainer: function(e) {\n                    return $(e.source).parent()[0] === $(e.target).parent()[0] && targetParentContainerIndex(flatColumnsInDomOrder(that.columns), that.columns, e.sourceIndex, e.targetIndex) > -1;\n                },\n                change: function(e) {\n                    var columns = flatColumnsInDomOrder(that.columns);\n                    var column = columns[e.oldIndex];\n                    var newIndex = targetParentContainerIndex(columns, that.columns, e.oldIndex, e.newIndex);\n\n                    that.trigger(COLUMNREORDER, {\n                        newIndex: newIndex,\n                        oldIndex: inArray(column, columns),\n                        column: column\n                    });\n\n                    that.reorderColumn(newIndex, column, e.position === \"before\");\n                }\n            });\n        },\n\n        _allowDragOverContainers: function(sourceIndex, targetIndex) {\n            var columns = flatColumnsInDomOrder(this.columns);\n            return columns[sourceIndex].lockable !== false && targetParentContainerIndex(columns, this.columns, sourceIndex, targetIndex) > -1;\n        },\n\n        _reorderTrees: function(destSources, destContainer, destDomTree, sources, sourcesContainer, sourcesDomTree, before, depth) {\n            var ths = $();\n            var source = sourcesContainer.find(\"tr\").eq(sources[0].rowIndex);\n            var sourceDOM = sourcesDomTree.children[sources[0].rowIndex];\n            var sourceChildren = source.children();\n            var destDomChildren;\n            var currentIndex;\n            var destColumn = before ? destSources[0] : destSources[destSources.length - 1];\n            var destRow;\n            var sourcesLeafs;\n            var destLeafs;\n            var reorderTaget;\n            var destThs;\n\n            for (var idx = 0; idx < sources.length; idx++) {\n                currentIndex = sources[idx].cellIndex;\n                ths = ths.add(sourceChildren.eq(currentIndex));\n                destDomChildren = destDomTree.children[destColumn.rowIndex].children;\n                if (destDomTree === sourcesDomTree && before) {\n                    currentIndex += idx;\n                }\n\n                destDomChildren.splice(before ? destColumn.cellIndex + idx : destColumn.cellIndex + 1 + idx, 0, sourceDOM.children[currentIndex]);\n            }\n\n            if (destDomTree === sourcesDomTree && before) {\n                sourceDOM.children.splice(sources[0].cellIndex + sources.length, sources.length);\n            } else {\n                sourceDOM.children.splice(sources[0].cellIndex, sources.length);\n            }\n            destRow = destContainer.find(\"tr\").eq(destColumn.rowIndex);\n            destThs = destRow.find(\">th.k-header\").eq(destColumn.cellIndex);\n\n            if (destThs.length && ths[0] !== destThs[0]) {\n                ths[before ? \"insertBefore\" : \"insertAfter\"](destThs);\n            }\n\n            if (depth >= sources[0].rowIndex + 1 && depth != 1) {\n                sourcesLeafs = [];\n                for (idx = 0; idx < sources.length; idx++) {\n                    if (sources[idx].columns) {\n                        sourcesLeafs = sourcesLeafs.concat(sources[idx].columns);\n                    }\n                }\n                if (!sourcesLeafs.length) {\n                    return;\n                }\n\n                destLeafs = [];\n\n                for (idx = 0; idx < destSources.length; idx++) {\n                    if (destSources[idx].columns) {\n                        destLeafs = destLeafs.concat(destSources[idx].columns);\n                    }\n                }\n\n                if (!destLeafs.length && (destContainer !== sourcesContainer || (destColumn.cellIndex - sources[0].cellIndex > 1 || sources[0].cellIndex - destColumn.cellIndex > 1))) {\n                    reorderTaget = findReorderTarget(this.columns, destColumn, sources[0], before, this.columns);\n\n                    destLeafs = [reorderTaget];\n                    if (!reorderTaget && sourcesLeafs.length && destContainer.find(\"tr\").length > sources[0].rowIndex + 1) {\n                        this._insertTree(sourcesLeafs, sourcesContainer, sourcesDomTree, destContainer, destDomTree);\n                        return;\n                    }\n                }\n\n                if (!destLeafs.length) {\n                    return;\n                }\n\n                this._reorderTrees(destLeafs, destContainer, destDomTree, sourcesLeafs, sourcesContainer, sourcesDomTree, before, depth);\n            }\n        },\n\n        _insertTree: function(columns, sourcesContainer, sourcesDomTree, destContainer, destDomTree) {\n            var leafs = [];\n            var row;\n            var ths = $();\n            var domTr;\n\n            row = sourcesContainer.find(\"tr\").eq(columns[0].rowIndex);\n            domTr = sourcesDomTree.children[columns[0].rowIndex];\n\n            for (var idx = 0; idx < columns.length; idx++) {\n                if (columns[idx].columns) {\n                    leafs = leafs.concat(columns[idx].columns);\n                }\n                destDomTree.children[columns[0].rowIndex].children.splice(idx, 0, domTr.children[columns[idx].rowIndex]);\n                ths = ths.add(row.find(\">th.k-header\").eq(columns[idx].cellIndex));\n            }\n\n            sourcesDomTree.children[columns[0].rowIndex].children.splice(columns[0].cellIndex, columns.length);\n            destContainer.find(\"tr\").eq(columns[0].rowIndex).append(ths);\n\n            if (leafs.length) {\n                this._insertTree(leafs, sourcesContainer, sourcesDomTree, destContainer, destDomTree);\n            }\n        },\n\n        _reorderHeader: function(destColumn, column, before) {\n            var sourcesDepth = column.columns ? depth([column]) : 1;\n            var targetDepth = destColumn.columns ? depth([destColumn]) : 1;\n            var sourceLocked = isLocked(column);\n            var destLocked = isLocked(destColumn);\n            var destContainer = destLocked ? this.lockedHeader : this.thead;\n            var sourcesContainer = sourceLocked ? this.lockedHeader : this.thead;\n            var destDomTree = destLocked ? this._lockedHeaderTree : this._headerTree;\n            var sourcesDomTree = sourceLocked ? this._lockedHeaderTree : this._headerTree;\n            var rowsToAdd;\n            var destRows = destContainer.find(\"tr:not(.k-filter-row)\");\n            var destTarget;\n\n\n            if (sourcesDepth === targetDepth || sourcesDepth < destRows.length ) {\n                this._reorderTrees([destColumn], destContainer, destDomTree , [column], sourcesContainer ,sourcesDomTree, before, sourcesDepth);\n                updateRowSpans(destContainer, destDomTree);\n                removeEmptyRows(sourcesContainer, sourcesDomTree);\n            } else {\n                if (destContainer !== sourcesContainer) {\n                    rowsToAdd = sourcesDepth - destRows.length;\n\n                    destRows.each(function(idx) {\n                        var cells = this.cells;\n                        for (var i = 0; i < cells.length; i++) {\n                            if (cells[i].colSpan <= 1 && cells[i].attributes.rowspan) {\n                                destDomTree.children[idx].children[i].attr.rowSpan += rowsToAdd;\n                                cells[i].rowSpan += rowsToAdd;\n                            }\n                        }\n                    });\n\n                    for (var j = 0; j < rowsToAdd; j++) {\n                       destDomTree.children.push(kendoDomElement(\"tr\", { \"role\": \"row\" }));\n                       if (destContainer.is(\"thead\")) {\n                           destTarget = destContainer;\n                       } else {\n                          destTarget = destContainer.find(\"thead\");\n                       }\n\n                       if (this._hasFilterRow()) {\n                           $(\"<tr role='row'></tr>\").insertBefore(destTarget.find('tr.k-filter-row'));\n                       } else {\n                           destTarget.append(\"<tr role='row'></tr>\");\n                       }\n                    }\n                }\n\n                this._reorderTrees([destColumn], destContainer, destDomTree , [column], sourcesContainer ,sourcesDomTree, before, sourcesDepth);\n                removeEmptyRows(sourcesContainer, sourcesDomTree);\n             }\n        },\n\n        reorderColumn: function(destIndex, column, before) {\n            var lockChanged;\n            var parent = column.parentColumn;\n            var columns = parent ? parent.columns : this.columns;\n            var sourceIndex = inArray(column, columns);\n            var destColumn = columns[destIndex];\n            var isLocked = !!destColumn.locked;\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n            var nonLockedColumnsLength = nonLockedColumns(columns).length;\n\n            if (sourceIndex === destIndex) {\n                return;\n            }\n\n            if (isLocked && !column.locked && nonLockedColumnsLength == 1) {\n                return;\n            }\n\n            if (!isLocked && column.locked && (columns.length - nonLockedColumnsLength == 1)) {\n                return;\n            }\n\n            if (before === undefined) {\n                before = destIndex < sourceIndex;\n            }\n\n            if (hasMultiColumnHeaders) {\n                this._reorderHeader(destColumn, column, before);\n            }\n\n            lockChanged = !!column.locked;\n            lockChanged = lockChanged != isLocked;\n\n            column.locked = isLocked;\n            columns.splice(before ? destIndex : destIndex + 1, 0, column);\n            columns.splice(sourceIndex < destIndex ? sourceIndex : sourceIndex + 1, 1);\n            this._setColumnDataIndexes(leafColumns(this.columns));\n            this._clearColsCache();\n            this._renderCols();\n\n            //reorder column header manually\n            if (!hasMultiColumnHeaders) {\n                var ths = $(this.lockedHeader).add(this.thead).find(\"tr:not(.k-filter-row) th\");\n\n                ths.eq(sourceIndex)[before ? \"insertBefore\" : \"insertAfter\"](ths.eq(destIndex));\n\n                var dom = this._headerTree.children[0].children;\n                if (this._hasLockedColumns) {\n                    dom = this._lockedHeaderTree.children[0].children.concat(dom);\n                }\n                dom.splice(before ? destIndex : destIndex + 1, 0, dom[sourceIndex]);\n                dom.splice(sourceIndex < destIndex ? sourceIndex : sourceIndex + 1, 1);\n                if (this._hasLockedColumns) {\n                    this._lockedHeaderTree.children[0].children = dom.splice(0, lockedColumns(columns).length);\n                    this._headerTree.children[0].children = dom;\n                }\n            } else {\n                if (this.lockedHeader) {\n                    columns = nonLockedColumns(this.columns);\n                    this._prepareColumns([{ rowSpan: 1, cells: [], index: 0 }], columns);\n                    columns = lockedColumns(this.columns);\n                    this._prepareColumns([{ rowSpan: 1, cells: [], index: 0 }], columns);\n                } else {\n                    this._prepareColumns([{ rowSpan: 1, cells: [], index: 0 }], this.columns);\n                }\n            }\n            this._updateColumnCellIndex();\n            this._applyLockedContainersWidth();\n            this._syncLockedHeaderHeight();\n            this._updateFirstColumnClass();\n\n            if (this._hasFilterRow()) {\n                this._updateFilterThs(before, column, destColumn);\n            }\n\n            this.refresh();\n\n            if (!lockChanged) {\n                return;\n            }\n\n            if (isLocked) {\n                this.trigger(COLUMNLOCK, {\n                    column: column\n                });\n            } else {\n                this.trigger(COLUMNUNLOCK, {\n                    column: column\n                });\n            }\n        },\n\n        lockColumn: function(column) {\n            var columns = this.columns;\n\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else {\n                column = grep(columns, function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || column.hidden) {\n                return;\n            }\n\n            var index = lockedColumns(columns).length - 1;\n            this.reorderColumn(index, column, false);\n        },\n\n        unlockColumn: function(column) {\n            var columns = this.columns;\n\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else {\n                column = grep(columns, function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || column.hidden) {\n                return;\n            }\n\n            var index = lockedColumns(columns).length;\n            this.reorderColumn(index, column, true);\n        },\n\n        _columnMenu: function() {\n            var ths = $(this.lockedHeader).add(this.thead).find(\"th\");\n            var columns = this.columns;\n            var options = this.options;\n            var columnMenu = options.columnMenu;\n            var column, menu, menuOptions, sortable, filterable;\n            var initHandler = this._columnMenuInit.bind(this);\n            var openHandler = this._columnMenuOpen.bind(this);\n            var hasLockableColumns = grep(this.columns, function(item) {\n                return item.lockable !== false;\n            }).length > 0;\n            var hasMultiColumnHeaders = grep(this.columns, function(item) {\n                return item.columns !== undefined;\n            }).length > 0;\n\n            if (hasMultiColumnHeaders) {\n                columns = leafColumns(columns);\n                if (this.lockedHeader) {\n                    ths = sortCells(leafDataCells(this.lockedHeader.find(\">table>thead\")).add(leafDataCells(this.thead)));\n                } else {\n                    ths = leafDataCells(this.thead);\n                }\n            } else {\n                ths = $(this.lockedHeader).add(this.thead).find(\"tr:not(.k-filter-row) th\");\n            }\n\n            if (!columnMenu) {\n                return;\n            }\n\n            if (typeof columnMenu == \"boolean\") {\n                columnMenu = {};\n            }\n\n            for (var i = 0; i < ths.length; i++) {\n                column = columns[i];\n                if (!column.field) {\n                    continue;\n                }\n\n                menu = ths.eq(i).data(\"kendoColumnMenu\");\n                if (menu) {\n                    menu.destroy();\n                }\n\n                sortable = false;\n                if (column.sortable !== false && columnMenu.sortable !== false && options.sortable !== false) {\n                    sortable = extend({}, options.sortable, { compare: (column.sortable || {}).compare });\n                }\n\n                filterable = false;\n                if (options.filterable && column.filterable !== false && columnMenu.filterable !== false) {\n                    filterable = extend({ pane: this.pane }, column.filterable, options.filterable);\n                }\n\n                menuOptions = {\n                    dataSource: this.dataSource,\n                    values: column.values,\n                    columns: columnMenu.columns,\n                    sortable: sortable,\n                    filterable: filterable,\n                    messages: columnMenu.messages,\n                    owner: this,\n                    closeCallback: closeCallback,\n                    init: initHandler,\n                    open: openHandler,\n                    pane: this.pane,\n                    hasLockableColumns: lockedColumns(columns).length > 0 && hasLockableColumns && !hasMultiColumnHeaders,\n                    appendTo: DOT + classNames.headerCellInner\n                };\n\n                if (options.$angular) {\n                    menuOptions.$angular = options.$angular;\n                }\n\n                ths.eq(i).kendoColumnMenu(menuOptions);\n            }\n        },\n\n        _columnMenuInit: function(e) {\n            this.trigger(COLUMNMENUINIT, { field: e.field, container: e.container });\n        },\n\n        _columnMenuOpen: function(e) {\n            this.trigger(COLUMNMENUOPEN, { field: e.field, container: e.container });\n        },\n\n        _pageable: function() {\n            var that = this,\n                wrapper,\n                pageable = that.options.pageable;\n\n            if (pageable) {\n                wrapper = that.wrapper.children(\"div.k-grid-pager\");\n\n                if (!wrapper.length) {\n                    wrapper = $('<div class=\"k-pager-wrap k-grid-pager\"/>').appendTo(that.wrapper);\n                }\n\n                that._destroyPager();\n\n                if (typeof pageable === \"object\" && pageable instanceof kendo.ui.TreeListPager) {\n                    that.pager = pageable;\n                } else if (that.dataSource && !that.dataSource.options.serverPaging) {\n                    that._createPager(wrapper);\n                }\n\n                if (that.pager) {\n                    that.pager.bind(PAGE_CHANGE, function(e) {\n                        if (that.trigger(PAGE, { page: e.index })) {\n                            e.preventDefault();\n                        }\n                    });\n                }\n            }\n        },\n\n        _createPager: function(element, options) {\n            var that = this;\n\n            that.pager = new TreeListPager(element, extend({}, that.options.pageable, {\n                dataSource: that.dataSource,\n                navigatable: that.options.navigatable\n            }, options));\n        },\n\n        _destroyPager: function() {\n            if (this.pager) {\n                this.pager.destroy();\n                this.pager = null;\n            }\n        },\n\n        _isPageable: function() {\n            var that = this;\n            return that.options.pageable && (!that.dataSource || (that.dataSource && that.dataSource._isPageable()));\n        },\n\n        _togglePagerVisibility: function() {\n            var that = this;\n            var pageable = that.options.pageable;\n\n            if (pageable && (isPlainObject(pageable) || pageable instanceof TreeListPager) && pageable.alwaysVisible === false) {\n                that.wrapper.find(\".k-grid-pager\").toggle((that.dataSource.collapsedTotal() || 0) >= that.dataSource.pageSize());\n            }\n        }\n    });\n\n    function closeCallback(element) {\n        focusTable(element.closest(\"table\"), true);\n    }\n\n    function isInputElement(element) {\n       return $(element).is(\":button,a,:input,a>.k-icon,textarea,span.k-select,span.k-icon,span.k-link,.k-input,.k-multiselect-wrap,.k-tool-icon\");\n    }\n\n    function isLocked(column) {\n        if (!column.parentColumn) {\n            return !!column.locked;\n        }\n        return !!isLocked(column.parentColumn);\n    }\n\n    function findParentColumnWithChildren(columns, index, source, rtl) {\n        var target;\n        var locked = !!source.locked;\n        var targetLocked;\n\n        do {\n            target = columns[index];\n            index += rtl ? 1 : -1;\n            targetLocked = !!target.locked;\n        } while (target && index > -1 && index < columns.length && target != source && !target.columns && targetLocked === locked);\n\n        return target;\n    }\n\n    function findReorderTarget(columns, target, source, before, masterColumns) {\n        if (target.columns) {\n            target = target.columns;\n            return target[before ? 0 : target.length - 1];\n        } else {\n            var parent = columnParent(target, columns);\n            var parentColumns;\n\n            if (parent) {\n                parentColumns = parent.columns;\n            } else {\n                parentColumns = columns;\n            }\n\n            var index = inArray(target, parentColumns);\n            if (index === 0 && before && parentColumns.length !== 1) {\n                index++;\n            } else if (index == parentColumns.length - 1 && !before && index !== 0) {\n                index--;\n            } else if (index > 0 || (index === 0 && !before && index !== 0)) {\n                index += before ? -1 : 1;\n            }\n\n            var sourceIndex = inArray(source, parentColumns);\n            target = findParentColumnWithChildren(parentColumns, index, source, sourceIndex > index);\n            var targetIndex = inArray(target, masterColumns);\n            if (target.columns && (!targetIndex || targetIndex === parentColumns.length - 1)) {\n                return null;\n            }\n\n            if (target && target != source && target.columns) {\n                return findReorderTarget(columns, target, source, before, masterColumns);\n            }\n        }\n        return null;\n    }\n\n    function leafColumns(columns) {\n        var result = [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (!columns[idx].columns) {\n                result.push(columns[idx]);\n                continue;\n            }\n            result = result.concat(leafColumns(columns[idx].columns));\n        }\n\n        return result;\n    }\n\n    function getColumnsFields(columns) {\n        var result = [];\n        columns = leafColumns(columns);\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (typeof columns[idx] === \"string\") {\n                result.push(columns[idx]);\n            } else if (columns[idx].field) {\n                result.push(columns[idx].field);\n            }\n        }\n        return result;\n    }\n\n    function visibleChildColumns(columns) {\n        return grep(columns, function(column) {\n            return !column.hidden;\n        });\n    }\n\n    function isVisible(column) {\n        return visibleColumns([column]).length > 0;\n    }\n\n    function visibleColumns(columns) {\n        return grep(columns, function(column) {\n            var result = !column.hidden;\n            if (result && column.columns) {\n                result = visibleColumns(column.columns).length > 0;\n            }\n            return result;\n        });\n    }\n\n    function normalizeColumns(columns, hide, parentIds) {\n        return map(columns, function(column) {\n            var hidden;\n\n            column.parentIds = parentIds;\n\n            if (!isVisible(column) || hide) {\n                hidden = true;\n            }\n\n            var uid = kendo.guid();\n            column.headerAttributes = extend({ headers: parentIds }, column.headerAttributes);\n            if (!column.headerAttributes || !column.headerAttributes.id) {\n                column.headerAttributes = extend({ id: uid }, column.headerAttributes);\n            } else {\n                uid = column.headerAttributes.id;\n            }\n\n            if (column.columns) {\n                column.columns = normalizeColumns(column.columns, hidden, parentIds ? (parentIds + \" \" + uid) : uid);\n            }\n            return extend({ hidden: hidden }, column);\n        });\n    }\n\n    function flatColumnsInDomOrder(columns) {\n        var result = flatColumns(lockedColumns(columns));\n        return result.concat(flatColumns(nonLockedColumns(columns)));\n    }\n\n    function targetParentContainerIndex(flatColumns, columns, sourceIndex, targetIndex) {\n        var column = flatColumns[sourceIndex];\n        var target = flatColumns[targetIndex];\n\n        var parent = columnParent(column, columns);\n        columns = parent ? parent.columns : columns;\n\n        return inArray(target, columns);\n    }\n\n    function parentColumnsCells(cell) {\n        var container = cell.closest(\"table\");\n        var result = $().add(cell);\n\n        var row = cell.closest(\"tr\");\n        var headerRows = container.find(\"tr\");\n        var level = headerRows.index(row);\n        if (level > 0) {\n            var parent = headerRows.eq(level - 1);\n            var parentCellsWithChildren = parent.find(\"th\").filter(function() {\n                return !$(this).attr(\"rowspan\");\n            });\n\n            var offset = 0;\n            var index = row.find(\"th\").index(cell);\n\n            var prevCells = cell.prevAll().filter(function() {\n                return this.colSpan > 1;\n            });\n\n            for (var idx = 0; idx < prevCells.length; idx++) {\n                offset += prevCells[idx].colSpan || 1;\n            }\n\n            index += Math.max(offset - 1, 0);\n\n            offset = 0;\n            for (idx = 0; idx < parentCellsWithChildren.length; idx++) {\n                var parentCell = parentCellsWithChildren.eq(idx);\n                if (parentCell.attr(\"data-colspan\")) {\n                    offset += parentCell[0].getAttribute(\"data-colspan\");\n                } else {\n                    offset += 1;\n                }\n                if (index >= idx && index < offset) {\n                    result = parentColumnsCells(parentCell).add(result);\n                    break;\n                }\n            }\n        }\n        return result;\n    }\n\n    function childColumnsCells(cell) {\n        var container = cell.closest(\"thead\");\n        var result = $().add(cell);\n\n        var row = cell.closest(\"tr\");\n        var headerRows = container.find(\"tr\");\n        var level = headerRows.index(row) + cell[0].rowSpan;\n        var colSpanAttr = kendo.attr(\"colspan\");\n\n        if (level <= headerRows.length - 1) {\n            var child = row.next();\n            var prevCells = cell.prevAll();\n\n            var idx;\n\n            prevCells = prevCells.filter(function() {\n                return !this.rowSpan || this.rowSpan === 1;\n            });\n\n            var offset = 0;\n\n            for (idx = 0; idx < prevCells.length; idx++) {\n                offset += parseInt(prevCells.eq(idx).attr(colSpanAttr), 10) || 1;\n            }\n\n            var cells = child.find(\"th\");\n            var colSpan = parseInt(cell.attr(colSpanAttr), 10) || 1;\n\n            idx = 0;\n\n            while (idx < colSpan) {\n                child = cells.eq(idx + offset);\n                result = result.add(childColumnsCells(child));\n                var value = parseInt(child.attr(colSpanAttr), 10);\n                if (value > 1) {\n                    colSpan -= value - 1;\n                }\n                idx++;\n            }\n        }\n\n        return result;\n    }\n\n    function columnParent(column, columns) {\n        var parents = [];\n        columnParents(column, columns, parents);\n        return parents[parents.length - 1];\n    }\n\n    function columnParents(column, columns, parents) {\n        parents = parents || [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (column === columns[idx]) {\n                return true;\n            } else if (columns[idx].columns) {\n                var inserted = parents.length;\n                parents.push(columns[idx]);\n                if (!columnParents(column, columns[idx].columns, parents)) {\n                    parents.splice(inserted, parents.length - inserted);\n                } else {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n\n    function flatColumns(columns) {\n        var result = [];\n        var children = [];\n        for (var idx = 0; idx < columns.length; idx++) {\n            result.push(columns[idx]);\n            if (columns[idx].columns) {\n                children = children.concat(columns[idx].columns);\n            }\n\n        }\n        if (children.length) {\n            result = result.concat(flatColumns(children));\n        }\n        return result;\n    }\n\n    function columnPosition(column, columns, row, cellCounts) {\n        var result;\n        var idx;\n\n        row = row || 0;\n        cellCounts = cellCounts || {};\n        cellCounts[row] = cellCounts[row] || 0;\n\n        for (idx = 0; idx < columns.length; idx++) {\n           if (columns[idx] == column) {\n                result = { cell: cellCounts[row], row: row };\n                break;\n           } else if (columns[idx].columns) {\n               result = columnPosition(column, columns[idx].columns, row + 1, cellCounts);\n               if (result) {\n                    break;\n               }\n           }\n\n           cellCounts[row]++;\n        }\n        return result;\n    }\n\n    function updateCellIndex(thead, columns, offset) {\n        offset = offset || 0;\n\n        var position;\n        var cell;\n        var allColumns = columns;\n        columns = leafColumns(columns);\n\n        var cells = {};\n        var rows = thead.find(\">tr:not(.k-filter-row)\");\n\n        var filter = function() {\n            var el = $(this);\n            return !el.hasClass(\"k-group-cell\") && !el.hasClass(\"k-hierarchy-cell\");\n        };\n\n        for (var idx = 0, length = columns.length; idx < length; idx++) {\n            position = columnPosition(columns[idx], allColumns);\n\n            if (!cells[position.row]) {\n                cells[position.row] = rows.eq(position.row)\n                    .find(\".k-header\")\n                    .filter(filter);\n            }\n\n            cell = cells[position.row].eq(position.cell);\n            cell.attr(kendo.attr(\"index\"), offset + idx);\n        }\n\n        return columns.length;\n    }\n\n    function depth(columns) {\n        var result = 1;\n        var max = 0;\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (columns[idx].columns) {\n                var temp = depth(columns[idx].columns);\n                if (temp > max) {\n                    max = temp;\n                }\n            }\n        }\n        return result + max;\n    }\n\n    function lockedColumns(columns) {\n        return grep(columns, is(\"locked\"));\n    }\n\n    function nonLockedColumns(columns) {\n        return grep(columns, not(is(\"locked\")));\n    }\n\n    function updateRowSpans(container, containerDOMtree) {\n        var rows = container.find(\"tr:not(.k-filter-row)\");\n        var length = rows.length;\n\n        rows.each(function(idx) {\n            var cells = this.cells;\n            for (var i = 0; i < cells.length; i++) {\n                if (cells[i].colSpan <= 1 && cells[i].attributes.rowspan) {\n                    containerDOMtree.children[idx].children[i].attr.rowSpan = length - idx;\n                    cells[i].rowSpan = length - idx;\n                }\n            }\n        });\n    }\n\n    function removeEmptyRows(container, containerDOMtree) {\n        var rows = container.find(\"tr\");\n        var emptyRows = [];\n\n        rows.filter(function(idx) {\n            var shouldRemove = !$(this).children().length;\n            if (shouldRemove) {\n                emptyRows.push(idx);\n\n            }\n            return shouldRemove;\n        }).remove();\n\n        for (var i = emptyRows.length - 1; i >= 0; i--) {\n            containerDOMtree.children.splice(emptyRows[i], 1);\n        }\n\n        updateRowSpans(container, containerDOMtree);\n    }\n\n    function focusTable(table, direct) {\n      if (direct === true) {\n         table = $(table);\n         var scrollTop, scrollLeft;\n         scrollTop = table.parent().scrollTop();\n         scrollLeft = kendo.scrollLeft(table.parent());\n\n        kendo.focusElement(table);\n\n        kendo.scrollLeft(table.parent().scrollTop(scrollTop), scrollLeft);\n\n      } else {\n         $(table).one(\"focusin\", function(e) { e.preventDefault(); }).trigger(\"focus\");\n      }\n    }\n\n    function adjustRowHeight(row1, row2) {\n       var height;\n       var offsetHeight1 = row1.offsetHeight;\n       var offsetHeight2 = row2.offsetHeight;\n\n       if (offsetHeight1 > offsetHeight2) {\n           height = offsetHeight1 + \"px\";\n       } else if (offsetHeight1 < offsetHeight2) {\n           height = offsetHeight2 + \"px\";\n       }\n\n       if (height) {\n           row1.style.height = row2.style.height = height;\n       }\n    }\n\n    function isColumnEditable(column, model) {\n        if (!column || !model || !column.field || column.selectable || column.command || (column.editable && !column.editable(model))) {\n            return false;\n        }\n\n        return (column.field && model.editable && model.editable(column.field));\n    }\n\n    function isDirtyColumn(column, model) {\n        var field = (column || {}).field || \"\";\n        return (model.dirty && model.dirtyFields && model.dirtyFields[field] && isColumnEditable(column, model));\n    }\n\n    function isUndefined(value) {\n        return typeof(value) === \"undefined\";\n    }\n\n    function isNumber(value) {\n        return typeof value === \"number\" && !isNaN(value);\n    }\n\n    if (kendo.ExcelMixin) {\n        kendo.ExcelMixin.extend(TreeList.prototype);\n    }\n\n    if (kendo.PDFMixin) {\n        kendo.PDFMixin.extend(TreeList.prototype);\n\n       TreeList.prototype._drawPDF = function(progress) {\n           var treeList = this;\n\n           if (treeList.options.pdf.paperSize && treeList.options.pdf.paperSize != \"auto\") {\n               return treeList._drawPDF_autoPageBreak(progress);\n           }\n\n           var result = new $.Deferred();\n           var dataSource = treeList.dataSource;\n           var allPages = treeList.options.pdf.allPages;\n\n           this._initPDFProgress(progress);\n\n           // This group will be our document containing all pages\n           var doc = new kendo.drawing.Group();\n           var startingPage = dataSource.page();\n\n           function resolve() {\n               if (allPages && startingPage !== undefined) {\n                   dataSource.unbind(\"change\", exportPage);\n                   dataSource.one(\"change\", function() {\n                       result.resolve(doc);\n                   });\n\n                   dataSource.page(startingPage);\n               } else {\n                   result.resolve(doc);\n               }\n           }\n\n           function exportPage() {\n                treeList._drawPDFShadow({\n                    width: treeList.wrapper.width()\n                }, {\n                    avoidLinks: treeList.options.pdf.avoidLinks\n                })\n                .done(function(group) {\n                    var pageNum = dataSource.page();\n                    var totalPages = allPages ? dataSource.totalPages() : 1;\n\n                    var args = {\n                        page: group,\n                        pageNumber: pageNum,\n                        progress: pageNum / totalPages,\n                        totalPages: totalPages\n                    };\n\n                    progress.notify(args);\n                    doc.append(args.page);\n\n                    if (pageNum < totalPages) {\n                        dataSource.page(pageNum + 1);\n                    } else {\n                        resolve();\n                    }\n                })\n                .fail(function(err) {\n                    result.reject(err);\n                });\n            }\n\n            if (allPages) {\n                dataSource.bind(\"change\", exportPage);\n                dataSource.page(1);\n            } else {\n                exportPage();\n            }\n\n            return result.promise();\n        };\n\n        TreeList.prototype._initPDFProgress = function(deferred) {\n            var loading = $(\"<div class='k-loading-pdf-mask'><div class='k-loading-color'></div></div>\");\n            loading.prepend(this.wrapper.clone().css({\n                position: \"absolute\", top: 0, left: 0\n            }));\n\n            this.wrapper.append(loading);\n\n            var progressBar = $(\"<div class='k-loading-pdf-progress'>\")\n                .appendTo(loading)\n                .kendoProgressBar({\n                    type: \"chunk\",\n                    chunkCount: 10,\n                    min: 0,\n                    max: 1,\n                    value: 0\n                }).data(\"kendoProgressBar\");\n\n            deferred.progress(function(e) {\n                progressBar.value(e.progress);\n            })\n            .always(function() {\n                kendo.destroy(loading);\n                loading.remove();\n            });\n        };\n\n        TreeList.prototype._drawPDF_autoPageBreak = function(progress) {\n            var treeList = this;\n            var result = new $.Deferred();\n            var dataSource = treeList.dataSource;\n            var allPages = treeList.options.pdf.allPages;\n            var origBody = treeList.wrapper.find('table[role=\"treeList\"] > tbody');\n            var cont = $(\"<div>\")\n                .css({ position: \"absolute\", left: -10000, top: -10000 });\n            var clone = treeList.wrapper.clone().css({\n                height: \"auto\", width: \"auto\"\n            }).appendTo(cont);\n            clone.find(\".k-grid-content\").css({ height: \"auto\", width: \"auto\", overflow: \"visible\" });\n            clone.find('table[role=\"treeList\"], .k-grid-footer table').css({ height: \"auto\", width: \"100%\", overflow: \"visible\" });\n            clone.find(\".k-grid-pager, .k-grid-toolbar, .k-grouping-header\").remove();\n            clone.find(\".k-grid-header, .k-grid-footer\").css({ paddingRight: 0 });\n\n            this._initPDFProgress(progress);\n\n            var body = clone.find('table[role=\"treeList\"] > tbody').empty();\n            var startingPage = dataSource.page();\n\n            function resolve() {\n                if (allPages && startingPage !== undefined) {\n                    dataSource.one(\"change\", draw);\n                    dataSource.page(startingPage);\n                } else {\n                    treeList.refresh();\n                    draw();\n                }\n            }\n\n            function draw() {\n                cont.appendTo(document.body);\n                var options = $.extend({}, treeList.options.pdf, {\n                    _destructive: true,\n                    progress: function(p) {\n                        progress.notify({\n                            page: p.page,\n                            pageNumber: p.pageNum,\n                            progress: 0.5 + p.pageNum / p.totalPages / 2,\n                            totalPages: p.totalPages\n                        });\n                    }\n                });\n                kendo.drawing.drawDOM(clone, options)\n                    .always(function() {\n                        cont.remove();\n                    })\n                    .then(function(group) {\n                        result.resolve(group);\n                    })\n                    .fail(function(err) {\n                        result.reject(err);\n                    });\n            }\n\n            function renderPage() {\n                var pageNum = dataSource.page();\n                var totalPages = allPages ? dataSource.totalPages() : 1;\n                body.append(origBody.find(\"tr\"));\n                if (pageNum < totalPages) {\n                    dataSource.page(pageNum + 1);\n                } else {\n                    dataSource.unbind(\"change\", renderPage);\n                    resolve();\n                }\n            }\n\n            if (allPages) {\n                dataSource.bind(\"change\", renderPage);\n                dataSource.page(1);\n            } else {\n                renderPage();\n            }\n\n            return result.promise();\n        };\n    }\n\n    extend(true, kendo.data, {\n        TreeListDataSource: TreeListDataSource,\n        TreeListModel: TreeListModel\n    });\n\n    ui.plugin(TreeList);\n    ui.plugin(TreeListPager);\n\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","description","depends","features","$","window","kendo","jQuery","undefined","data","kendoDom","dom","kendoDomElement","element","kendoTextElement","text","kendoHtmlElement","html","outerWidth","_outerWidth","keys","outerHeight","_outerHeight","ui","DataBoundWidget","DataSource","ObservableArray","Query","Model","browser","support","kendoTemplate","template","activeElement","_activeElement","touchDevice","touch","isArray","Array","extend","map","grep","inArray","isPlainObject","push","prototype","STRING","CHANGE","ITEM_CHANGE","ERROR","PROGRESS","DOT","NS","CLICK","INPUT","BEFORE_EDIT","EDIT","PAGE","PAGE_CHANGE","SAVE","SAVE_CHANGES","SORT","EXPAND","COLLAPSE","CELL_CLOSE","REMOVE","DATA_CELL","FILTER_CELL","DATABINDING","DATABOUND","CANCEL","TABINDEX","FILTERMENUINIT","FILTERMENUOPEN","COLUMNHIDE","COLUMNSHOW","HEADERCELLS","COLUMNREORDER","COLUMNRESIZE","COLUMNMENUINIT","COLUMNMENUOPEN","COLUMNLOCK","COLUMNUNLOCK","PARENTIDFIELD","DRAGSTART","DRAG","DROP","DRAGEND","NAVROW","NAVCELL","NAVHEADER","NORECORDSCLASS","ITEMROW","isRtl","HEIGHT","INCELL","INLINE","POPUP","TABLE","CHECKBOX","CHECKBOXINPUT","SELECTCOLUMNTMPL","SELECTCOLUMNHEADERTMPL","SELECTED","whitespaceRegExp","filterRowRegExp","RegExp","classNames","wrapper","header","button","alt","editCell","editRow","dirtyCell","group","toolbar","gridToolbar","gridHeader","gridHeaderWrap","gridContent","gridContentWrap","gridFilter","footerTemplate","focused","loading","refresh","retry","selected","status","link","filterable","icon","iconFilter","iconCollapse","iconExpand","iconHidden","iconPlaceHolder","input","dropPositions","dropTop","dropBottom","dropAdd","dropMiddle","dropDenied","dragStatus","dragClue","dragClueText","headerCellInner","columnTitle","defaultCommands","create","imageClass","className","methodName","createchild","destroy","edit","update","canceledit","cancel","save","excel","pdf","search","TreeView","Class","init","options","that","this","defaultParentId","idField","parentIdField","childrenMap","dataLength","length","dataItem","dataItemId","dataItemParentId","_childrenMap","i","idsMap","_idMap","dataMaps","_dataMaps","children","ids","rootNodes","removeCollapsedSubtreesFromRootNodes","result","prunedTree","maxDepth","Infinity","removeCollapsedSubtrees","concat","rootNode","childIdx","expanded","isUndefined","TreeQuery","TreeListModel","constructor","process","inPlace","query","sort","normalizeGroup","normalizeSort","filterCallback","filter","skip","take","total","filteredChildrenMap","view","prunedData","toArray","processFromRootNodes","range","parentId","fields","type","nullable","value","fn","call","_loaded","get","accept","set","field","initiator","loaded","shouldSerialize","is","object","not","func","base","model","TreeListDataSource","_getDataMaps","schema","modelBase","_addRange","_createNewModel","fromModel","_modelParentIdField","_isPageable","_shouldWrap","_push","operation","_readData","_getData","_data","newData","toJSON","_replaceData","source","target","sourceLength","_readAggregates","_aggregateResult","reader","aggregates","_defaultParentId","read","_modelOptions","_skip","_page","_collapsedTotal","remove","root","_removeChildData","_removeFromDataMaps","removePristine","pageable","_getChildrenMap","items","_subtree","shouldRemovePristine","removedItems","_removeItems","pushDestroy","insert","index","newModel","_insertInDataMaps","_filterCallback","item","_modelIdField","parentSubtree","parent","_parentNode","unshift","parentNode","len","_observeView","_createTreeView","_initIdsMap","_idsMap","_getIdsMap","_getFilteredChildrenMap","filteredChildren","_setFilteredChildrenMap","_initDataMaps","_initChildrenMapForParent","_defaultTreeModelOptions","modelOptions","_defaultDataItemType","ObservableObject","_calculateAggregates","subtree","pageableChildrenMap","aggregate","bind","_queryProcess","_processPageableQuery","hasLoadedChildren","hasChildren","slice","_processTreeQuery","_replaceWithObservedData","_processDataItemsState","_replaceItemsInDataMaps","dataToAggregate","_dataToAggregate","_replaceInMapWithObservedData","_calculateCollapsedTotal","firstDataItem","firstItemParents","_parentNodes","observableArray","itemType","parents","directParent","viewIndex","_insertInIdsMap","_replaceInMap","replacement","itemInArray","itemIndex","indexOf","dataToReplace","replacementArray","itemToReplace","itemToReplaceId","dataItemIndex","observableItem","_getById","at","key","_insertInChildrenMap","itemId","splice","_removeFromIdsMap","_removeFromChildrenMap","_indexInChildrenMap","_itemIndexInMap","dataMap","uid","_isLastItemInView","_defaultPageableQueryOptions","page","pageSize","serverPaging","_updateTotalForAction","action","_updateCollapsedTotalForAction","parseInt","isNumber","_setFilterTotal","filterTotal","setDefaultValue","collapsedTotal","filteredData","_dataWithoutCollapsedSubtrees","_removeCollapsedSubtrees","_processDataItemState","_queueRequest","callback","_modelLoaded","childNodes","_modelError","e","_error","success","requestParams","_observe","_total","load","method","remote","serverSorting","serverFiltering","serverGrouping","serverAggregates","defaultPromise","Deferred","resolve","promise","done","fail","contains","child","rootId","_byParentId","defaultId","current","defaults","allChildNodes","directChildren","_rootNode","_pageableRootNodes","nodesWithoutParentInView","_nodesWithoutParentInView","node","_parentNodesNotInView","parentInView","_parentInView","level","_pageableModelLevel","baseFilter","_pageableQueryOptions","_flatData","cancelChanges","_restorePageSizeAfterAddChild","_modelCanceled","_changesCanceled","_setAddChildPageSize","queryOptions","_addChildPageSize","_query","sync","then","_syncEnd","isCellVisible","style","display","sortCells","cells","indexAttr","attr","a","b","indexA","indexB","leafDataCells","container","rows","find","el","hasClass","add","last","createPlaceholders","spans","columnsWidth","cols","colWidth","width","idx","syncTableHeight","table1","table2","lockedHeigth","offsetHeight","tableHeigth","row","diff","test","height","TreeListPager","Pager","totalPages","dataSource","_filter","Math","ceil","_createDataSource","Editor","Observable","events","_fields","columns","_initContainer","createEditable","editable","Editable","clearContainer","change","_isEditable","column","isColumnEditable","format","editor","end","close","empty","removeAttr","PopupEditor","_attachHandlers","cycleForm","open","modal","resizable","draggable","title","visible","formContent","append","_appendTemplate","_appendFields","_appendButtons","Tree","render","appendTo","Window","form","unescape","selectable","command","class","fieldRenderer","commandRenderer","closeHandler","_cancelProxy","_cancel","on","_saveProxy","_save","userTriggered","_detachHandlers","off","trigger","center","IncellEditor","TreeList","_events","_dataSource","_aria","_columns","_layout","_navigatable","_selectable","_sortable","_resizable","_filterable","_filterRow","_attachEvents","_toolbar","_scrollable","_reorderable","_columnMenu","_minScreenSupport","_draggable","_pageable","autoBind","fetch","_hasLockedColumns","widget","addClass","_resizeHandler","resize","notify","reorderable","move","_dragging","HierarchicalDragAndDrop","$angular","autoScroll","holdToDrag","itemSelector","allowedContainers","hintText","separator","join","destination","dest","src","itemFromTarget","tr","closest","prevRow","prev","nextRow","next","first","sameLevel","content","dragstart","css","drag","drop","removeClass","dragend","originalSrcParentId","originalSrcIndex","position","isPrevented","insertBefore","insertAfter","dropHintContainer","eq","dropPositionFrom","dropHint","contents","dropHintElement","isAfterText","prevAll","nodeType","arguments","nodeData","referenceNode","insertAction","indexOffset","referenceNodeIndex","nodeDataIndex","originalDestIndex","destIndex","_unbindDataSource","_unbindDataChange","_destroyed","pop","_bindDataChange","_bindDataSource","_changeHandler","unbind","_refreshHandler","itemFor","tbody","_itemFor","table","lockedContent","lockedTable","scrollable","scrollables","thead","_wheelScroll","scrollLeft","scrollTop","touchScroller","movable","_touchScroller","sender","x","y","ctrlKey","delta","wheelDeltaY","lockedDiv","currentTarget","scrollHeight","clientHeight","preventDefault","one","_progress","messages","_showStatus","_render","error","isCurrentInHeader","currentIndex","_cancelEditor","_adjustHeight","navigatable","_isActiveInTable","max","cellIndex","_restoreCurrent","_checkBoxSelection","_deselectCheckRows","_angularFooters","footer","allAggregates","footerRows","_footerItems","_angularFooter","angular","elements","col","_items","dataItems","n","tmp","_showNoRecordsTemplate","defaultTemplate","scrollableNoGridHeightStyles","_contentTree","_lockedContentTree","noRows","message","hide","_hideStatus","_hideNoRecordsTempalte","show","contentWrap","pagerHeight","pager","scrollbar","isHeightSet","initialHeight","newHeight","offsetWidth","clientWidth","_resize","size","force","_applyLockedContainersWidth","any","hideMinScreenCols","minScreenResizeHandler","_iterateMinScreenCols","screenWidth","minWidth","minScreenWidth","hideColumn","showColumn","hidden","innerWidth","screen","_destroyColumnAttachments","_errorHandler","_progressHandler","_navigatableTables","_current","_draggableInstance","_userEvents","_destroyEditor","_destroyPager","_autoExpandable","_dataSourceFetchProxy","lockedHeader","_statusTree","_headerTree","_lockedHeaderColsTree","_lockedContentColsTree","_lockedHeaderTree","sortable","columnMenu","requestFailed","commands","hierarchy","renderAllRows","rowTemplate","altRowTemplate","getOptions","deepExtend","initialData","transport","setOptions","currentOptions","before","_setEvents","each","th","filterMenu","_toggle","expand","_isIncellEditable","closeCell","afterModelLoaded","_toggleData","_syncLockedContentHeight","always","_togglePageableData","_renderProgress","_refreshPager","collapse","_toggleChildren","event","tables","headerTables","_openHeaderMenu","_tableClick","_tableFocus","_tableBlur","_tableKeyDown","altKey","keyCode","DOWN","click","stopImmediatePropagation","td","lockedColumnOffset","leafColumns","lockedColumns","active","rowIndex","focusTable","newCurrent","_updateCurrentAttr","_scrollCurrent","_lastCellIndex","_setCurrent","tableContainer","isInLockedContainer","isInContent","scrollableContainer","_scrollTo","_relatedRow","_findCurrentCell","elementToLowercase","tagName","toLowerCase","isHorizontal","elementOffsetDir","containerScroll","containerOffsetDir","elementOffset","abs","offsetLeft","bottomDistance","ieCorrection","firefoxCorrection","msie","edge","mozilla","webkit","version","_elementId","_currentDataIndex","lockedColumnsCount","_prevVerticalCell","cellSelector","parentColumnsCells","_nextVerticalCell","childColumnsCells","rowSpan","tmpIndex","currentRowCells","hiddenColumns","_verticalContainer","up","step","floor","headerId","replace","handled","canHandle","isDefaultPrevented","UP","_moveUp","shiftKey","_moveDown","LEFT","RIGHT","_handleExpand","_moveRight","_handleCollapse","_moveLeft","PAGEDOWN","_handlePageDown","PAGEUP","_handlePageUp","ENTER","F2","_handleEnterKey","ESC","_handleEscKey","HOME","_handleHome","END","_handleEnd","TAB","_handleTabKey","stopPropagation","ctrl","rowContainer","isInLockedTable","isInBody","currentTable","has","blur","cancelRow","focusable","_handleEditing","incellEditing","cell","_tabNext","_preventPageSizeRestore","back","switchRow","nextAll","isIE","editContainer","isEdited","nextFocusableCellRowIndex","nextFocusableCellIndex","currentFocusedCellRowIndex","currentFocusedCellIndex","editedCell","opera","triggerHandler","saveRow","focus","isHeader","headerTable","isInput","isInputElement","setTimeout","_setTabIndex","retryButton","UserEvents","press","_onPress","allowSelection","_commandClick","_search","_attachCellEditingEventHandlers","icons","multiple","relatedTarget","isLockedCell","clearTimeout","_closeCellTimeout","_commandByName","j","currentName","commandName","parentsUntil","_searchTimeOut","searchFields","expression","filters","logic","getColumnsFields","operator","_ensureExpandableColumn","expandable","visibleColumns","expandableColumns","encoded","lockedCols","Error","nonLockedColumns","normalizeColumns","_columnTemplates","_columnAttributes","_includeChildren","includeChildren","_checkboxClick","_headerCheckboxClick","dirtyCellTemplate","_createDirtyColumnTemplate","dirtyIndicatorTemplate","_createIndicatorTemplate","headerTemplate","convertStyle","properties","declaration","split","trim","camelCase","attributes","headerAttributes","_clearSortClasses","layout","addBack","rtl","_initVirtualTrees","_renderCols","_renderHeader","_headerColsTree","_contentColsTree","buttons","_buildCommands","_lockedColumns","_nonLockedColumns","_templateColumns","_flushCache","_renderOptions","maps","_dataToRender","_renderedModelLevel","uidAttr","hasFooterTemplate","select","_","viewChildrenMap","_absoluteIndex","_angularItems","_clearRenderMap","buttonClass","_viewChildrenMap","_hasFooterTemplate","_trs","editedColumn","editedColumnIndex","contentResized","_muteAngularRebind","_togglePagerVisibility","_setExpanderElement","hiddenDivClass","hiddenDiv","expander","toggle","progress","parentsNotInView","parentNotInView","parentNotInViewId","childId","parentsCopy","_markNodeAsNonRenderable","parentIndex","_skipRenderingMap","nodeId","_adjustRowsHeight","rows2","containers","containersLength","heights","offsetHeight1","offsetHeight2","_ths","ths","cellClasses","headerContent","leafs","scope","role","colSpan","data-field","data-title","_cols","_clearColsCache","_retrieveFirstColumn","_updateFirstColumnClass","_updateRowSpans","included","visibleChildColumns","_setColumnDataIndexes","_updateColumnCellIndex","offset","updateCellIndex","_setParentsVisibility","predicate","p","columnParents","_prepareColumns","parentCell","parentRow","parentColumn","childRow","totalColSpan","_renderHeaderTree","tree","hasMultiColumnHeaders","rowsToRender","filterThs","_hasFilterRow","_filterThs","_syncLockedHeaderHeight","_updateFilterThs","refColumn","filterRowThs","refIndex","currIndex","thIndex","lockedWidth","nonLockedWidth","wrapperWidth","modelId","_edit","rowOptions","isAlt","_trFromTemplate","_tds","_td","data-parentId","_footerId","isFunction","parseRowTemplate","nodeName","toLocaleLowerCase","currElement","parseAttributes","nodeValue","_createCellElement","_isTextNode","spaceElements","iconElement","noop","c","renderer","editedColumnField","editColumn","iconClass","columnHasEditCommand","isDirtyColumn","_cellContent","dirtyIndicator","_evalColumnTemplate","templateSettings","_customTemplateSettings","columnTemplateAlias","paramName","templateString","_dirtyIndicatorTemplate","templateFunction","columnTemplate","dirtyField","charAt","expr","Template","_handleCommand","_button","data-command","_positionResizeHandle","resizeHandle","left","rtlCorrection","headerWrap","webkitCorrection","leftMargin","invisibleSpace","leftBorderWidth","cellWidth","which","indicatorWidth","columnResizeHandleWidth","halfResizeHandle","parseFloat","scrollWidth","top","val","locked","autoFitColumn","isLocked","visibleLocked","contentTable","footerTable","oldColumnWidth","newColumnWidth","totalWidth","oldWidth","newWidth","_adjustLockedHorizontalScrollBar","_syncLockedScroll","treelist","Resizable","handle","start","startLocation","location","columnWidth","rtlModifier","minColumnWidth","resizeend","sortableInstance","kendoColumnSorter","filterMenuInstance","filterInit","filterOpen","mode","kendoFilterMenu","settings","filterHandler","existingInstance","suggestDataSource","operators","customDataSource","cellOptions","enabled","values","delay","inputWidth","suggestionOperator","minLength","dataTextField","showOperators","kendoFilterCell","hasFiltering","columnsWithoutFiltering","_change","selectedValues","_uncheckCheckBoxes","_checkRows","_toggleHeaderCheckState","_isLocked","useAllItems","multi","Selectable","parseOptions","aria","continuousItems","_continuousItems","_selectableTarget","SPACEBAR","clear","_lastActive","selectRange","_firstSelectee","lockedItems","nonLockedItems","apply","related","clearSelection","prop","preventChange","checkBox","checked","parentGrid","getKendoTreeList","isSelecting","selector","ds","_sortHandler","setDataSource","getByUid","_isPopupEditable","_editMode","_createEditor","_cancelEdit","args","addRow","inlineEditing","_isInlineEditable","showNewModelInView","_insertAt","_firstEditableColumnIndex","removeRow","document","_shouldRestorePageSize","leafCols","_createIncellEditor","_editCell","isCancel","ns","adjustRowHeight","saveChanges","valid","_toggleColumnVisibility","_findColumn","_adjustTablesWidth","Draggable","guid","hint","prepend","Reorderable","dragOverContainers","_allowDragOverContainers","inSameContainer","targetParentContainerIndex","flatColumnsInDomOrder","sourceIndex","targetIndex","oldIndex","newIndex","reorderColumn","lockable","_reorderTrees","destSources","destContainer","destDomTree","sources","sourcesContainer","sourcesDomTree","depth","sourceDOM","sourceChildren","destDomChildren","destColumn","destRow","sourcesLeafs","destLeafs","reorderTaget","destThs","findReorderTarget","_insertTree","domTr","_reorderHeader","sourcesDepth","targetDepth","sourceLocked","destLocked","rowsToAdd","destRows","destTarget","updateRowSpans","removeEmptyRows","rowspan","lockChanged","nonLockedColumnsLength","lockColumn","unlockColumn","menu","menuOptions","initHandler","_columnMenuInit","openHandler","_columnMenuOpen","hasLockableColumns","compare","pane","owner","closeCallback","kendoColumnMenu","_createPager","alwaysVisible","findParentColumnWithChildren","targetLocked","masterColumns","columnParent","parentColumns","isVisible","parentIds","headers","flatColumns","headerRows","parentCellsWithChildren","prevCells","getAttribute","colSpanAttr","inserted","columnPosition","cellCounts","allColumns","temp","containerDOMtree","emptyRows","shouldRemove","direct","focusElement","row1","row2","dirty","dirtyFields","isNaN","ExcelMixin","PDFMixin","_drawPDF","treeList","paperSize","_drawPDF_autoPageBreak","allPages","_initPDFProgress","doc","drawing","Group","startingPage","exportPage","_drawPDFShadow","avoidLinks","pageNum","pageNumber","err","reject","deferred","clone","progressBar","kendoProgressBar","chunkCount","min","origBody","cont","overflow","paddingRight","body","draw","_destructive","drawDOM","renderPage","plugin","amd","a1","a2","a3"],"mappings":"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"}