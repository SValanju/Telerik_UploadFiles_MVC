{"version":3,"file":"kendo.scheduler.agendaview.min.js","sources":["kendo.scheduler.agendaview.js"],"sourcesContent":["(function(f, define) {\n    define('kendo.scheduler.agendaview',[\"kendo.scheduler.view\"], f);\n})(function() {\n\n    var __meta__ = { // jshint ignore:line\n        id: \"scheduler.agendaview\",\n        name: \"Scheduler Agenda View\",\n        category: \"web\",\n        description: \"The Scheduler Agenda View\",\n        depends: [\"scheduler.view\"],\n        hidden: true\n    };\n\n    (function($) {\n        var kendo = window.kendo,\n            ui = kendo.ui,\n            NS = \".kendoAgendaView\",\n            ROLE = \"role\";\n\n        var EVENT_WRAPPER_FORMAT = '<div class=\"k-task\" title=\"#:(data.title || \"\").replace(/\"/g,\"\\'\")#\" data-#=kendo.ns#uid=\"#=uid#\">' +\n            '# if (resources[0]) {#' +\n            '<span class=\"k-scheduler-mark\" style=\"background-color:#=resources[0].color#\"></span>' +\n            \"# } #\" +\n            \"# if (data.isException()) { #\" +\n            '<span class=\"k-icon k-i-non-recurrence\"></span>' +\n            '# } else if (data.isRecurring()) {#' +\n            '<span class=\"k-icon k-i-reload\"></span>' +\n            \"# } #\" +\n            '<span class=\"k-scheduler-task-text\">{0}</span>' +\n            '#if (showDelete) {#' +\n            '<a href=\"\\\\#\" class=\"k-link k-event-delete\" title=\"${data.messages.destroy}\" aria-label=\"${data.messages.destroy}\"><span class=\"k-icon k-i-close\"></span></a>' +\n            '#}#' +\n            '</div>';\n\n        var EVENT_DATE_TEMPLATE = \"# if (!isMobile) { #\" +\n            '<strong class=\"k-scheduler-agendaday\">' +\n            '#=kendo.toString(date, \"dd\")#' +\n            '</strong>' +\n            '<em class=\"k-scheduler-agendaweek\">' +\n            '#=kendo.toString(date,\"dddd\")#' +\n            '</em>' +\n            '<span class=\"k-scheduler-agendadate\">' +\n            '#=kendo.toString(date, \"y\")#' +\n            '</span>' +\n            '# } else { #' +\n            '<div class=\"k-scheduler-datecolumn-wrap\">' +\n            '<span class=\"k-mobile-scheduler-agendadate\">' +\n            '<span class=\"k-mobile-scheduler-agendaday\">#=kendo.toString(date, \"dd\")#</span>' +\n            '&nbsp' +\n            '<span class=\"k-mobile-scheduler-agendamonth\">#=kendo.toString(date, \"MMMM\")#</span>' +\n            '</span>' +\n            '<span class=\"k-mobile-scheduler-agendaweekday\">' +\n            '#=kendo.toString(date, \"dddd\")#' +\n            '</span>' +\n            '</div>' +\n            '# } #';\n\n        var EVENT_GROUP_TEMPLATE = \"# if (!isMobile) { #\" +\n            '<strong class=\"k-scheduler-adgendagroup\">' +\n            '#=value#' +\n            '</strong>' +\n            '# } else { #' +\n            '<span class=\"k-scheduler-group-text\">' +\n            '#=value#' +\n            '</span>' +\n            '# } #';\n\n        var AgendaGroupedView = kendo.Class.extend({\n            init: function(view) {\n                this._view = view;\n            },\n\n            _getColumns: function(groupHeaders, columns) {\n                return groupHeaders.concat(columns);\n            },\n            _getGroupsInDay: function() {\n                return [];\n            },\n\n            _getSumOfItemsForDate: function() {\n                return 0;\n            },\n\n            _renderTaskGroupsCells: function(headerCells, groups, taskGroupIndex, taskIndex) {\n                var view = this._view;\n\n                if (taskGroupIndex === 0 && taskIndex === 0 && groups.length) {\n                    view._renderTaskGroupsCells(headerCells, groups);\n                }\n            },\n\n            _renderDateCell: function(tableRow, groups, tasks, date, taskGroupIndex, tasksGroups) {\n                var view = this._view;\n                var isMobile = view._isMobile();\n\n                tableRow.push(kendo.format(\n                    '<td class=\"k-scheduler-datecolumn{3}{2}\" rowspan=\"{0}\">{1}</td>',\n                    tasks.length,\n                    view._dateTemplate({ date: date, isMobile: isMobile }),\n                    taskGroupIndex == tasksGroups.length - 1 && !groups.length ? \" k-last\" : \"\",\n                    !groups.length ? \" k-first\" : \"\"\n                ));\n            },\n\n            _renderDates: function() {\n                return undefined;\n            },\n\n            _getParents: function(parentGroups) {\n                return parentGroups.splice(0);\n            },\n\n            _getGroupsByDate: function() {\n                return undefined;\n            },\n\n            _renderTaskGroups: function(table, items, parents) {\n                var view = this._view;\n\n                table.append(view._renderTaskGroups(items, parents));\n            }\n\n        });\n\n        var AgendaGroupedByDateView = kendo.Class.extend({\n            init: function(view) {\n                this._view = view;\n            },\n\n            _getColumns: function(groupHeaders, columns) {\n                var view = this._view;\n\n                if (view._isMobile()) {\n                    return groupHeaders.concat(columns);\n                } else {\n                    var date = columns.slice(0, 1);\n                    var columnsWithoutDate = columns.slice(1);\n\n                    return date.concat(groupHeaders).concat(columnsWithoutDate);\n                }\n            },\n\n            _compareDateGroups: function(currentGroup, prevGroup, index) {\n                if (currentGroup[index].text == prevGroup[index].text) {\n                    if (index === 0) {\n                        return true;\n                    } else {\n                        return this._compareDateGroups(currentGroup, prevGroup, index - 1);\n                    }\n                }\n\n                return false;\n            },\n\n            _getGroupsInDay: function(tasksGroups, groups) {\n                var groupsInDay = [];\n                var prevGroup = null;\n\n                for (var tasksGroupIdx = 0; tasksGroupIdx < tasksGroups.length; tasksGroupIdx++) {\n                    for (var itemsIdx = 0; itemsIdx < tasksGroups[tasksGroupIdx].items.length; itemsIdx++) {\n                        var idx = 0;\n\n                        if (groupsInDay.length === 0) {\n                            for (idx; idx < groups[tasksGroupIdx].length; idx++) {\n                                groupsInDay.push([1]);\n                            }\n                        } else {\n                            for (idx; idx < groups[tasksGroupIdx].length; idx++) {\n\n                                if (this._compareDateGroups(groups[tasksGroupIdx], prevGroup, idx)) {\n                                    groupsInDay[idx][groupsInDay[idx].length - 1]++;\n                                } else {\n                                    var lastItemValue = groupsInDay[idx][groupsInDay[idx].length - 1] - 1;\n                                    for (var i = 0; i < lastItemValue; i++) {\n                                        groupsInDay[idx].push(0);\n                                    }\n                                    groupsInDay[idx].push(1);\n                                }\n                            }\n                        }\n                        prevGroup = groups[tasksGroupIdx];\n                    }\n                }\n\n                return groupsInDay;\n            },\n\n            _getSumOfItemsForDate: function(tasksGroups) {\n                var sumOfItemsForDate = 0;\n\n                for (var i = 0; i < tasksGroups.length; i++) {\n\n                    sumOfItemsForDate += tasksGroups[i].items.length;\n                }\n                return sumOfItemsForDate;\n            },\n\n            _renderTaskGroupsCells: function(headerCells, groups, taskGroupIndex, taskIndex, groupsInDay, sumOfItemsForDate, date, groupsRowSpanIndex) {\n                var view = this._view;\n                var isMobile = view._isMobile();\n\n                if (!isMobile) {\n                    if (taskGroupIndex === 0 && taskIndex === 0) {\n                        headerCells.push(kendo.format(\n                            '<td class=\"k-scheduler-datecolumn k-first\" rowspan=\"{0}\">{1}</td>',\n                            sumOfItemsForDate,\n                            view._dateTemplate({ date: date, isMobile: isMobile })\n                        ));\n                    }\n\n                    for (var idx = 0; idx < groups[taskGroupIndex].length; idx++) {\n                        if (groupsInDay[idx][groupsRowSpanIndex]) {\n                            headerCells.push(kendo.format(\n                                '<td class=\"k-scheduler-groupcolumn\" rowspan=\"{0}\">{1}</td>',\n                                groupsInDay[idx][groupsRowSpanIndex],\n                                view._groupTemplate({ value: groups[taskGroupIndex][idx].text, isMobile: isMobile }),\n                                groups[taskGroupIndex][idx].className\n                            ));\n                        }\n                    }\n                } else {\n                    if (taskGroupIndex === 0 && taskIndex === 0 && groups.length) {\n                        view._renderTaskGroupsCells(headerCells, groups);\n                    }\n                }\n            },\n\n            _renderDateCell: function() {\n                return undefined;\n            },\n\n            _renderDates: function(table) {\n                var view = this._view;\n                var sortedArray = view._groupsByDate.sort(function(a, b) {\n                    return a.array[0].value.getTime() - b.array[0].value.getTime();\n                });\n\n                for (var i = 0; i < sortedArray.length; i++) {\n                    table.append(view._renderTaskGroups(sortedArray[i].array, sortedArray[i].groups));\n                }\n            },\n\n            _getParents: function(parentGroups) {\n                return parentGroups.slice(0);\n            },\n\n            _getGroupsByDate: function(groups, idx, parents) {\n                var view = this._view;\n\n                if (groups[idx].items) {\n                    for (var taskGroupIndex = 0; taskGroupIndex < groups[idx].items.length; taskGroupIndex++) {\n                        var date = groups[idx].items[taskGroupIndex].value;\n                        var dateExists = false;\n\n                        for (var i = 0; i < view._groupsByDate.length; i++) {\n                            if (view._groupsByDate[i].array[0].value.getTime() === date.getTime()) {\n                                dateExists = true;\n                                view._groupsByDate[i].array.push(groups[idx].items[taskGroupIndex]);\n                                view._groupsByDate[i].groups.push(parents);\n                            }\n                        }\n\n                        if (!dateExists) {\n                            view._groupsByDate.push({\n                                array: [groups[idx].items[taskGroupIndex]],\n                                groups: [parents]\n                            });\n                        }\n                    }\n                }\n            },\n\n            _renderTaskGroups: function() {\n                return undefined;\n            }\n\n        });\n\n        kendo.ui.scheduler.AgendaGroupedView = AgendaGroupedView;\n        kendo.ui.scheduler.AgendaGroupedByDateView = AgendaGroupedByDateView;\n\n\n        ui.AgendaView = ui.SchedulerView.extend({\n            init: function(element, options) {\n                ui.SchedulerView.fn.init.call(this, element, options);\n\n                this._groupedView = this._getGroupedView();\n\n                options = this.options;\n\n                if (options.editable) {\n                    options.editable = $.extend(\n                        { \"delete\": true },\n                        options.editable,\n                        { create: false, update: false },\n                        { messages: options.messages }\n                    );\n                }\n\n                this.title = options.title;\n\n                this._eventTemplate = this._eventTmpl(options.eventTemplate, EVENT_WRAPPER_FORMAT);\n                this._dateTemplate = kendo.template(options.eventDateTemplate);\n                this._groupTemplate = kendo.template(options.eventGroupTemplate);\n                this._timeTemplate = kendo.template(options.eventTimeTemplate);\n\n                this.element.on(\"mouseenter\" + NS, \".k-scheduler-agenda .k-scheduler-content tr\", \"_mouseenter\")\n                    .on(\"mouseleave\" + NS, \".k-scheduler-agenda .k-scheduler-content tr\", \"_mouseleave\")\n                    .on(\"click\" + NS, \".k-scheduler-agenda .k-scheduler-content .k-link:has(.k-i-close)\", \"_remove\");\n\n                this._renderLayout(options.date);\n                this.refreshLayout();\n            },\n\n            name: \"agenda\",\n\n            _aria: function() {\n                var table = this.table;\n\n                table.attr(ROLE, \"grid\");\n\n                table.children(\"tbody\").attr(ROLE, \"none\");\n\n                table.find(\"table\").attr(ROLE, \"none\");\n                table.find(\"table > tbody\").attr(ROLE, \"rowgroup\");\n                table.find(\"table tr\").attr(ROLE, \"row\");\n                table.find(\"table td\").attr(ROLE, \"gridcell\");\n\n                table.find(\".k-scheduler-header-wrap th\").attr(ROLE, \"columnheader\");\n                table.find(\".k-scheduler-content .k-scheduler-datecolumn, .k-scheduler-content .k-scheduler-groupcolumn\").attr(ROLE, \"rowheader\");\n            },\n\n            clearSelection: function() {\n                this.element.find(\".k-state-selected\").attr(\"aria-selected\", false);\n\n                kendo.ui.SchedulerView.fn.clearSelection.call(this);\n            },\n\n            _isVirtualized: function() {\n                return false;\n            },\n            _getGroupedView: function() {\n                if (this._isGroupedByDate()) {\n                    return new kendo.ui.scheduler.AgendaGroupedByDateView(this);\n                } else {\n                    return new kendo.ui.scheduler.AgendaGroupedView(this);\n                }\n            },\n\n            _mouseenter: function(e) {\n                $(e.currentTarget).addClass(\"k-state-hover\");\n            },\n\n            _mouseleave: function(e) {\n                $(e.currentTarget).removeClass(\"k-state-hover\");\n            },\n\n            _remove: function(e) {\n                e.preventDefault();\n\n                this.trigger(\"remove\", {\n                    uid: $(e.currentTarget).closest(\".k-task\").attr(kendo.attr(\"uid\"))\n                });\n            },\n\n            nextDate: function() {\n                return kendo.date.nextDay(this.startDate());\n            },\n\n            startDate: function() {\n                return this._startDate;\n            },\n\n            endDate: function() {\n                return this._endDate;\n            },\n\n            previousDate: function() {\n                return kendo.date.previousDay(this.startDate());\n            },\n\n            _renderLayout: function(date) {\n                this._startDate = date;\n                this._endDate = kendo.date.addDays(date, 7);\n                this.createLayout(this._layout());\n                this._footer();\n                this.table.addClass(\"k-scheduler-agenda\");\n            },\n\n            _layout: function() {\n                var columns = [\n                    { text: this.options.messages.time, className: \"k-scheduler-timecolumn\" },\n                    { text: this.options.messages.event }\n                ];\n\n                if (!this._isMobile()) {\n                    columns.splice(0, 0, { text: this.options.messages.date, className: \"k-scheduler-datecolumn\" });\n                }\n\n                var resources = this.groupedResources;\n                if (resources.length) {\n                    var groupHeaders = [];\n                    for (var idx = 0; idx < resources.length; idx++) {\n                        groupHeaders.push({ text: \"\", className: \"k-scheduler-groupcolumn\" });\n                    }\n\n                    columns = this._groupedView._getColumns(groupHeaders, columns);\n                }\n\n                return {\n                    columns: columns\n                };\n            },\n\n            _tasks: function(events) {\n                var tasks = [];\n\n                for (var idx = 0; idx < events.length; idx++) {\n                    var event = events[idx];\n                    var start = event.start;\n                    var end = event.isAllDay ? kendo.date.getDate(event.end) : event.end;\n                    var eventStartDate = kendo.date.getDate(start);\n                    var offsetCompensation = (eventStartDate.getTimezoneOffset() - end.getTimezoneOffset()) * 60000;\n\n                    var eventDurationInDays = Math.ceil((end - eventStartDate + offsetCompensation) / kendo.date.MS_PER_DAY);\n\n                    if (event.isAllDay) {\n                        eventDurationInDays += 1;\n                    }\n\n                    var task = event.clone();\n                    task.startDate = kendo.date.getDate(start);\n\n                    if (task.startDate >= this.startDate()) {\n                        tasks.push(task);\n                    }\n\n                    if (eventDurationInDays > 1) {\n                        task.end = kendo.date.nextDay(start);\n                        task.head = true;\n                        for (var day = 1; day < eventDurationInDays; day++) {\n                            start = task.end;\n                            task = event.clone();\n                            task.start = task.startDate = kendo.date.getDate(start);\n                            task.end = kendo.date.nextDay(start);\n                            if (day == eventDurationInDays - 1) {\n                                task.end = new Date(task.start.getFullYear(), task.start.getMonth(), task.start.getDate(), end.getHours(), end.getMinutes(), end.getSeconds(), end.getMilliseconds());\n                                task.tail = true;\n                            } else {\n                                task.isAllDay = true;\n                                task.middle = true;\n                            }\n\n                            if ((kendo.date.getDate(task.end) <= this.endDate() && task.start >= this.startDate()) || kendo.date.getDate(task.start).getTime() == this.endDate().getTime()) {\n                                tasks.push(task);\n                            }\n                        }\n                    }\n                }\n\n                return new kendo.data.Query(tasks).sort([{ field: \"start\", dir: \"asc\" }, { field: \"end\", dir: \"asc\" }]).groupBy({ field: \"startDate\" }).toArray();\n            },\n\n            _renderTaskGroups: function(tasksGroups, groups) {\n                var tableRows = [];\n                var editable = this.options.editable;\n                var showDelete = editable && editable.destroy !== false && !this._isMobile();\n                var isMobile = this._isMobile();\n                var sumOfItemsForDate = this._groupedView._getSumOfItemsForDate(tasksGroups);\n                var groupsInDay = this._groupedView._getGroupsInDay(tasksGroups, groups);\n                var groupsRowSpanIndex = 0;\n\n                for (var taskGroupIndex = 0; taskGroupIndex < tasksGroups.length; taskGroupIndex++) {\n                    var date = tasksGroups[taskGroupIndex].value;\n\n                    var tasks = tasksGroups[taskGroupIndex].items;\n\n                    var today = kendo.date.isToday(date);\n\n                    for (var taskIndex = 0; taskIndex < tasks.length; taskIndex++) {\n                        var task = tasks[taskIndex];\n\n                        var tableRow = [];\n\n                        var headerCells = !isMobile ? tableRow : [];\n\n                        this._groupedView._renderTaskGroupsCells(headerCells, groups, taskGroupIndex, taskIndex, groupsInDay, sumOfItemsForDate, date, groupsRowSpanIndex);\n\n                        groupsRowSpanIndex++;\n                        if (taskIndex === 0) {\n                            if (isMobile) {\n                                headerCells.push(kendo.format(\n                                    '<td class=\"k-scheduler-datecolumn {1}\" colspan=\"2\">{0}</td>',\n                                    this._dateTemplate({ date: date, isMobile: isMobile }),\n                                    !this.groupedResources.length ? \"k-first\" : \"\"\n                                ));\n\n                                tableRows.push('<tr role=\"row\" aria-selected=\"false\"' + (today ? ' class=\"k-today\">' : \">\") + headerCells.join(\"\") + \"</tr>\");\n                            } else {\n                                this._groupedView._renderDateCell(tableRow, groups, tasks, date, taskGroupIndex, tasksGroups);\n                            }\n                        }\n\n                        if (task.head) {\n                            task.format = \"{0:t}\";\n                        } else if (task.tail) {\n                            task.format = \"{1:t}\";\n                        } else {\n                            task.format = \"{0:t}-{1:t}\";\n                        }\n\n                        task.resources = this.eventResources(task);\n\n                        tableRow.push(kendo.format(\n                            '<td class=\"k-scheduler-timecolumn {4}\"><div>{0}{1}{2}</div></td><td>{3}</td>',\n                            task.tail || task.middle ? '<span class=\"k-icon k-i-arrow-60-left\"></span>' : \"\",\n                            this._timeTemplate(task.clone({ start: task._startTime || task.start, end: task.endTime || task.end })),\n                            task.head || task.middle ? '<span class=\"k-icon k-i-arrow-60-right\"></span>' : \"\",\n                            this._eventTemplate(task.clone({ showDelete: showDelete, messages: this.options.messages })),\n                            !this.groupedResources.length && isMobile ? \"k-first\" : \"\"\n                        ));\n\n                        tableRows.push('<tr role=\"row\" aria-selected=\"false\"' + (today ? ' class=\"k-today\">' : \">\") + tableRow.join(\"\") + \"</tr>\");\n                    }\n                }\n\n                return tableRows.join(\"\");\n            },\n\n            _renderTaskGroupsCells: function(headerCells, groups) {\n                var isMobile = this._isMobile();\n\n                for (var idx = 0; idx < groups.length; idx++) {\n                    headerCells.push(kendo.format(\n                        '<td class=\"k-scheduler-groupcolumn{2}\" rowspan=\"{0}\">{1}</td>',\n                        groups[idx].rowSpan,\n                        this._groupTemplate({ value: groups[idx].text, isMobile: isMobile }),\n                        groups[idx].className\n                    ));\n                }\n            },\n\n            render: function(events) {\n                var table = this.content.find(\"table\").empty();\n                var groups = [];\n\n                if (events.length > 0) {\n                    var resources = this.groupedResources;\n\n                    table.append($(\"<tbody>\"));\n\n                    if (resources.length) {\n                        groups = this._createGroupConfiguration(events, resources, null);\n                        this._groupsByDate = [];\n                        this._renderGroups(groups, table.find(\"tbody\"), []);\n                        this._groupedView._renderDates(table.find(\"tbody\"));\n                    } else {\n                        groups = this._tasks(events);\n                        table.find(\"tbody\").append(this._renderTaskGroups(groups, []));\n                    }\n                }\n\n                var items = this._eventsList = flattenTaskGroups(groups);\n                this._angularItems(table, items);\n\n                this._aria();\n                this.refreshLayout();\n                this.trigger(\"activate\");\n            },\n\n            _angularItems: function(table, items) {\n                this.angular(\"compile\", function() {\n                    var data = [], elements = items.map(function(item) {\n                        data.push({ dataItem: item });\n                        return table.find(\".k-task[\" + kendo.attr(\"uid\") + \"=\" + item.uid + \"]\");\n                    });\n                    return { elements: elements, data: data };\n                });\n            },\n\n            _renderGroups: function(groups, table, parentGroups) {\n                for (var idx = 0, length = groups.length; idx < length; idx++) {\n                    var parents = this._groupedView._getParents(parentGroups);\n\n                    parents.push(groups[idx]);\n                    this._groupedView._getGroupsByDate(groups, idx, parents);\n\n                    if (groups[idx].groups) {\n                        this._renderGroups(groups[idx].groups, table, parents);\n                    } else {\n                        this._groupedView._renderTaskGroups(table, groups[idx].items, parents);\n                    }\n                }\n            },\n\n            _createGroupConfiguration: function(events, resources, parent) {\n                var resource = resources[0];\n                var configuration = [];\n                var data = resource.dataSource.view();\n                var isMobile = this._isMobile();\n\n                data = data.filter(function(item) {\n                    var itemParentValue = kendo.getter(resource.dataParentValueField)(item);\n\n                    return itemParentValue === null || itemParentValue === undefined || (parent && itemParentValue === parent.value);\n                });\n\n                for (var dataIndex = 0; dataIndex < data.length; dataIndex++) {\n                    var value = resourceValue(resource, data[dataIndex]);\n\n                    var tmp = new kendo.data.Query(events).filter({ field: resource.field, operator: ui.SchedulerView.groupEqFilter(value) }).toArray();\n\n                    if (tmp.length) {\n                        var tasks = this._tasks(tmp);\n                        var className = parent ? \"\" : \" k-first\";\n\n                        if (dataIndex === data.length - 1 && (!parent || parent.className.indexOf(\"k-last\") > -1)) {\n                            className += \" k-last\";\n                        }\n\n                        var obj = {\n                            text: kendo.getter(resource.dataTextField)(data[dataIndex]),\n                            value: value,\n                            rowSpan: 0,\n                            className: className\n                        };\n\n                        if (resources.length > 1) {\n                            obj.groups = this._createGroupConfiguration(tmp, resources.slice(1), obj);\n                            if (parent) {\n                                parent.rowSpan += obj.rowSpan;\n                            }\n                        } else {\n                            obj.items = tasks;\n                            var span = rowSpan(obj.items);\n\n                            if (isMobile) {\n                                span += obj.items.length;\n                            }\n\n                            obj.rowSpan = span;\n                            if (parent) {\n                                parent.rowSpan += span;\n                            }\n                        }\n                        configuration.push(obj);\n                    }\n                }\n\n                return configuration;\n            },\n\n            // TODO: this method for Agenda view has never worked properly\n            // it used to return wrong resources\n            // to be clearer the deficit, it now does not return any resources\n            _resourceBySlot: function() {\n                return {};\n            },\n\n            selectionByElement: function(cell) {\n                var index, event;\n                cell = $(cell);\n                if (cell.hasClass(\"k-scheduler-datecolumn\") || !this._eventsList.length) {\n                    return;\n                }\n\n                if (cell.is(\".k-task\")) {\n                    cell = cell.closest(\"td\");\n                }\n\n                if (this._isMobile()) {\n                    var parent = cell.parent();\n                    index = parent.parent().children()\n                        .filter(function() {\n                            return $(this).children(\":not(.k-scheduler-datecolumn, .k-scheduler-groupcolumn)\").length;\n                        })\n                        .index(parent);\n                } else {\n                    index = cell.parent().index();\n                }\n\n                event = this._eventsList[index];\n\n                return {\n                    index: index,\n                    start: event.start,\n                    end: event.end,\n                    isAllDay: event.isAllDay,\n                    uid: event.uid\n                };\n            },\n\n            select: function(selection) {\n                this.clearSelection();\n\n                var row = this.table\n                    .find(\".k-task\")\n                    .eq(selection.index)\n                    .closest(\"tr\")\n                    .addClass(\"k-state-selected\")\n                    .attr(\"aria-selected\", true)[0];\n\n                this.current(row);\n            },\n\n            move: function(selection, key) {\n                var handled = false;\n                var index = selection.index;\n\n                if (key == kendo.keys.UP) {\n                    index--;\n                    handled = true;\n                } else if (key == kendo.keys.DOWN) {\n                    index++;\n                    handled = true;\n                }\n\n                if (handled) {\n                    var event = this._eventsList[index];\n                    if (event) {\n                        selection.start = event.start;\n                        selection.end = event.end;\n                        selection.isAllDay = event.isAllDay;\n                        selection.events = [event.uid];\n                        selection.index = index;\n                    }\n                }\n\n                return handled;\n            },\n\n            moveToEvent: function() {\n                return false;\n            },\n\n            constrainSelection: function(selection) {\n                var event = this._eventsList[0];\n                if (event) {\n                    selection.start = event.start;\n                    selection.end = event.end;\n                    selection.isAllDay = event.isAllDay;\n                    selection.events = [event.uid];\n                    selection.index = 0;\n                }\n            },\n\n            isInRange: function() {\n                return true;\n            },\n\n            destroy: function() {\n                if (this.element) {\n                    this.element.off(NS);\n                }\n\n                ui.SchedulerView.fn.destroy.call(this);\n            },\n\n            options: {\n                title: \"Agenda\",\n                name: \"agenda\",\n                editable: true,\n                selectedDateFormat: \"{0:D}-{1:D}\",\n                selectedShortDateFormat: \"{0:d} - {1:d}\",\n                selectedMobileDateFormat: \"{0: MMM} {0:dd} - {1:dd}\",\n                eventTemplate: \"#:title#\",\n                eventTimeTemplate: \"#if(data.isAllDay) {#\" +\n                    '#=this.options.messages.allDay#' +\n                    \"#} else { #\" +\n                    '#=kendo.format(format, start, end)#' +\n                    \"# } #\",\n                eventDateTemplate: EVENT_DATE_TEMPLATE,\n                eventGroupTemplate: EVENT_GROUP_TEMPLATE,\n                messages: {\n                    event: \"Event\",\n                    date: \"Date\",\n                    time: \"Time\",\n                    allDay: \"all day\"\n                }\n            }\n        });\n\n        function rowSpan(tasks) {\n            var result = 0;\n\n            for (var idx = 0, length = tasks.length; idx < length; idx++) {\n                result += tasks[idx].items.length;\n            }\n\n            return result;\n        }\n\n        function resourceValue(resource, item) {\n            if (resource.valuePrimitive) {\n                item = kendo.getter(resource.dataValueField)(item);\n            }\n            return item;\n        }\n\n        function flattenTaskGroups(groups) {\n            var idx = 0,\n                length = groups.length,\n                item,\n                result = [];\n\n            for (; idx < length; idx++) {\n                item = groups[idx];\n                if (item.groups) {\n                    item = flattenGroup(item.groups);\n                    result = result.concat(item);\n                } else {\n                    result = result.concat(flattenGroup(item.items));\n                }\n            }\n\n            return result;\n        }\n\n        function flattenGroup(groups) {\n            var items = [].concat(groups),\n                item = items.shift(),\n                result = [],\n                push = [].push;\n            while (item) {\n                if (item.groups) {\n                    push.apply(items, item.groups);\n                } else if (item.items) {\n                    push.apply(items, item.items);\n                } else {\n                    push.call(result, item);\n                }\n\n                item = items.shift();\n            }\n\n            return result;\n        }\n\n    })(window.kendo.jQuery);\n\n    return window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","description","depends","hidden","$","window","kendo","jQuery","ui","NS","ROLE","EVENT_WRAPPER_FORMAT","EVENT_DATE_TEMPLATE","EVENT_GROUP_TEMPLATE","AgendaGroupedView","Class","extend","init","view","this","_view","_getColumns","groupHeaders","columns","concat","_getGroupsInDay","_getSumOfItemsForDate","_renderTaskGroupsCells","headerCells","groups","taskGroupIndex","taskIndex","length","_renderDateCell","tableRow","tasks","date","tasksGroups","isMobile","_isMobile","push","format","_dateTemplate","_renderDates","undefined","_getParents","parentGroups","splice","_getGroupsByDate","_renderTaskGroups","table","items","parents","append","AgendaGroupedByDateView","slice","columnsWithoutDate","_compareDateGroups","currentGroup","prevGroup","index","text","groupsInDay","tasksGroupIdx","itemsIdx","idx","lastItemValue","i","sumOfItemsForDate","groupsRowSpanIndex","_groupTemplate","value","className","sortedArray","_groupsByDate","sort","a","b","array","getTime","dateExists","rowSpan","result","resourceValue","resource","item","valuePrimitive","getter","dataValueField","flattenTaskGroups","flattenGroup","shift","apply","call","scheduler","AgendaView","SchedulerView","element","options","fn","_groupedView","_getGroupedView","editable","delete","create","update","messages","title","_eventTemplate","_eventTmpl","eventTemplate","template","eventDateTemplate","eventGroupTemplate","_timeTemplate","eventTimeTemplate","on","_renderLayout","refreshLayout","_aria","attr","children","find","clearSelection","_isVirtualized","_isGroupedByDate","_mouseenter","e","currentTarget","addClass","_mouseleave","removeClass","_remove","preventDefault","trigger","uid","closest","nextDate","nextDay","startDate","_startDate","endDate","_endDate","previousDate","previousDay","addDays","createLayout","_layout","_footer","time","event","resources","groupedResources","_tasks","events","start","end","isAllDay","getDate","eventStartDate","offsetCompensation","getTimezoneOffset","eventDurationInDays","Math","ceil","MS_PER_DAY","task","clone","head","day","Date","getFullYear","getMonth","getHours","getMinutes","getSeconds","getMilliseconds","tail","middle","data","Query","field","dir","groupBy","toArray","tableRows","showDelete","destroy","today","isToday","join","eventResources","_startTime","endTime","render","content","empty","_createGroupConfiguration","_renderGroups","_eventsList","_angularItems","angular","elements","map","dataItem","parent","configuration","dataSource","filter","itemParentValue","dataParentValueField","dataIndex","tmp","operator","groupEqFilter","indexOf","obj","dataTextField","span","_resourceBySlot","selectionByElement","cell","hasClass","is","select","selection","row","eq","current","move","key","handled","keys","UP","DOWN","moveToEvent","constrainSelection","isInRange","off","selectedDateFormat","selectedShortDateFormat","selectedMobileDateFormat","allDay","amd","a1","a2","a3"],"mappings":"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"}